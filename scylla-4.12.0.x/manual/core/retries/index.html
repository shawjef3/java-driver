

<!DOCTYPE html>
<html class="no-js" lang="en">
    
    

    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width initial-scale=1" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>
             Retries | Scylla Docs 
        </title>
        <meta name="description" content="Scylla is an Apache Cassandra-compatible NoSQL data store that can handle 1 million transactions per second on a single server." />
        <link rel="icon" href="../../../_static/img/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="../../../_static/img/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" href="../../../_static/img/favicon-228x228.png" sizes="192x192" />
        <link rel="apple-touch-icon" href="../../../_static/img/favicon-228x228.png" />
        <meta name="msapplication-TileImage" href="../../../_static/img/favicon-228x228.png" />

        
            
        

        
            
            <link rel="canonical" href="https://java-driver.docs.scylladb.com/stable/manual/core/retries/"/>
        

        <link rel="author" href="mailto:info@scylladb.com" />

        
            
        <!-- increase expertrec loading priority-->
        <link rel="dns-prefetch" href="https://cse.expertrec.com">

        <!-- increase font loading priority -->
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link rel="preload" as="style"
            href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />

        <!-- async CSS -->
        <link rel="stylesheet" media="print" onload="this.onload=null;this.removeAttribute('media');"
            href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />

        <!-- no-JS fallback -->
        <noscript>
            <link rel="stylesheet"
                href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />
        </noscript>
        
            
                <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
            
        
            
                <link rel="stylesheet" type="text/css" href="../../../_static/css/main.css" />
            
        
            
                <link rel="stylesheet" type="text/css" href="../../../_static/sphinx_collapse.css" />
            
        
            
                <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
            
        
    
        
        
            

        <script type="text/javascript" id="documentation_options" data-url_root="../../../"
            src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/js/runtime.bundle.js"></script>
        <script type="text/javascript" src="../../../_static/js/main.bundle.js"></script>
        
            
                <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
            
        
            
        
            
                <script src="../../../_static/underscore.js"></script>
            
        
            
                <script src="../../../_static/doctools.js"></script>
            
        
            
                <script src="../../../_static/clipboard.min.js"></script>
            
        
            
                <script src="../../../_static/copybutton.js"></script>
            
        
    
            <!-- Google Tag Manager -->
<script>
    (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({
            "gtm.start": new Date().getTime(),
            event: "gtm.js"
        });
        var f = d.getElementsByTagName(s)[0],
        j = d.createElement(s),
        dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
    })(window, document, "script", "dataLayer", "GTM-T8P2JP");
</script>
<!-- End Google Tag Manager -->

<!-- Expertrec -->
<script>
    var id = "e2077224-9ccf-11e9-a0c9-0242ac130002";
    var ci_search = document.createElement("script");
    ci_search.type = "text/javascript";
    ci_search.async = true;
    ci_search.src = "https://cse.expertrec.com/api/js/ci_common.js?id=" + id;
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(ci_search, s);
</script>
<!-- End Expertrec -->
        
        <!-- Font Awesome -->
        <script src="https://kit.fontawesome.com/b1870adf6a.js" crossorigin="anonymous"></script>
        <!-- End Font Awesome -->
    </head>

    <body>
        
        <header class="header">
    <div class="header-logo">
        <a class="header-logo__img" href="https://scylladb.com/">
            <img src="../../../_static/img/logo-docs.svg" alt="Scylla Documentation Logo" />
        </a>
        <span class="header-logo__bar"></span>
        <a class="header-logo__text" href="https://docs.scylladb.com/">
            Documentation
        </a>
    </div>
    <div class="header-navigation">
        <ul class="dropdown menu scylla-dropdown scylla-dropdown--header" data-dropdown-menu>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Server
                    <i class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--about-us"></i>
                            Scylla Open Source
                        </a>
                    </li>
                    <li>
                        <a href="https://docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--enterprise"></i>Scylla Enterprise
                        </a>
                    </li>
                    <li>
                        <a href="https://scylla.docs.scylladb.com/stable/alternator/alternator.html">
                            <i class="scylla-icon scylla-icon--overview"></i>
                            Scylla Alternator
                        </a>
                    </li>
                </ul>
            </li>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Cloud <i
                    class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://cloud.scylladb.com/">
                            <i class="scylla-icon scylla-icon--cloud"></i>Scylla Cloud</a>
                    </li>
                    <li>
                        <a href="https://docs.scylladb.com/scylla-cloud/">
                            <i class="scylla-icon scylla-icon--cloud-docs"></i>Scylla Cloud
                            Docs</a>
                    </li>
                </ul>
            </li>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Tools <i
                    class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://manager.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--manager"></i>Scylla Manager</a>
                    </li>
                    <li>
                        <a href="https://monitoring.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--monitoring"></i>Scylla
                            Monitoring Stack</a>
                    </li>
                    <li>
                        <a href="https://operator.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--operator"></i>Scylla Operator
                        </a>
                    </li>
                </ul>
            </li>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Drivers <i
                    class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://docs.scylladb.com/using-scylla/drivers/cql-drivers/">
                            <i class="scylla-icon scylla-icon--nsql-guides"></i>CQL Drivers
                        </a>
                    </li>
                    <li>
                        <a href="https://docs.scylladb.com/using-scylla/drivers/dynamo-drivers/">
                            <i class="scylla-icon scylla-icon--overview"></i>DynamoDB Drivers
                        </a>
                    </li>
                </ul>
            </li>
        </ul>
        <div class="header-button">
            <a href="https://www.scylladb.com/download/" class="button">Download</a>
        </div>
    </div>
    <div class="header-search-box">
        <div class="search-box">
            <ci-search></ci-search>
        </div>
    </div>
    <div class="side-nav-toggle" data-toggle="side-nav">
    <div class="side-nav-toggle__button">
        <img src="../../../_static/img/menu.svg" alt="Menu" />
    </div>
</div>
</header>
        <section
            class="layout  layout--sidebar layout--has-secondary-sidebar ">
            <div class="content large-order-2">
                
                    
    <div class="admonition caution">
        <p class="admonition-title">Caution</p>
        <p>
            
                You're viewing documentation for a previous version of Scylla Java Driver.
            
            <a href="../../../../stable/index.html">Switch to the latest stable version.</a>
        </p>
    </div>

                
                
                    <div class="pre-content">
                        <div class="breadcrumbs">
    <span class="bread__item">
        <a href="https://java-driver.docs.scylladb.com"
            class="bread__highlight">
            <i class="fas fa-home"></i> Scylla Java Driver
        </a>
    </span>
    
        <span class="bread__item">
            <a href="../../index.html">
                Manual
            </a>
        </span>
    
        <span class="bread__item">
            <a href="../index.html">
                Core driver
            </a>
        </span>
    
    <span class="bread__item bread__item--last">Retries</span>
</div>
                    </div>
                
                <section id="retries">
<h1>Retries<a class="headerlink" href="#retries" title="Permalink to this headline">¶</a></h1>
<section id="quick-overview">
<h2>Quick overview<a class="headerlink" href="#quick-overview" title="Permalink to this headline">¶</a></h2>
<p>What to do when a request failed on a node: retry (same or other node), rethrow, or ignore.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">advanced.retry-policy</span></code> in the configuration. Default policy retries at most once, in cases that
have a high chance of success; you can also write your own.</p></li>
<li><p>can have per-profile policies.</p></li>
<li><p>only kicks in if the query is <a class="reference external" href="../idempotence">idempotent</a>.</p></li>
</ul>
<hr class="docutils" />
<p>When a query fails, it sometimes makes sense to retry it: the error might be temporary, or the query
might work on a different node. The driver uses a <em>retry policy</em> to determine when and how to retry.</p>
</section>
<section id="built-in-retry-policies">
<h2>Built-in retry policies<a class="headerlink" href="#built-in-retry-policies" title="Permalink to this headline">¶</a></h2>
<p>The driver ships with two retry policies: <code class="docutils literal notranslate"><span class="pre">DefaultRetryPolicy</span></code> –– the default ––  and
<code class="docutils literal notranslate"><span class="pre">ConsistencyDowngradingRetryPolicy</span></code>.</p>
<p>The default retry policy should be preferred in most cases as it only retries when <em>it is perfectly
safe to do so</em>, and when <em>the chances of success are high enough</em> to warrant a retry.</p>
<p><code class="docutils literal notranslate"><span class="pre">ConsistencyDowngradingRetryPolicy</span></code> is provided for cases where the application can tolerate a
temporary degradation of its consistency guarantees. Its general behavior is as follows: if, based
on the information the coordinator returns, retrying the operation with the initially requested
consistency has a chance to succeed, do it. Otherwise, if based on this information, we know that
the initially requested consistency level <em>cannot be achieved currently</em>, then:</p>
<ul class="simple">
<li><p>For writes, ignore the exception <em>if we know the write has been persisted on at least one
replica</em>.</p></li>
<li><p>For reads, try reading again at a weaker consistency level.</p></li>
</ul>
<p>Keep in mind that this may break invariants! For example, if your application relies on immediate
write visibility by writing and reading at QUORUM only, downgrading a write to ONE could cause that
write to go unnoticed by subsequent reads at QUORUM. Furthermore, this policy doesn’t always respect
datacenter locality; for example, it may downgrade LOCAL_QUORUM to ONE, and thus could accidentally
send a write that was intended for the local datacenter to another datacenter. In summary: <strong>only
use this retry policy if you understand the consequences.</strong></p>
<p>Since <code class="docutils literal notranslate"><span class="pre">DefaultRetryPolicy</span></code> is already the driver’s default retry policy, no special configuration
is required to activate it. To use <code class="docutils literal notranslate"><span class="pre">ConsistencyDowngradingRetryPolicy</span></code> instead, the following
option must be declared in the driver <a class="reference external" href="../configuration/">configuration</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>datastax-java-driver.advanced.retry-policy.class = ConsistencyDowngradingRetryPolicy
</pre></div>
</div>
<p>You can also use your own policy by specifying for the above option the fully-qualified name of a
class that implements <a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.12.0.x/api/com/datastax/oss/driver/api/core/retry/RetryPolicy.html">RetryPolicy</a>.</p>
</section>
<section id="behavior">
<h2>Behavior<a class="headerlink" href="#behavior" title="Permalink to this headline">¶</a></h2>
<p>The behavior of both policies will be detailed in the sections below.</p>
<p>The policy has several methods that cover different error cases. Each method returns a
<a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.12.0.x/api/com/datastax/oss/driver/api/core/retry/RetryVerdict.html">RetryVerdict</a>. A retry verdict essentially provides the driver with a <a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.12.0.x/api/com/datastax/oss/driver/api/core/retry/RetryDecision.html">RetryDecision</a> to indicate
what to do next. There are four possible retry decisions:</p>
<ul class="simple">
<li><p>retry on the same node;</p></li>
<li><p>retry on the next node in the <a class="reference external" href="../load_balancing/">query plan</a> for this statement;</p></li>
<li><p>rethrow the exception to the user code (from the <code class="docutils literal notranslate"><span class="pre">session.execute</span></code> call, or as a failed future if
using the asynchronous API);</p></li>
<li><p>ignore the exception. That is, mark the request as successful, and return an empty result set.</p></li>
</ul>
<section id="onunavailableverdict">
<h3><code class="docutils literal notranslate"><span class="pre">onUnavailableVerdict</span></code><a class="headerlink" href="#onunavailableverdict" title="Permalink to this headline">¶</a></h3>
<p>A request reached the coordinator, but there weren’t enough live replicas to achieve the requested
consistency level. The coordinator replied with an <code class="docutils literal notranslate"><span class="pre">UNAVAILABLE</span></code> error.</p>
<p>If the policy rethrows the error, the user code will get an <a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.12.0.x/api/com/datastax/oss/driver/api/core/servererrors/UnavailableException.html">UnavailableException</a>. You can inspect
the exception’s fields to get the amount of replicas that were known to be <em>alive</em> when the error
was triggered, as well as the amount of replicas that where <em>required</em> by the requested consistency
level.</p>
<p>The default policy triggers a maximum of one retry, to the next node in the query plan. The
rationale is that the first coordinator might have been network-isolated from all other nodes
(thinking they’re down), but still able to communicate with the client; in that case, retrying on
the same node has almost no chance of success, but moving to the next node might solve the issue.</p>
<p><code class="docutils literal notranslate"><span class="pre">ConsistencyDowngradingRetryPolicy</span></code> also triggers a maximum of one retry, but instead of trying the
next node, it will downgrade the initial consistency level, if possible, and retry <em>the same node</em>.
Note that if it is not possible to downgrade, this policy will rethrow the exception. For example,
if the original consistency level was QUORUM, and 2 replicas were required to achieve a quorum, but
only one replica is alive, then the query will be retried with consistency ONE. If no replica was
alive however, there is no point in downgrading, and the policy will rethrow.</p>
</section>
<section id="onreadtimeoutverdict">
<h3><code class="docutils literal notranslate"><span class="pre">onReadTimeoutVerdict</span></code><a class="headerlink" href="#onreadtimeoutverdict" title="Permalink to this headline">¶</a></h3>
<p>A read request reached the coordinator, which initially believed that there were enough live
replicas to process it. But one or several replicas were too slow to answer within the predefined
timeout (<code class="docutils literal notranslate"><span class="pre">read_request_timeout_in_ms</span></code> in <code class="docutils literal notranslate"><span class="pre">cassandra.yaml</span></code>); therefore the coordinator replied to the
client with a <code class="docutils literal notranslate"><span class="pre">READ_TIMEOUT</span></code> error.</p>
<p>This could be due to a temporary overloading of these replicas, or even that they just failed or
were turned off. During reads, Cassandra doesn’t request data from every replica to minimize
internal network traffic; instead, some replicas are only asked for a checksum of the data. A read
timeout may occur even if enough replicas responded to fulfill the consistency level, but only
checksum responses were received (the method’s <code class="docutils literal notranslate"><span class="pre">dataPresent</span></code> parameter allow you to check if you’re
in that situation).</p>
<p>If the policy rethrows the error, the user code will get a <a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.12.0.x/api/com/datastax/oss/driver/api/core/servererrors/ReadTimeoutException.html">ReadTimeoutException</a> (do not confuse
this error with <a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.12.0.x/api/com/datastax/oss/driver/api/core/DriverTimeoutException.html">DriverTimeoutException</a>, which happens when the coordinator didn’t reply at all to
the client).</p>
<p>The default policy triggers a maximum of one retry (to the same node), and only if enough replicas
had responded to the read request but data was not retrieved amongst those. That usually means that
enough replicas are alive to satisfy the consistency, but the coordinator picked a dead one for data
retrieval, not having detected that replica as dead yet. The reasoning is that by the time we get
the timeout, the dead replica will likely have been detected as dead and the retry has a high chance
of success.</p>
<p><code class="docutils literal notranslate"><span class="pre">ConsistencyDowngradingRetryPolicy</span></code> behaves like the default policy when enough replicas responded.
If not enough replicas responded however, it will attempt to downgrade the initial consistency
level, and retry <em>the same node</em>. If it is not possible to downgrade, this policy will rethrow the
exception.</p>
</section>
<section id="onwritetimeoutverdict">
<h3><code class="docutils literal notranslate"><span class="pre">onWriteTimeoutVerdict</span></code><a class="headerlink" href="#onwritetimeoutverdict" title="Permalink to this headline">¶</a></h3>
<p>This is similar to <code class="docutils literal notranslate"><span class="pre">onReadTimeout</span></code>, but for write operations. The reason reads and writes are
handled separately is because a read is obviously a non mutating operation, whereas a write is
likely to be. If a write times out at the coordinator level, there is no way to know whether the
mutation was applied or not on the non-answering replica.</p>
<p>If the policy rethrows the error, the user code will get a <a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.12.0.x/api/com/datastax/oss/driver/api/core/servererrors/WriteTimeoutException.html">WriteTimeoutException</a>.</p>
<p>This method is only invoked for <a class="reference external" href="../idempotence/">idempotent</a> statements. Otherwise, the driver
bypasses the retry policy and always rethrows the error.</p>
<p>The default policy triggers a maximum of one retry (to the same node), and only for a <code class="docutils literal notranslate"><span class="pre">BATCH_LOG</span></code>
write. The reasoning is that the coordinator tries to write the distributed batch log against a
small subset of nodes in the local datacenter; a timeout usually means that none of these nodes were
alive but the coordinator hadn’t detected them as dead yet. By the time we get the timeout, the dead
nodes will likely have been detected as dead, and the retry has a high chance of success.</p>
<p><code class="docutils literal notranslate"><span class="pre">ConsistencyDowngradingRetryPolicy</span></code> also triggers a maximum of one retry, but behaves differently:</p>
<ul class="simple">
<li><p>For <code class="docutils literal notranslate"><span class="pre">SIMPLE</span></code> and <code class="docutils literal notranslate"><span class="pre">BATCH</span></code> write types: if at least one replica acknowledged the write, the policy
will assume that the write will be eventually replicated, and decide to ignore the error; in other
words, it will consider that the write already succeeded, albeit with weaker consistency
guarantees: retrying is therefore useless. If no replica acknowledged the write, the policy will
rethrow the error.</p></li>
<li><p>For <code class="docutils literal notranslate"><span class="pre">UNLOGGED_BATCH</span></code> write type: since only part of the batch could have been persisted, the
policy will attempt to downgrade the consistency level and retry <em>on the same node</em>. If
downgrading is not possible, the policy will rethrow.</p></li>
<li><p>For <code class="docutils literal notranslate"><span class="pre">BATCH_LOG</span></code> write type: the policy will retry the same node, for the reasons explained above.</p></li>
<li><p>For other write types: the policy will always rethrow.</p></li>
</ul>
</section>
<section id="onrequestabortedverdict">
<h3><code class="docutils literal notranslate"><span class="pre">onRequestAbortedVerdict</span></code><a class="headerlink" href="#onrequestabortedverdict" title="Permalink to this headline">¶</a></h3>
<p>The request was aborted before we could get a response from the coordinator. This can happen in two
cases:</p>
<ul class="simple">
<li><p>if the connection was closed due to an external event. This will manifest as a
<a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.12.0.x/api/com/datastax/oss/driver/api/core/connection/ClosedConnectionException.html">ClosedConnectionException</a> (network failure) or <a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.12.0.x/api/com/datastax/oss/driver/api/core/connection/HeartbeatException.html">HeartbeatException</a> (missed
<a class="reference external" href="../pooling/#heartbeat">heartbeat</a>);</p></li>
<li><p>if there was an unexpected error while decoding the response (this can only be a driver bug).</p></li>
</ul>
<p>This method is only invoked for <a class="reference external" href="../idempotence/">idempotent</a> statements. Otherwise, the driver
bypasses the retry policy and always rethrows the error.</p>
<p>Both the default policy and <code class="docutils literal notranslate"><span class="pre">ConsistencyDowngradingRetryPolicy</span></code> retry on the next node if the
connection was closed, and rethrow (assuming a driver bug) in all other cases.</p>
</section>
<section id="onerrorresponseverdict">
<h3><code class="docutils literal notranslate"><span class="pre">onErrorResponseVerdict</span></code><a class="headerlink" href="#onerrorresponseverdict" title="Permalink to this headline">¶</a></h3>
<p>The coordinator replied with an error other than <code class="docutils literal notranslate"><span class="pre">READ_TIMEOUT</span></code>, <code class="docutils literal notranslate"><span class="pre">WRITE_TIMEOUT</span></code> or <code class="docutils literal notranslate"><span class="pre">UNAVAILABLE</span></code>.
Namely, this covers <a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.12.0.x/api/com/datastax/oss/driver/api/core/servererrors/OverloadedException.html">OverloadedException</a>, <a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.12.0.x/api/com/datastax/oss/driver/api/core/servererrors/ServerError.html">ServerError</a>, <a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.12.0.x/api/com/datastax/oss/driver/api/core/servererrors/TruncateException.html">TruncateException</a>,
<a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.12.0.x/api/com/datastax/oss/driver/api/core/servererrors/ReadFailureException.html">ReadFailureException</a> and <a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.12.0.x/api/com/datastax/oss/driver/api/core/servererrors/WriteFailureException.html">WriteFailureException</a>.</p>
<p>This method is only invoked for <a class="reference external" href="../idempotence/">idempotent</a> statements. Otherwise, the driver
bypasses the retry policy and always rethrows the error.</p>
<p>Both the default policy and <code class="docutils literal notranslate"><span class="pre">ConsistencyDowngradingRetryPolicy</span></code> rethrow read and write failures,
and retry other errors on the next node.</p>
</section>
</section>
<section id="hard-coded-rules">
<h2>Hard-coded rules<a class="headerlink" href="#hard-coded-rules" title="Permalink to this headline">¶</a></h2>
<p>There are a few cases where retrying is always the right thing to do. These are not covered by
<code class="docutils literal notranslate"><span class="pre">RetryPolicy</span></code>, but instead hard-coded in the driver:</p>
<ul class="simple">
<li><p><strong>any error before a network write was attempted</strong>: to send a query, the driver selects a node,
borrows a connection from the host’s <a class="reference external" href="../pooling/">connection pool</a>, and then writes the message
to the connection. Errors can occur before the write was even attempted, for example if the
connection pool is saturated, or if the node went down right after we borrowed. In those cases, it
is always safe to retry since the request wasn’t sent, so the driver will transparently move to
the next node in the query plan.</p></li>
<li><p><strong>re-preparing a statement</strong>: when the driver executes a prepared statement, it may find out that
the coordinator doesn’t know about it, and need to re-prepare it on the fly (this is described in
detail <a class="reference external" href="../statements/prepared/">here</a>). The query is then retried on the same node.</p></li>
<li><p><strong>trying to communicate with a node that is bootstrapping</strong>: this is a rare edge case, as in
practice the driver should never try to communicate with a bootstrapping node (the only way is if
it was specified as a contact point). It is again safe to assume that the query was not executed
at all, so the driver moves to the next node.</p></li>
</ul>
<p>Similarly, some errors have no chance of being solved by a retry. They will always be rethrown
directly to the user. These include:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.12.0.x/api/com/datastax/oss/driver/api/core/servererrors/QueryValidationException.html">QueryValidationException</a> and any of its subclasses;</p></li>
<li><p><a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.12.0.x/api/com/datastax/oss/driver/api/core/servererrors/FunctionFailureException.html">FunctionFailureException</a>;</p></li>
<li><p><a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.12.0.x/api/com/datastax/oss/driver/api/core/servererrors/ProtocolError.html">ProtocolError</a>.</p></li>
</ul>
</section>
<section id="using-multiple-policies">
<h2>Using multiple policies<a class="headerlink" href="#using-multiple-policies" title="Permalink to this headline">¶</a></h2>
<p>The retry policy can be overridden in <a class="reference external" href="../configuration/#profiles">execution profiles</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>datastax-java-driver {
  advanced.retry-policy {
    class = DefaultRetryPolicy
  }
  profiles {
    custom-retries {
      advanced.retry-policy {
        class = CustomRetryPolicy
      }
    }
    slow {
      request.timeout = 30 seconds
    }
  }
}
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">custom-retries</span></code> profile uses a dedicated policy. The <code class="docutils literal notranslate"><span class="pre">slow</span></code> profile inherits the default
profile’s. Note that this goes beyond configuration inheritance: the driver only creates a single
<code class="docutils literal notranslate"><span class="pre">DefaultRetryPolicy</span></code> instance and reuses it (this also occurs if two sibling profiles have the same
configuration).</p>
<p>Each request uses its declared profile’s policy. If it doesn’t declare any profile, or if the
profile doesn’t have a dedicated policy, then the default profile’s policy is used.</p>
</section>
</section>

                
                    <div class="post-content"><div class="content-navigation">
    <div class="navigation navigation--prev">
        
            <a class="navigation__link" href="../request_tracker/index.html">
                <button class="navigation__button">
                    <i class="scylla-icon scylla-icon--chevron-left"></i>
                </button>
                <div class="navigation__title">
                    <span class="colored">PREVIOUS</span> <br />Request tracker
                </div>
            </a>
        
    </div>
    <div class="navigation navigation--next">
        
            <a class="navigation__link" href="../shaded_jar/index.html">
                <div class="navigation__title">
                    <span class="colored">NEXT</span> <br />Using the shaded JAR
                </div>
                <button class="navigation__button">
                    <i class="scylla-icon scylla-icon--chevron-right"></i>
                </button>
            </a>
        
    </div>
</div></div>
                
            </div>
            <div class="sidebar-left  large-order-1">
                
                    
                        <div id="side-nav" class="side-nav custom-scroll-bar" data-closable data-toggler=".show">
    <button class="collapsible-button">
        <i class="scylla-icon scylla-icon--chevron-left"></i>
    </button>
    <div class="side-nav-content">
        <div class="side-nav__search">
            <div class="search-box">
                <ci-search></ci-search>
            </div>
        </div>
        <div class="side-nav__versions">
    <ul class="dropdown menu scylla-dropdown scylla-dropdown--versions" data-dropdown-menu>
        <li class="scylla-dropdown__item">
            <a class="scylla-dropdown__title" href="#">
                
                    4.12.0.x
                
                <i class="chevron scylla-icon scylla-icon--chevron-right"></i>
            </a>
            <ul class="menu scylla-dropdown__content">
                
                    
                        <li>
                            <a href="../../../../stable/index.html">4.13.0.x</a>
                        </li>
                    
                
                    
                        <li>
                            <a href="index.html">4.12.0.x</a>
                        </li>
                    
                
                    
                        <li>
                            <a href="../../../../scylla-4.11.1.x/index.html">4.11.1.x</a>
                        </li>
                    
                
                    
                        <li>
                            <a href="../../../../scylla-4.10.0.x/index.html">4.10.0.x</a>
                        </li>
                    
                
                    
                        <li>
                            <a href="../../../../scylla-4.7.2.x/index.html">4.7.2.x</a>
                        </li>
                    
                
                    
                        <li>
                            <a href="../../../../scylla-3.11.2.x/index.html">3.11.2.x</a>
                        </li>
                    
                
                    
                        <li>
                            <a href="../../../../scylla-3.11.0.x/index.html">3.11.0.x</a>
                        </li>
                    
                
                    
                        <li>
                            <a href="../../../../scylla-3.10.2.x/index.html">3.10.2.x</a>
                        </li>
                    
                
                    
                        <li>
                            <a href="../../../../scylla-3.7.2.x/index.html">3.7.2.x</a>
                        </li>
                    
                
                
            </ul>
        </li>
    </ul>
</div>
        <div class="side-nav__content">
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Java Driver for Scylla and Apache Cassandra®</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api.html">API Documentation</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../../index.html">Manual</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../api_conventions/index.html">API conventions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../case_sensitivity/index.html">Case sensitivity</a></li>
<li class="toctree-l2 current has-children"><a class="reference internal" href="../index.html">Core driver</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label for="toctree-checkbox-2"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../address_resolution/index.html">Address resolution</a></li>
<li class="toctree-l3"><a class="reference internal" href="../async/index.html">Asynchronous programming</a></li>
<li class="toctree-l3"><a class="reference internal" href="../authentication/index.html">Authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="../bom/index.html">Bill of Materials (BOM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../compression/index.html">Compression</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../configuration/index.html">Configuration</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label for="toctree-checkbox-3"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l4"><a class="reference internal" href="../configuration/reference/README.html">Reference configuration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../control_connection/index.html">Control connection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../custom_codecs/index.html">Custom codecs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../detachable_types/index.html">Detachable types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../idempotence/index.html">Query idempotence</a></li>
<li class="toctree-l3"><a class="reference internal" href="../integration/index.html">Integration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../load_balancing/index.html">Load balancing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../logging/index.html">Logging</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../metadata/index.html">Metadata</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label for="toctree-checkbox-4"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l4"><a class="reference internal" href="../metadata/node/index.html">Node metadata</a></li>
<li class="toctree-l4"><a class="reference internal" href="../metadata/schema/index.html">Schema metadata</a></li>
<li class="toctree-l4"><a class="reference internal" href="../metadata/token/index.html">Token metadata</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../metrics/index.html">Metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../native_protocol/index.html">Native protocol</a></li>
<li class="toctree-l3"><a class="reference internal" href="../non_blocking/index.html">Non-blocking programming</a></li>
<li class="toctree-l3"><a class="reference internal" href="../paging/index.html">Paging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../performance/index.html">Performance</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pooling/index.html">Connection pooling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../query_timestamps/index.html">Query timestamps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reactive/index.html">Reactive Style Programming</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reconnection/index.html">Reconnection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../request_tracker/index.html">Request tracker</a></li>
<li class="toctree-l3 current current-page"><a class="current reference internal" href="#">Retries</a></li>
<li class="toctree-l3"><a class="reference internal" href="../shaded_jar/index.html">Using the shaded JAR</a></li>
<li class="toctree-l3"><a class="reference internal" href="../speculative_execution/index.html">Speculative query execution</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ssl/index.html">SSL</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../statements/index.html">Statements</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label for="toctree-checkbox-5"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l4"><a class="reference internal" href="../statements/batch/index.html">Batch statements</a></li>
<li class="toctree-l4"><a class="reference internal" href="../statements/per_query_keyspace/index.html">Per-query keyspace</a></li>
<li class="toctree-l4"><a class="reference internal" href="../statements/prepared/index.html">Prepared statements</a></li>
<li class="toctree-l4"><a class="reference internal" href="../statements/simple/index.html">Simple statements</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../temporal_types/index.html">Temporal types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../throttling/index.html">Request throttling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tracing/index.html">Query tracing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tuples/index.html">Tuples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../udts/index.html">User-defined types</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../developer/index.html">Developer docs</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label for="toctree-checkbox-6"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../developer/admin/index.html">Administrative tasks</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../developer/common/index.html">Common infrastructure</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label for="toctree-checkbox-7"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l4"><a class="reference internal" href="../../developer/common/concurrency/index.html">Concurrency</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer/common/context/index.html">Driver context</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer/common/event_bus/index.html">Event bus</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../developer/native_protocol/index.html">Native protocol layer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../developer/netty_pipeline/index.html">Netty pipeline</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../developer/request_execution/index.html">Request execution</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../mapper/index.html">Mapper</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label for="toctree-checkbox-8"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../mapper/config/index.html">Integration</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label for="toctree-checkbox-9"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l4"><a class="reference internal" href="../../mapper/config/kotlin/index.html">Kotlin</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../mapper/config/lombok/index.html">Lombok</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../mapper/config/record/index.html">Java 14 Records</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../mapper/config/scala/index.html">Scala</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../mapper/daos/index.html">DAOs</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label for="toctree-checkbox-10"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l4"><a class="reference internal" href="../../mapper/daos/custom_types/index.html">Custom result types</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../mapper/daos/delete/index.html">Delete methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../mapper/daos/getentity/index.html">GetEntity methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../mapper/daos/increment/index.html">Increment methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../mapper/daos/insert/index.html">Insert methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../mapper/daos/null_saving/index.html">Null saving strategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../mapper/daos/query/index.html">Query methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../mapper/daos/queryprovider/index.html">Query provider methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../mapper/daos/select/index.html">Select methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../mapper/daos/setentity/index.html">SetEntity methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../mapper/daos/statement_attributes/index.html">Statement attributes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../mapper/daos/update/index.html">Update methods</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../mapper/entities/index.html">Entities</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../mapper/mapper/index.html">Mapper interface</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../osgi/index.html">OSGi</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../query_builder/index.html">Query builder</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label for="toctree-checkbox-11"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../query_builder/condition/index.html">Conditions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../query_builder/delete/index.html">DELETE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../query_builder/idempotence/index.html">Idempotence in the query builder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../query_builder/insert/index.html">INSERT</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../query_builder/relation/index.html">Relations</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../query_builder/schema/index.html">Schema builder</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/><label for="toctree-checkbox-12"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l4"><a class="reference internal" href="../../query_builder/schema/aggregate/index.html">Aggregate</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../query_builder/schema/function/index.html">Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../query_builder/schema/index/index.html">Index</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../query_builder/schema/keyspace/index.html">Keyspace</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../query_builder/schema/materialized_view/index.html">Materialized View</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../query_builder/schema/table/index.html">Table</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../query_builder/schema/type/index.html">Type</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../query_builder/select/index.html">SELECT</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../query_builder/term/index.html">Terms</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../query_builder/truncate/index.html">TRUNCATE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../query_builder/update/index.html">UPDATE</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../upgrade_guide/index.html">Upgrade guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq/index.html">Frequently asked questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog/index.html">Changelog</a></li>
</ul>

        </div>
    </div>
</div>
                    
                
            </div>
            
                <div class="sidebar-right large-order-3">
                    <div class="secondary-side-nav custom-scroll-bar">
    
    <ul class="contribute">
        <li class="contribute__item">
            <a href="https://github.com/scylladb/java-driver/issues/new?title=Issue in page Retries&&body=I%20would%20like%20to%20report%20an%20issue%20in%20page%20https://java-driver.docs.scylladb.com/scylla-4.12.0.x/manual/core/retries/index%0A%0A%23%23%23%20Problem%0A%0A%23%23%23%20%20Suggest%20a%20fix"
                target="_blank">
                <i class="icon fab fa-github" aria-hidden="true"></i>Create an issue
            </a>
        </li>
        
            <li class="contribute__item">
                
                
                    
                        
                    
                
                <a href="https://github.com/scylladb/java-driver/edit/scylla-4.12.0.x/docs/source/manual/core/retries/index.md"
                    target="_blank">
                    <i class="icon fa fa-edit" aria-hidden="true"></i>Edit this page
                </a>
            </li>
        
    </ul>

    
        <div class="secondary-side-nav__content">
            <p class="topic-title">On this page</p>
            <ul>
<li><a class="reference internal" href="#">Retries</a><ul>
<li><a class="reference internal" href="#quick-overview">Quick overview</a></li>
<li><a class="reference internal" href="#built-in-retry-policies">Built-in retry policies</a></li>
<li><a class="reference internal" href="#behavior">Behavior</a><ul>
<li><a class="reference internal" href="#onunavailableverdict"><code class="docutils literal notranslate"><span class="pre">onUnavailableVerdict</span></code></a></li>
<li><a class="reference internal" href="#onreadtimeoutverdict"><code class="docutils literal notranslate"><span class="pre">onReadTimeoutVerdict</span></code></a></li>
<li><a class="reference internal" href="#onwritetimeoutverdict"><code class="docutils literal notranslate"><span class="pre">onWriteTimeoutVerdict</span></code></a></li>
<li><a class="reference internal" href="#onrequestabortedverdict"><code class="docutils literal notranslate"><span class="pre">onRequestAbortedVerdict</span></code></a></li>
<li><a class="reference internal" href="#onerrorresponseverdict"><code class="docutils literal notranslate"><span class="pre">onErrorResponseVerdict</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#hard-coded-rules">Hard-coded rules</a></li>
<li><a class="reference internal" href="#using-multiple-policies">Using multiple policies</a></li>
</ul>
</li>
</ul>

        </div>
    
</div>
                </div>
            
        </section>

        <footer class="footer">
    <div class="footer-group">
        <div class="footer-top">
            <a class="footer-logo" href="https://www.scylladb.com">
                <img src="../../../_static/img/logo-scylla-horizontal-RGB.svg" alt="Logo" />
            </a>
            <div class="footer-links">
                <a class="footer-links__link" href="https://docs.scylladb.com/">Docs</a>
                <a class="footer-links__link" href="https://www.scylladb.com/company/contact-us/">Contact Us</a>
                <a class="footer-links__link" href="https://www.scylladb.com/company/">About Us</a>
            </div>
            <div class="footer-actions">
                <a class="footer-actions__link" href="https://groups.google.com/g/scylladb-users" target="_blank">
                    <span data-tooltip tabindex="1" title="User mailing list" data-position="bottom">
                        <img src="../../../_static/img/icons/icon-mail-list.svg" alt="Mail List Icon" />
                    </span>
                </a>
                <a class="footer-actions__link" href="http://slack.scylladb.com/" target="_blank">
                    <span data-tooltip tabindex="1" title="User Slack channel" data-position="bottom">
                        <img src="../../../_static/img/icons/icon-slack.svg" alt="Slack Icon" />
                    </span>
                </a>
            </div>
        </div>

        <div class="footer-bottom">
            
                <div class="footer-bottom__copyright">
                    
                        
                            &#169; 2022, ScyllaDB. All rights reserved.
                        
                    
                </div>
            
            
                <div class="footer-bottom__last-updated">
                    
                        Last updated on 25 May 2022.
                    
                </div>
            
            <div class="footer-bottom__version">
                Powered by
                <a href="http://sphinx-doc.org/">Sphinx 4.3.2</a> &amp;
                <a href="https://sphinx-theme.scylladb.com/">ScyllaDB Theme 1.2.2</a>
            </div>
        </div>
    </div>
</footer>

        <noscript>
            <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T8P2JP" height="0" width="0"
                style="display: none; visibility: hidden"></iframe>
        </noscript>
    </body>

</html>