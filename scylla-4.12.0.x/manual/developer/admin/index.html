

<!DOCTYPE html>
<html class="no-js" lang="en">
    
    

    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width initial-scale=1" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>
             Administrative tasks | Scylla Docs 
        </title>
        <meta name="description" content="Scylla is an Apache Cassandra-compatible NoSQL data store that can handle 1 million transactions per second on a single server." />
        <link rel="icon" href="../../../_static/img/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="../../../_static/img/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" href="../../../_static/img/favicon-228x228.png" sizes="192x192" />
        <link rel="apple-touch-icon" href="../../../_static/img/favicon-228x228.png" />
        <meta name="msapplication-TileImage" href="../../../_static/img/favicon-228x228.png" />

        
            
        

        
            
            <link rel="canonical" href="https://java-driver.docs.scylladb.com/stable/manual/developer/admin/"/>
        

        <link rel="author" href="mailto:info@scylladb.com" />

        
            
        <!-- increase expertrec loading priority-->
        <link rel="dns-prefetch" href="https://cse.expertrec.com">

        <!-- increase font loading priority -->
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link rel="preload" as="style"
            href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />

        <!-- async CSS -->
        <link rel="stylesheet" media="print" onload="this.onload=null;this.removeAttribute('media');"
            href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />

        <!-- no-JS fallback -->
        <noscript>
            <link rel="stylesheet"
                href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />
        </noscript>
        
            
                <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
            
        
            
                <link rel="stylesheet" type="text/css" href="../../../_static/css/main.css" />
            
        
            
                <link rel="stylesheet" type="text/css" href="../../../_static/sphinx_collapse.css" />
            
        
            
                <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
            
        
    
        
        
            

        <script type="text/javascript" id="documentation_options" data-url_root="../../../"
            src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/js/runtime.bundle.js"></script>
        <script type="text/javascript" src="../../../_static/js/main.bundle.js"></script>
        
            
                <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
            
        
            
        
            
                <script src="../../../_static/underscore.js"></script>
            
        
            
                <script src="../../../_static/doctools.js"></script>
            
        
            
                <script src="../../../_static/clipboard.min.js"></script>
            
        
            
                <script src="../../../_static/copybutton.js"></script>
            
        
    
            <!-- Google Tag Manager -->
<script>
    (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({
            "gtm.start": new Date().getTime(),
            event: "gtm.js"
        });
        var f = d.getElementsByTagName(s)[0],
        j = d.createElement(s),
        dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
    })(window, document, "script", "dataLayer", "GTM-T8P2JP");
</script>
<!-- End Google Tag Manager -->

<!-- Expertrec -->
<script>
    var id = "e2077224-9ccf-11e9-a0c9-0242ac130002";
    var ci_search = document.createElement("script");
    ci_search.type = "text/javascript";
    ci_search.async = true;
    ci_search.src = "https://cse.expertrec.com/api/js/ci_common.js?id=" + id;
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(ci_search, s);
</script>
<!-- End Expertrec -->
        
        <!-- Font Awesome -->
        <script src="https://kit.fontawesome.com/b1870adf6a.js" crossorigin="anonymous"></script>
        <!-- End Font Awesome -->
    </head>

    <body>
        
        <header class="header">
    <div class="header-logo">
        <a class="header-logo__img" href="https://scylladb.com/">
            <img src="../../../_static/img/logo-docs.svg" alt="Scylla Documentation Logo" />
        </a>
        <span class="header-logo__bar"></span>
        <a class="header-logo__text" href="https://docs.scylladb.com/">
            Documentation
        </a>
    </div>
    <div class="header-navigation">
        <ul class="dropdown menu scylla-dropdown scylla-dropdown--header" data-dropdown-menu>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Server
                    <i class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--about-us"></i>
                            Scylla Open Source
                        </a>
                    </li>
                    <li>
                        <a href="https://docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--enterprise"></i>Scylla Enterprise
                        </a>
                    </li>
                    <li>
                        <a href="https://scylla.docs.scylladb.com/stable/alternator/alternator.html">
                            <i class="scylla-icon scylla-icon--overview"></i>
                            Scylla Alternator
                        </a>
                    </li>
                </ul>
            </li>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Cloud <i
                    class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://cloud.scylladb.com/">
                            <i class="scylla-icon scylla-icon--cloud"></i>Scylla Cloud</a>
                    </li>
                    <li>
                        <a href="https://docs.scylladb.com/scylla-cloud/">
                            <i class="scylla-icon scylla-icon--cloud-docs"></i>Scylla Cloud
                            Docs</a>
                    </li>
                </ul>
            </li>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Tools <i
                    class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://manager.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--manager"></i>Scylla Manager</a>
                    </li>
                    <li>
                        <a href="https://monitoring.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--monitoring"></i>Scylla
                            Monitoring Stack</a>
                    </li>
                    <li>
                        <a href="https://operator.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--operator"></i>Scylla Operator
                        </a>
                    </li>
                </ul>
            </li>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Drivers <i
                    class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://docs.scylladb.com/using-scylla/drivers/cql-drivers/">
                            <i class="scylla-icon scylla-icon--nsql-guides"></i>CQL Drivers
                        </a>
                    </li>
                    <li>
                        <a href="https://docs.scylladb.com/using-scylla/drivers/dynamo-drivers/">
                            <i class="scylla-icon scylla-icon--overview"></i>DynamoDB Drivers
                        </a>
                    </li>
                </ul>
            </li>
        </ul>
        <div class="header-button">
            <a href="https://www.scylladb.com/download/" class="button">Download</a>
        </div>
    </div>
    <div class="header-search-box">
        <div class="search-box">
            <ci-search></ci-search>
        </div>
    </div>
    <div class="side-nav-toggle" data-toggle="side-nav">
    <div class="side-nav-toggle__button">
        <img src="../../../_static/img/menu.svg" alt="Menu" />
    </div>
</div>
</header>
        <section
            class="layout  layout--sidebar layout--has-secondary-sidebar ">
            <div class="content large-order-2">
                
                    
    <div class="admonition caution">
        <p class="admonition-title">Caution</p>
        <p>
            
                You're viewing documentation for a previous version of Scylla Java Driver.
            
            <a href="../../../../stable/index.html">Switch to the latest stable version.</a>
        </p>
    </div>

                
                
                    <div class="pre-content">
                        <div class="breadcrumbs">
    <span class="bread__item">
        <a href="https://java-driver.docs.scylladb.com"
            class="bread__highlight">
            <i class="fas fa-home"></i> Scylla Java Driver
        </a>
    </span>
    
        <span class="bread__item">
            <a href="../../index.html">
                Manual
            </a>
        </span>
    
        <span class="bread__item">
            <a href="../index.html">
                Developer docs
            </a>
        </span>
    
    <span class="bread__item bread__item--last">Administrative tasks</span>
</div>
                    </div>
                
                <section id="administrative-tasks">
<h1>Administrative tasks<a class="headerlink" href="#administrative-tasks" title="Permalink to this headline">¶</a></h1>
<p>Aside from the main task of <a class="reference external" href="../request_execution">executing user requests</a>, the driver also needs
to track cluster state and metadata. This is done with a number of administrative components:</p>
<div class="highlight-ditaa notranslate"><div class="highlight"><pre><span></span>                                 +---------------+
                                 <span class="p">|</span> DriverChannel <span class="p">|</span>
                                 +-------+-------+
                                         <span class="p">|</span><span class="m">1</span>
                                         <span class="p">|</span>                 topology
+-----------------+    query   +---------+---------+        events
<span class="p">|</span> TopologyMonitor +------+----&gt;<span class="p">|</span> ControlConnection +-----------------+
+-----------------+      <span class="p">|</span>     +---------+---------+                 <span class="p">|</span>
         ^               <span class="p">|</span>               <span class="p">|</span>                           <span class="p">|</span>
         <span class="p">|</span>               <span class="p">|</span>               <span class="p">|</span>     topology+channel      V
   get   <span class="p">|</span>     +---------+        refresh<span class="p">|</span>          events      +----------+
node info<span class="p">|</span>     <span class="p">|</span>                  schema <span class="p">|</span>         +------------+ EventBus <span class="p">|</span>
         <span class="p">|</span>     <span class="p">|</span>                         <span class="p">|</span>         <span class="p">|</span>            +-+--------+
+--------+-----+--+                      <span class="p">|</span>         <span class="p">|</span>              ^      ^
<span class="p">|</span> MetadataManager <span class="p">|</span>&lt;-------+-------------+         <span class="p">|</span>          node<span class="p">|</span>      <span class="p">|</span>
+--------+-------++        <span class="p">|</span>                       <span class="p">|</span>         state<span class="p">|</span>      <span class="p">|</span>
         <span class="p">|</span>       <span class="p">|</span>         <span class="p">|</span> add/remove            v        events<span class="p">|</span>      <span class="p">|</span>
         <span class="p">|</span><span class="m">1</span>      <span class="p">|</span>         <span class="p">|</span>   node     +------------------+      <span class="p">|</span>      <span class="p">|</span>
   +-----+----+  <span class="p">|</span>         +------------+ NodeStateManager +------+      <span class="p">|</span>
   <span class="p">|</span> Metadata <span class="p">|</span>  <span class="p">|</span>                      +------------------+             <span class="p">|</span>
   +----------+  <span class="p">|</span>                                                       <span class="p">|</span>
                 +-------------------------------------------------------+
                               metadata changed events
</pre></div>
</div>
<p>Note: the event bus is covered in the <a class="reference external" href="../common/event_bus">common infrastructure</a> section.</p>
<section id="control-connection">
<h2>Control connection<a class="headerlink" href="#control-connection" title="Permalink to this headline">¶</a></h2>
<p>The goal of the control connection is to maintain a dedicated <code class="docutils literal notranslate"><span class="pre">DriverChannel</span></code> instance, used to:</p>
<ul class="simple">
<li><p>listen for server-side protocol events:</p>
<ul>
<li><p>topology events (<code class="docutils literal notranslate"><span class="pre">NEW_NODE</span></code>, <code class="docutils literal notranslate"><span class="pre">REMOVED_NODE</span></code>) and status events (<code class="docutils literal notranslate"><span class="pre">UP</span></code>, <code class="docutils literal notranslate"><span class="pre">DOWN</span></code>) are published on
the event bus, to be processed by other components;</p></li>
<li><p>schema events are propagated directly to the metadata manager, to trigger a refresh;</p></li>
</ul>
</li>
<li><p>provide a way to query system tables. In practice, this is used by:</p>
<ul>
<li><p>the topology monitor, to read node information from <code class="docutils literal notranslate"><span class="pre">system.local</span></code> and <code class="docutils literal notranslate"><span class="pre">system.peers</span></code>;</p></li>
<li><p>the metadata manager, to read schema metadata from <code class="docutils literal notranslate"><span class="pre">system_schema.*</span></code>.</p></li>
</ul>
</li>
</ul>
<p>It has its own reconnection mechanism (if the channel goes down, a new one will be opened to another
node in the cluster) and some logic for initialization and shutdown.</p>
<p>Note that the control connection is really just an implementation detail of the metadata manager and
topology monitor: if those components are overridden with custom versions that use other means to
get their data, the driver will detect it and not initialize the control connection (at the time of
writing, the session also references the control connection directly, but that’s a bug:
<a class="reference external" href="https://datastax-oss.atlassian.net/browse/JAVA-2473">JAVA-2473</a>).</p>
</section>
<section id="metadata-manager">
<h2>Metadata manager<a class="headerlink" href="#metadata-manager" title="Permalink to this headline">¶</a></h2>
<p>This component is responsible for maintaining the contents of
<a class="reference external" href="../../core/metadata/">session.getMetadata()</a>.</p>
<p>One big improvement in driver 4 is that the <code class="docutils literal notranslate"><span class="pre">Metadata</span></code> object is immutable and updated atomically;
this guarantees a consistent view of the cluster at a given point in time. For example, if a
keyspace name is referenced in the token map, there will always be a corresponding
<code class="docutils literal notranslate"><span class="pre">KeyspaceMetadata</span></code> in the schema metadata.</p>
<p><code class="docutils literal notranslate"><span class="pre">MetadataManager</span></code> keeps the current <code class="docutils literal notranslate"><span class="pre">Metadata</span></code> instance in a volatile field. Each transition is
managed by a <code class="docutils literal notranslate"><span class="pre">MetadataRefresh</span></code> object that computes the new metadata, along with an optional list of
events to publish on the bus (e.g. table created, keyspace removed, etc.) The new metadata is then
written back to the volatile field. <code class="docutils literal notranslate"><span class="pre">MetadataManager</span></code> follows the <a class="reference external" href="../common/concurrency/#cold-path">confined inner
class</a> pattern to ensure that all refreshes are applied serially,
from a single admin thread. This guarantees that two refreshes can’t start from the same initial
state and overwrite each other.</p>
<p>There are various types of refreshes targeting nodes, the schema or the token map.</p>
<p>Note that, unlike driver 3, we only do full schema refreshes. This simplifies the code considerably,
and thanks to debouncing this should not affect performance. The schema refresh process uses a few
auxiliary components that may have different implementations depending on the Cassandra version:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SchemaQueries</span></code>: launches the schema queries asynchronously, and assemble the result in a
<code class="docutils literal notranslate"><span class="pre">SchemaRows</span></code>;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SchemaParser</span></code>: turns the <code class="docutils literal notranslate"><span class="pre">SchemaRows</span></code> into the <code class="docutils literal notranslate"><span class="pre">SchemaRefresh</span></code>.</p></li>
</ul>
<p>When the metadata manager needs node-related data, it queries the topology monitor. When it needs
schema-related data, it uses the control connection directly to issue its queries.</p>
</section>
<section id="topology-monitor">
<h2>Topology monitor<a class="headerlink" href="#topology-monitor" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">TopologyMonitor</span></code> abstracts how we get information about nodes in the cluster:</p>
<ul class="simple">
<li><p>refresh the list of nodes;</p></li>
<li><p>refresh an individual node, or load the information of a newly added node;</p></li>
<li><p>check schema agreement;</p></li>
<li><p>emit <code class="docutils literal notranslate"><span class="pre">TopologyEvent</span></code> instances on the bus when we get external signals suggesting topology changes
(node added or removed), or status changes (node down or up).</p></li>
</ul>
<p>The built-in implementation uses the control connection to query <code class="docutils literal notranslate"><span class="pre">system.local</span></code> and <code class="docutils literal notranslate"><span class="pre">system.peers</span></code>,
and listen to gossip events.</p>
</section>
<section id="node-state-manager">
<h2>Node state manager<a class="headerlink" href="#node-state-manager" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">NodeStateManager</span></code> tracks the state of the nodes in the cluster.</p>
<p>We can’t simply trust gossip events because they are not always reliable (the coordinator can become
isolated and think other nodes are down). Instead, the driver uses more elaborate rules that combine
external signals with observed internal state:</p>
<ul class="simple">
<li><p>as long as we have an active connection to a node, it is considered up, whatever gossip events
say;</p></li>
<li><p>if all connections to a node are lost, and its pool has started reconnecting, it gets marked down
(we check the reconnection because the pool could have shut down for legitimate reasons, like the
node distance changing to IGNORED);</p></li>
<li><p>a node is marked back up when the driver has successfully reopened at least one connection;</p></li>
<li><p>if the driver is not actively trying to connect to a node (for example if it is at distance
IGNORED), then gossip events are applied directly.</p></li>
</ul>
<p>See the javadocs of <code class="docutils literal notranslate"><span class="pre">NodeState</span></code> and <code class="docutils literal notranslate"><span class="pre">TopologyEvent</span></code>, as well as the <code class="docutils literal notranslate"><span class="pre">NodeStateManager</span></code>
implementation itself, for more details.</p>
<section id="topology-events-vs-node-state-events">
<h3>Topology events vs. node state events<a class="headerlink" href="#topology-events-vs-node-state-events" title="Permalink to this headline">¶</a></h3>
<p>These two event types are related, but they’re used at different stages:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">TopologyEvent</span></code> is an external signal about the state of a node (by default, a <code class="docutils literal notranslate"><span class="pre">TOPOLOGY_CHANGE</span></code>
or <code class="docutils literal notranslate"><span class="pre">STATUS_CHANGE</span></code> gossip event received on the control connection). This is considered as a mere
suggestion, that the driver may or may not decide to follow;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NodeStateEvent</span></code> is an actual decision made by the driver to change a node to a given state.</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">NodeStateManager</span></code> essentially transforms topology events, as well as other internal signals, into
node state events.</p>
<p>In general, other driver components only react to node state events, but there are a few exceptions:
for example, if a connection pool is reconnecting and the next attempt is scheduled in 5 minutes,
but a SUGGEST_UP topology event is emitted, the pool tries to reconnect immediately.</p>
<p>The best way to find where each event is used is to do a usage search of the event type.</p>
</section>
</section>
<section id="how-admin-components-work-together">
<h2>How admin components work together<a class="headerlink" href="#how-admin-components-work-together" title="Permalink to this headline">¶</a></h2>
<p>Most changes to the cluster state will involve the coordinated effort of multiple admin components.
Here are a few examples:</p>
<section id="a-new-node-gets-added">
<h3>A new node gets added<a class="headerlink" href="#a-new-node-gets-added" title="Permalink to this headline">¶</a></h3>
<div class="highlight-ditaa notranslate"><div class="highlight"><pre><span></span>+-----------------+   +--------+ +----------------+ +---------------+ +---------------+
<span class="p">|</span>ControlConnection<span class="p">|</span>   <span class="p">|</span>EventBus<span class="p">|</span> <span class="p">|</span>NodeStateManager<span class="p">|</span> <span class="p">|</span>MetadataManager<span class="p">|</span> <span class="p">|</span>TopologyMonitor<span class="p">|</span>
+--------+--------+   +---+----+ +--------+-------+ +-------+-------+ +-------+-------+
         <span class="p">|</span>                <span class="p">|</span>               <span class="p">|</span>                 <span class="p">|</span>                 <span class="p">|</span>
+--------+-------+        <span class="p">|</span>               <span class="p">|</span>                 <span class="p">|</span>                 <span class="p">|</span>
<span class="p">|</span>Receive NEW_NODE<span class="p">|</span>        <span class="p">|</span>               <span class="p">|</span>                 <span class="p">|</span>                 <span class="p">|</span>
<span class="p">|</span>gossip event    <span class="p">|</span>        <span class="p">|</span>               <span class="p">|</span>                 <span class="p">|</span>                 <span class="p">|</span>
<span class="p">|</span>             <span class="o">{</span>d<span class="o">}</span><span class="p">|</span>        <span class="p">|</span>               <span class="p">|</span>                 <span class="p">|</span>                 <span class="p">|</span>
+--------+-------+        <span class="p">|</span>               <span class="p">|</span>                 <span class="p">|</span>                 <span class="p">|</span>
         <span class="p">|</span>                <span class="p">|</span>               <span class="p">|</span>                 <span class="p">|</span>                 <span class="p">|</span>
         <span class="p">|</span>TopologyEvent<span class="o">(</span>  <span class="p">|</span>               <span class="p">|</span>                 <span class="p">|</span>                 <span class="p">|</span>
         <span class="p">|</span>  SUGGEST_ADDED<span class="o">)</span><span class="p">|</span>               <span class="p">|</span>                 <span class="p">|</span>                 <span class="p">|</span>
         +---------------&gt;<span class="p">|</span>               <span class="p">|</span>                 <span class="p">|</span>                 <span class="p">|</span>
         <span class="p">|</span>                <span class="p">|</span>onTopologyEvent<span class="p">|</span>                 <span class="p">|</span>                 <span class="p">|</span>
         <span class="p">|</span>                +--------------&gt;<span class="p">|</span>                 <span class="p">|</span>                 <span class="p">|</span>
         <span class="p">|</span>                <span class="p">|</span>        +------+-------+         <span class="p">|</span>                 <span class="p">|</span>
         <span class="p">|</span>                <span class="p">|</span>        <span class="p">|</span>check node not<span class="p">|</span>         <span class="p">|</span>                 <span class="p">|</span>
         <span class="p">|</span>                <span class="p">|</span>        <span class="p">|</span>known already <span class="p">|</span>         <span class="p">|</span>                 <span class="p">|</span>
         <span class="p">|</span>                <span class="p">|</span>        <span class="p">|</span>           <span class="o">{</span>d<span class="o">}</span><span class="p">|</span>         <span class="p">|</span>                 <span class="p">|</span>
         <span class="p">|</span>                <span class="p">|</span>        +------+-------+         <span class="p">|</span>                 <span class="p">|</span>
         <span class="p">|</span>                <span class="p">|</span>               <span class="p">|</span>                 <span class="p">|</span>                 <span class="p">|</span>
         <span class="p">|</span>                <span class="p">|</span>               <span class="p">|</span>     addNode     <span class="p">|</span>                 <span class="p">|</span>
         <span class="p">|</span>                <span class="p">|</span>               +----------------&gt;<span class="p">|</span>                 <span class="p">|</span>
         <span class="p">|</span>                <span class="p">|</span>               <span class="p">|</span>                 <span class="p">|</span>  getNewNodeInfo <span class="p">|</span>
         <span class="p">|</span>                <span class="p">|</span>               <span class="p">|</span>                 +----------------&gt;<span class="p">|</span>
         <span class="p">|</span>                <span class="p">|</span>               <span class="p">|</span>                 <span class="p">|</span>                 <span class="p">|</span>
         <span class="p">|</span>                 query<span class="o">(</span>SELECT FROM system.peers<span class="o">)</span>                    <span class="p">|</span>
         <span class="p">|</span>&lt;-------------------------------------------------------------------+
         +-------------------------------------------------------------------&gt;<span class="p">|</span>
         <span class="p">|</span>                <span class="p">|</span>               <span class="p">|</span>                 <span class="p">|</span>&lt;----------------+
         <span class="p">|</span>                <span class="p">|</span>               <span class="p">|</span>         +-------+--------+        <span class="p">|</span>
         <span class="p">|</span>                <span class="p">|</span>               <span class="p">|</span>         <span class="p">|</span>create and apply<span class="p">|</span>        <span class="p">|</span>   
         <span class="p">|</span>                <span class="p">|</span>               <span class="p">|</span>         <span class="p">|</span>AddNodeRefresh  <span class="p">|</span>        <span class="p">|</span>
         <span class="p">|</span>                <span class="p">|</span>               <span class="p">|</span>         <span class="p">|</span>             <span class="o">{</span>d<span class="o">}</span><span class="p">|</span>        <span class="p">|</span>
         <span class="p">|</span>                <span class="p">|</span>               <span class="p">|</span>         +-------+--------+        <span class="p">|</span>
         <span class="p">|</span>                <span class="p">|</span>               <span class="p">|</span>                 <span class="p">|</span>                 <span class="p">|</span>
         <span class="p">|</span>                <span class="p">|</span>      NodeChangeEvent<span class="o">(</span>ADDED<span class="o">)</span>     <span class="p">|</span>                 <span class="p">|</span>
         <span class="p">|</span>                <span class="p">|</span>&lt;--------------------------------+                 <span class="p">|</span>
         <span class="p">|</span>                <span class="p">|</span>               <span class="p">|</span>                 <span class="p">|</span>                 <span class="p">|</span>
</pre></div>
</div>
<p>At this point, other driver components listening on the event bus will get notified of the addition.
For example, <code class="docutils literal notranslate"><span class="pre">DefaultSession</span></code> will initialize a connection pool to the new node.</p>
</section>
<section id="a-new-table-gets-created">
<h3>A new table gets created<a class="headerlink" href="#a-new-table-gets-created" title="Permalink to this headline">¶</a></h3>
<div class="highlight-ditaa notranslate"><div class="highlight"><pre><span></span>  +-----------------+               +---------------+     +---------------+ +--------+
  <span class="p">|</span>ControlConnection<span class="p">|</span>               <span class="p">|</span>MetadataManager<span class="p">|</span>     <span class="p">|</span>TopologyMonitor<span class="p">|</span> <span class="p">|</span>EventBus<span class="p">|</span>
  +--------+--------+               +-------+-------+     +-------+-------+ +---+----+
           <span class="p">|</span>                                <span class="p">|</span>                     <span class="p">|</span>             <span class="p">|</span>
+----------+----------+                     <span class="p">|</span>                     <span class="p">|</span>             <span class="p">|</span>
<span class="p">|</span>Receive SCHEMA_CHANGE<span class="p">|</span>                     <span class="p">|</span>                     <span class="p">|</span>             <span class="p">|</span>
<span class="p">|</span>gossip event         <span class="p">|</span>                     <span class="p">|</span>                     <span class="p">|</span>             <span class="p">|</span>
<span class="p">|</span>             <span class="o">{</span>d<span class="o">}</span>     <span class="p">|</span>                     <span class="p">|</span>                     <span class="p">|</span>             <span class="p">|</span>
+----------+----------+                     <span class="p">|</span>                     <span class="p">|</span>             <span class="p">|</span>
           <span class="p">|</span>                                <span class="p">|</span>                     <span class="p">|</span>             <span class="p">|</span>
           <span class="p">|</span>            refreshSchema       <span class="p">|</span>                     <span class="p">|</span>             <span class="p">|</span>
           +-------------------------------&gt;<span class="p">|</span>                     <span class="p">|</span>             <span class="p">|</span>
           <span class="p">|</span>                                <span class="p">|</span>checkSchemaAgreement <span class="p">|</span>             <span class="p">|</span>
           <span class="p">|</span>                                +--------------------&gt;<span class="p">|</span>             <span class="p">|</span>
           <span class="p">|</span>                                <span class="p">|</span>                     <span class="p">|</span>             <span class="p">|</span>           
           <span class="p">|</span>         query<span class="o">(</span>SELECT FROM system.local/peers<span class="o">)</span>        <span class="p">|</span>             <span class="p">|</span>
           <span class="p">|</span>&lt;-----------------------------------------------------+             <span class="p">|</span>
           +-----------------------------------------------------&gt;<span class="p">|</span>             <span class="p">|</span>
           <span class="p">|</span>                                <span class="p">|</span>                     <span class="p">|</span>             <span class="p">|</span>
           <span class="p">|</span>                                <span class="p">|</span>&lt;--------------------+             <span class="p">|</span>
           <span class="p">|</span>query<span class="o">(</span>SELECT FROM system_schema<span class="o">)</span><span class="p">|</span>                     <span class="p">|</span>             <span class="p">|</span>
           <span class="p">|</span>&lt;-------------------------------+                     <span class="p">|</span>             <span class="p">|</span>
           +-------------------------------&gt;<span class="p">|</span>                     <span class="p">|</span>             <span class="p">|</span>
           <span class="p">|</span>                        +-------+--------+            <span class="p">|</span>             <span class="p">|</span>
           <span class="p">|</span>                        <span class="p">|</span>Parse results   <span class="p">|</span>            <span class="p">|</span>             <span class="p">|</span>
           <span class="p">|</span>                        <span class="p">|</span>Create and apply<span class="p">|</span>            <span class="p">|</span>             <span class="p">|</span>
           <span class="p">|</span>                        <span class="p">|</span>SchemaRefresh   <span class="p">|</span>            <span class="p">|</span>             <span class="p">|</span>
           <span class="p">|</span>                        <span class="p">|</span>             <span class="o">{</span>d<span class="o">}</span><span class="p">|</span>            <span class="p">|</span>             <span class="p">|</span>
           <span class="p">|</span>                        +-------+--------+            <span class="p">|</span>             <span class="p">|</span>
           <span class="p">|</span>                                <span class="p">|</span>                     <span class="p">|</span>             <span class="p">|</span>
           <span class="p">|</span>                                <span class="p">|</span>   TableChangeEvent<span class="o">(</span>CREATED<span class="o">)</span>       <span class="p">|</span>
           <span class="p">|</span>                                +----------------------------------&gt;<span class="p">|</span>
           <span class="p">|</span>                                <span class="p">|</span>                     <span class="p">|</span>             <span class="p">|</span>
</pre></div>
</div>
</section>
<section id="the-last-connection-to-an-active-node-drops">
<h3>The last connection to an active node drops<a class="headerlink" href="#the-last-connection-to-an-active-node-drops" title="Permalink to this headline">¶</a></h3>
<div class="highlight-ditaa notranslate"><div class="highlight"><pre><span></span>  +-----------+              +--------+   +----------------+     +----+ +---------------+
  <span class="p">|</span>ChannelPool<span class="p">|</span>              <span class="p">|</span>EventBus<span class="p">|</span>   <span class="p">|</span>NodeStateManager<span class="p">|</span>     <span class="p">|</span>Node<span class="p">|</span> <span class="p">|</span>MetadataManager<span class="p">|</span>
  +-----+-----+              +---+----+   +-------+--------+     +-+--+ +-------+-------+
        <span class="p">|</span>                        <span class="p">|</span>                <span class="p">|</span>                <span class="p">|</span>            <span class="p">|</span>
        <span class="p">|</span>ChannelEvent<span class="o">(</span>CLOSED<span class="o">)</span>    <span class="p">|</span>                <span class="p">|</span>                <span class="p">|</span>            <span class="p">|</span>
        +-----------------------&gt;<span class="p">|</span>                <span class="p">|</span>                <span class="p">|</span>            <span class="p">|</span>
        <span class="p">|</span>                        <span class="p">|</span>onChannelEvent  <span class="p">|</span>                <span class="p">|</span>            <span class="p">|</span>
 +------+-----+                  +---------------&gt;<span class="p">|</span>                <span class="p">|</span>            <span class="p">|</span>
 <span class="p">|</span>   start    <span class="p">|</span>                  <span class="p">|</span>                <span class="p">|</span>decrement       <span class="p">|</span>            <span class="p">|</span>
 <span class="p">|</span>reconnecting<span class="p">|</span>                  <span class="p">|</span>                <span class="p">|</span>openConnections <span class="p">|</span>            <span class="p">|</span>
 <span class="p">|</span>         <span class="o">{</span>d<span class="o">}</span><span class="p">|</span>                  <span class="p">|</span>                +---------------&gt;<span class="p">|</span>            <span class="p">|</span>
 +------+-----+                  <span class="p">|</span>                <span class="p">|</span>                <span class="p">|</span>            <span class="p">|</span>
        <span class="p">|</span>ChannelEvent<span class="o">(</span>           <span class="p">|</span>                <span class="p">|</span>                <span class="p">|</span>            <span class="p">|</span>
        <span class="p">|</span>  RECONNECTION_STARTED<span class="o">)</span> <span class="p">|</span>                <span class="p">|</span>                <span class="p">|</span>            <span class="p">|</span>
        +-----------------------&gt;<span class="p">|</span>                <span class="p">|</span>                <span class="p">|</span>            <span class="p">|</span>
        <span class="p">|</span>                        <span class="p">|</span>onChannelEvent  <span class="p">|</span>                <span class="p">|</span>            <span class="p">|</span>
        <span class="p">|</span>                        +---------------&gt;<span class="p">|</span>                <span class="p">|</span>            <span class="p">|</span>
        <span class="p">|</span>                        <span class="p">|</span>                <span class="p">|</span>increment       <span class="p">|</span>            <span class="p">|</span>
        <span class="p">|</span>                        <span class="p">|</span>                <span class="p">|</span>reconnections   <span class="p">|</span>            <span class="p">|</span>
        <span class="p">|</span>                        <span class="p">|</span>                +---------------&gt;<span class="p">|</span>            <span class="p">|</span>
        <span class="p">|</span>                        <span class="p">|</span>                <span class="p">|</span>                <span class="p">|</span>            <span class="p">|</span>
        <span class="p">|</span>                        <span class="p">|</span>       +--------+--------+       <span class="p">|</span>            <span class="p">|</span>
        <span class="p">|</span>                        <span class="p">|</span>       <span class="p">|</span>detect node has  <span class="p">|</span>       <span class="p">|</span>            <span class="p">|</span>
        <span class="p">|</span>                        <span class="p">|</span>       <span class="p">|</span><span class="m">0</span> connections and<span class="p">|</span>       <span class="p">|</span>            <span class="p">|</span>
        <span class="p">|</span>                        <span class="p">|</span>       <span class="p">|</span>is reconnecting  <span class="p">|</span>       <span class="p">|</span>            <span class="p">|</span>
        <span class="p">|</span>                        <span class="p">|</span>       <span class="p">|</span>           <span class="o">{</span>d<span class="o">}</span>   <span class="p">|</span>       <span class="p">|</span>            <span class="p">|</span>
        <span class="p">|</span>                        <span class="p">|</span>       +--------+--------+       <span class="p">|</span>            <span class="p">|</span>
        <span class="p">|</span>                        <span class="p">|</span>                <span class="p">|</span><span class="nb">set</span> state DOWN  <span class="p">|</span>            <span class="p">|</span>
        <span class="p">|</span>                        <span class="p">|</span>                +---------------&gt;<span class="p">|</span>            <span class="p">|</span>
        <span class="p">|</span>                        <span class="p">|</span>NodeStateEvent<span class="o">(</span> <span class="p">|</span>                <span class="p">|</span>            <span class="p">|</span>
        <span class="p">|</span>                        <span class="p">|</span>  DOWN<span class="o">)</span>         <span class="p">|</span>                <span class="p">|</span>            <span class="p">|</span>
 +------+-----+                  <span class="p">|</span>&lt;---------------+                <span class="p">|</span>            <span class="p">|</span>
 <span class="p">|</span>reconnection<span class="p">|</span>                  <span class="p">|</span>                <span class="p">|</span>                <span class="p">|</span>            <span class="p">|</span>
 <span class="p">|</span> succeeds   <span class="p">|</span>                  <span class="p">|</span>                <span class="p">|</span>                <span class="p">|</span>            <span class="p">|</span>
 <span class="p">|</span>         <span class="o">{</span>d<span class="o">}</span><span class="p">|</span>                  <span class="p">|</span>                <span class="p">|</span>                <span class="p">|</span>            <span class="p">|</span>
 +------+-----+                  <span class="p">|</span>                <span class="p">|</span>                <span class="p">|</span>            <span class="p">|</span>
        <span class="p">|</span>ChannelEvent<span class="o">(</span>OPENED<span class="o">)</span>    <span class="p">|</span>                <span class="p">|</span>                <span class="p">|</span>            <span class="p">|</span>
        +-----------------------&gt;<span class="p">|</span>                <span class="p">|</span>                <span class="p">|</span>            <span class="p">|</span>
        <span class="p">|</span>                        <span class="p">|</span>onChannelEvent  <span class="p">|</span>                <span class="p">|</span>            <span class="p">|</span>
        <span class="p">|</span>                        +---------------&gt;<span class="p">|</span>                <span class="p">|</span>            <span class="p">|</span>
        <span class="p">|</span>                        <span class="p">|</span>                <span class="p">|</span>increment       <span class="p">|</span>            <span class="p">|</span>
        <span class="p">|</span>                        <span class="p">|</span>                <span class="p">|</span>openConnections <span class="p">|</span>            <span class="p">|</span>
        <span class="p">|</span>                        <span class="p">|</span>                +---------------&gt;<span class="p">|</span>            <span class="p">|</span>
        <span class="p">|</span>                        <span class="p">|</span>                <span class="p">|</span>                <span class="p">|</span>            <span class="p">|</span>
        <span class="p">|</span>                        <span class="p">|</span>       +--------+--------+       <span class="p">|</span>            <span class="p">|</span>
        <span class="p">|</span>                        <span class="p">|</span>       <span class="p">|</span>detect node has  <span class="p">|</span>       <span class="p">|</span>            <span class="p">|</span>
        <span class="p">|</span>                        <span class="p">|</span>       <span class="p">|</span><span class="m">1</span> connection     <span class="p">|</span>       <span class="p">|</span>            <span class="p">|</span>
        <span class="p">|</span>                        <span class="p">|</span>       <span class="p">|</span>           <span class="o">{</span>d<span class="o">}</span>   <span class="p">|</span>       <span class="p">|</span>            <span class="p">|</span>
        <span class="p">|</span>                        <span class="p">|</span>       +--------+--------+       <span class="p">|</span>            <span class="p">|</span>
        <span class="p">|</span>                        <span class="p">|</span>                <span class="p">|</span> refreshNode    <span class="p">|</span>            <span class="p">|</span>
        <span class="p">|</span>                        <span class="p">|</span>                +----------------------------&gt;<span class="p">|</span>
        <span class="p">|</span>                        <span class="p">|</span>                <span class="p">|</span>                <span class="p">|</span>            <span class="p">|</span>
        <span class="p">|</span>                        <span class="p">|</span>                <span class="p">|</span><span class="nb">set</span> state UP    <span class="p">|</span>            <span class="p">|</span>
        <span class="p">|</span>                        <span class="p">|</span>                +---------------&gt;<span class="p">|</span>            <span class="p">|</span>
        <span class="p">|</span>                        <span class="p">|</span>NodeStateEvent<span class="o">(</span> <span class="p">|</span>                <span class="p">|</span>            <span class="p">|</span>
        <span class="p">|</span>                        <span class="p">|</span>  UP<span class="o">)</span>           <span class="p">|</span>                <span class="p">|</span>            <span class="p">|</span>
        <span class="p">|</span>                        <span class="p">|</span>&lt;---------------+                <span class="p">|</span>            <span class="p">|</span>
        <span class="p">|</span>ChannelEvent<span class="o">(</span>           <span class="p">|</span>                <span class="p">|</span>                <span class="p">|</span>            <span class="p">|</span>
        <span class="p">|</span>  RECONNECTION_STOPPED<span class="o">)</span> <span class="p">|</span>                <span class="p">|</span>                <span class="p">|</span>            <span class="p">|</span>
        +-----------------------&gt;<span class="p">|</span>                <span class="p">|</span>                <span class="p">|</span>            <span class="p">|</span>
        <span class="p">|</span>                        <span class="p">|</span>onChannelEvent  <span class="p">|</span>                <span class="p">|</span>            <span class="p">|</span>
        <span class="p">|</span>                        +---------------&gt;<span class="p">|</span>                <span class="p">|</span>            <span class="p">|</span>
        <span class="p">|</span>                        <span class="p">|</span>                <span class="p">|</span>decrement       <span class="p">|</span>            <span class="p">|</span>
        <span class="p">|</span>                        <span class="p">|</span>                <span class="p">|</span>reconnections   <span class="p">|</span>            <span class="p">|</span>
        <span class="p">|</span>                        <span class="p">|</span>                +---------------&gt;<span class="p">|</span>            <span class="p">|</span>
        <span class="p">|</span>                        <span class="p">|</span>                <span class="p">|</span>                <span class="p">|</span>            <span class="p">|</span>
</pre></div>
</div>
</section>
</section>
<section id="extension-points">
<h2>Extension points<a class="headerlink" href="#extension-points" title="Permalink to this headline">¶</a></h2>
<section id="topologymonitor">
<h3>TopologyMonitor<a class="headerlink" href="#topologymonitor" title="Permalink to this headline">¶</a></h3>
<p>This is a standalone component because some users have asked for a way to use their own discovery
service instead of relying on system tables and gossip (see
<a class="reference external" href="https://datastax-oss.atlassian.net/browse/JAVA-1082">JAVA-1082</a>).</p>
<p>A custom implementation can be plugged by <a class="reference external" href="../common/context/#overriding-a-context-component">extending the
context</a> and overriding <code class="docutils literal notranslate"><span class="pre">buildTopologyMonitor</span></code>.
It should:</p>
<ul class="simple">
<li><p>implement the methods of <code class="docutils literal notranslate"><span class="pre">TopologyMonitor</span></code> by querying the discovery service;</p></li>
<li><p>use some notification mechanism (or poll the service periodically) to detect when nodes go up or
down, or get added or removed, and emit the corresponding <code class="docutils literal notranslate"><span class="pre">TopologyEvent</span></code> instances on the bus.</p></li>
</ul>
<p>Read the javadocs for more details; in particular, <code class="docutils literal notranslate"><span class="pre">NodeInfo</span></code> explains how the driver uses the
information returned by the topology monitor.</p>
</section>
<section id="metadatamanager">
<h3>MetadataManager<a class="headerlink" href="#metadatamanager" title="Permalink to this headline">¶</a></h3>
<p>It’s less likely that this will be overridden directly. But the schema querying and parsing logic is
abstracted behind two factories that handle the differences between Cassandra versions:
<code class="docutils literal notranslate"><span class="pre">SchemaQueriesFactory</span></code> and <code class="docutils literal notranslate"><span class="pre">SchemaParserFactory</span></code>. These are pluggable by <a class="reference external" href="../common/context/#overriding-a-context-component">extending the
context</a> and overriding the corresponding
<code class="docutils literal notranslate"><span class="pre">buildXxx</span></code> methods.</p>
</section>
</section>
</section>

                
                    <div class="post-content"><div class="content-navigation">
    <div class="navigation navigation--prev">
        
            <a class="navigation__link" href="../index.html">
                <button class="navigation__button">
                    <i class="scylla-icon scylla-icon--chevron-left"></i>
                </button>
                <div class="navigation__title">
                    <span class="colored">PREVIOUS</span> <br />Developer docs
                </div>
            </a>
        
    </div>
    <div class="navigation navigation--next">
        
            <a class="navigation__link" href="../common/index.html">
                <div class="navigation__title">
                    <span class="colored">NEXT</span> <br />Common infrastructure
                </div>
                <button class="navigation__button">
                    <i class="scylla-icon scylla-icon--chevron-right"></i>
                </button>
            </a>
        
    </div>
</div></div>
                
            </div>
            <div class="sidebar-left  large-order-1">
                
                    
                        <div id="side-nav" class="side-nav custom-scroll-bar" data-closable data-toggler=".show">
    <button class="collapsible-button">
        <i class="scylla-icon scylla-icon--chevron-left"></i>
    </button>
    <div class="side-nav-content">
        <div class="side-nav__search">
            <div class="search-box">
                <ci-search></ci-search>
            </div>
        </div>
        <div class="side-nav__versions">
    <ul class="dropdown menu scylla-dropdown scylla-dropdown--versions" data-dropdown-menu>
        <li class="scylla-dropdown__item">
            <a class="scylla-dropdown__title" href="#">
                
                    4.12.0.x
                
                <i class="chevron scylla-icon scylla-icon--chevron-right"></i>
            </a>
            <ul class="menu scylla-dropdown__content">
                
                    
                        <li>
                            <a href="../../../../stable/index.html">4.13.0.x</a>
                        </li>
                    
                
                    
                        <li>
                            <a href="index.html">4.12.0.x</a>
                        </li>
                    
                
                    
                        <li>
                            <a href="../../../../scylla-4.11.1.x/index.html">4.11.1.x</a>
                        </li>
                    
                
                    
                        <li>
                            <a href="../../../../scylla-4.10.0.x/index.html">4.10.0.x</a>
                        </li>
                    
                
                    
                        <li>
                            <a href="../../../../scylla-4.7.2.x/index.html">4.7.2.x</a>
                        </li>
                    
                
                    
                        <li>
                            <a href="../../../../scylla-3.11.2.x/index.html">3.11.2.x</a>
                        </li>
                    
                
                    
                        <li>
                            <a href="../../../../scylla-3.11.0.x/index.html">3.11.0.x</a>
                        </li>
                    
                
                    
                        <li>
                            <a href="../../../../scylla-3.10.2.x/index.html">3.10.2.x</a>
                        </li>
                    
                
                    
                        <li>
                            <a href="../../../../scylla-3.7.2.x/index.html">3.7.2.x</a>
                        </li>
                    
                
                
            </ul>
        </li>
    </ul>
</div>
        <div class="side-nav__content">
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Java Driver for Scylla and Apache Cassandra®</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api.html">API Documentation</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../../index.html">Manual</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../api_conventions/index.html">API conventions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../case_sensitivity/index.html">Case sensitivity</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../core/index.html">Core driver</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label for="toctree-checkbox-2"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../core/address_resolution/index.html">Address resolution</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/async/index.html">Asynchronous programming</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/authentication/index.html">Authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/bom/index.html">Bill of Materials (BOM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/compression/index.html">Compression</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../core/configuration/index.html">Configuration</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label for="toctree-checkbox-3"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l4"><a class="reference internal" href="../../core/configuration/reference/README.html">Reference configuration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../core/control_connection/index.html">Control connection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/custom_codecs/index.html">Custom codecs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/detachable_types/index.html">Detachable types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/idempotence/index.html">Query idempotence</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/integration/index.html">Integration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/load_balancing/index.html">Load balancing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/logging/index.html">Logging</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../core/metadata/index.html">Metadata</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label for="toctree-checkbox-4"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l4"><a class="reference internal" href="../../core/metadata/node/index.html">Node metadata</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../core/metadata/schema/index.html">Schema metadata</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../core/metadata/token/index.html">Token metadata</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../core/metrics/index.html">Metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/native_protocol/index.html">Native protocol</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/non_blocking/index.html">Non-blocking programming</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/paging/index.html">Paging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/performance/index.html">Performance</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/pooling/index.html">Connection pooling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/query_timestamps/index.html">Query timestamps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/reactive/index.html">Reactive Style Programming</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/reconnection/index.html">Reconnection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/request_tracker/index.html">Request tracker</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/retries/index.html">Retries</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/shaded_jar/index.html">Using the shaded JAR</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/speculative_execution/index.html">Speculative query execution</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/ssl/index.html">SSL</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../core/statements/index.html">Statements</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label for="toctree-checkbox-5"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l4"><a class="reference internal" href="../../core/statements/batch/index.html">Batch statements</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../core/statements/per_query_keyspace/index.html">Per-query keyspace</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../core/statements/prepared/index.html">Prepared statements</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../core/statements/simple/index.html">Simple statements</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../core/temporal_types/index.html">Temporal types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/throttling/index.html">Request throttling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/tracing/index.html">Query tracing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/tuples/index.html">Tuples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../core/udts/index.html">User-defined types</a></li>
</ul>
</li>
<li class="toctree-l2 current has-children"><a class="reference internal" href="../index.html">Developer docs</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label for="toctree-checkbox-6"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul class="current">
<li class="toctree-l3 current current-page"><a class="current reference internal" href="#">Administrative tasks</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../common/index.html">Common infrastructure</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label for="toctree-checkbox-7"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l4"><a class="reference internal" href="../common/concurrency/index.html">Concurrency</a></li>
<li class="toctree-l4"><a class="reference internal" href="../common/context/index.html">Driver context</a></li>
<li class="toctree-l4"><a class="reference internal" href="../common/event_bus/index.html">Event bus</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../native_protocol/index.html">Native protocol layer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../netty_pipeline/index.html">Netty pipeline</a></li>
<li class="toctree-l3"><a class="reference internal" href="../request_execution/index.html">Request execution</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../mapper/index.html">Mapper</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label for="toctree-checkbox-8"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../mapper/config/index.html">Integration</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label for="toctree-checkbox-9"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l4"><a class="reference internal" href="../../mapper/config/kotlin/index.html">Kotlin</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../mapper/config/lombok/index.html">Lombok</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../mapper/config/record/index.html">Java 14 Records</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../mapper/config/scala/index.html">Scala</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../mapper/daos/index.html">DAOs</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label for="toctree-checkbox-10"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l4"><a class="reference internal" href="../../mapper/daos/custom_types/index.html">Custom result types</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../mapper/daos/delete/index.html">Delete methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../mapper/daos/getentity/index.html">GetEntity methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../mapper/daos/increment/index.html">Increment methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../mapper/daos/insert/index.html">Insert methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../mapper/daos/null_saving/index.html">Null saving strategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../mapper/daos/query/index.html">Query methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../mapper/daos/queryprovider/index.html">Query provider methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../mapper/daos/select/index.html">Select methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../mapper/daos/setentity/index.html">SetEntity methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../mapper/daos/statement_attributes/index.html">Statement attributes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../mapper/daos/update/index.html">Update methods</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../mapper/entities/index.html">Entities</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../mapper/mapper/index.html">Mapper interface</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../osgi/index.html">OSGi</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../query_builder/index.html">Query builder</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label for="toctree-checkbox-11"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../query_builder/condition/index.html">Conditions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../query_builder/delete/index.html">DELETE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../query_builder/idempotence/index.html">Idempotence in the query builder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../query_builder/insert/index.html">INSERT</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../query_builder/relation/index.html">Relations</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../query_builder/schema/index.html">Schema builder</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/><label for="toctree-checkbox-12"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l4"><a class="reference internal" href="../../query_builder/schema/aggregate/index.html">Aggregate</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../query_builder/schema/function/index.html">Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../query_builder/schema/index/index.html">Index</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../query_builder/schema/keyspace/index.html">Keyspace</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../query_builder/schema/materialized_view/index.html">Materialized View</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../query_builder/schema/table/index.html">Table</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../query_builder/schema/type/index.html">Type</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../query_builder/select/index.html">SELECT</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../query_builder/term/index.html">Terms</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../query_builder/truncate/index.html">TRUNCATE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../query_builder/update/index.html">UPDATE</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../upgrade_guide/index.html">Upgrade guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq/index.html">Frequently asked questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog/index.html">Changelog</a></li>
</ul>

        </div>
    </div>
</div>
                    
                
            </div>
            
                <div class="sidebar-right large-order-3">
                    <div class="secondary-side-nav custom-scroll-bar">
    
    <ul class="contribute">
        <li class="contribute__item">
            <a href="https://github.com/scylladb/java-driver/issues/new?title=Issue in page Administrative tasks&&body=I%20would%20like%20to%20report%20an%20issue%20in%20page%20https://java-driver.docs.scylladb.com/scylla-4.12.0.x/manual/developer/admin/index%0A%0A%23%23%23%20Problem%0A%0A%23%23%23%20%20Suggest%20a%20fix"
                target="_blank">
                <i class="icon fab fa-github" aria-hidden="true"></i>Create an issue
            </a>
        </li>
        
            <li class="contribute__item">
                
                
                    
                        
                    
                
                <a href="https://github.com/scylladb/java-driver/edit/scylla-4.12.0.x/docs/source/manual/developer/admin/index.md"
                    target="_blank">
                    <i class="icon fa fa-edit" aria-hidden="true"></i>Edit this page
                </a>
            </li>
        
    </ul>

    
        <div class="secondary-side-nav__content">
            <p class="topic-title">On this page</p>
            <ul>
<li><a class="reference internal" href="#">Administrative tasks</a><ul>
<li><a class="reference internal" href="#control-connection">Control connection</a></li>
<li><a class="reference internal" href="#metadata-manager">Metadata manager</a></li>
<li><a class="reference internal" href="#topology-monitor">Topology monitor</a></li>
<li><a class="reference internal" href="#node-state-manager">Node state manager</a><ul>
<li><a class="reference internal" href="#topology-events-vs-node-state-events">Topology events vs. node state events</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-admin-components-work-together">How admin components work together</a><ul>
<li><a class="reference internal" href="#a-new-node-gets-added">A new node gets added</a></li>
<li><a class="reference internal" href="#a-new-table-gets-created">A new table gets created</a></li>
<li><a class="reference internal" href="#the-last-connection-to-an-active-node-drops">The last connection to an active node drops</a></li>
</ul>
</li>
<li><a class="reference internal" href="#extension-points">Extension points</a><ul>
<li><a class="reference internal" href="#topologymonitor">TopologyMonitor</a></li>
<li><a class="reference internal" href="#metadatamanager">MetadataManager</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
    
</div>
                </div>
            
        </section>

        <footer class="footer">
    <div class="footer-group">
        <div class="footer-top">
            <a class="footer-logo" href="https://www.scylladb.com">
                <img src="../../../_static/img/logo-scylla-horizontal-RGB.svg" alt="Logo" />
            </a>
            <div class="footer-links">
                <a class="footer-links__link" href="https://docs.scylladb.com/">Docs</a>
                <a class="footer-links__link" href="https://www.scylladb.com/company/contact-us/">Contact Us</a>
                <a class="footer-links__link" href="https://www.scylladb.com/company/">About Us</a>
            </div>
            <div class="footer-actions">
                <a class="footer-actions__link" href="https://groups.google.com/g/scylladb-users" target="_blank">
                    <span data-tooltip tabindex="1" title="User mailing list" data-position="bottom">
                        <img src="../../../_static/img/icons/icon-mail-list.svg" alt="Mail List Icon" />
                    </span>
                </a>
                <a class="footer-actions__link" href="http://slack.scylladb.com/" target="_blank">
                    <span data-tooltip tabindex="1" title="User Slack channel" data-position="bottom">
                        <img src="../../../_static/img/icons/icon-slack.svg" alt="Slack Icon" />
                    </span>
                </a>
            </div>
        </div>

        <div class="footer-bottom">
            
                <div class="footer-bottom__copyright">
                    
                        
                            &#169; 2022, ScyllaDB. All rights reserved.
                        
                    
                </div>
            
            
                <div class="footer-bottom__last-updated">
                    
                        Last updated on 25 May 2022.
                    
                </div>
            
            <div class="footer-bottom__version">
                Powered by
                <a href="http://sphinx-doc.org/">Sphinx 4.3.2</a> &amp;
                <a href="https://sphinx-theme.scylladb.com/">ScyllaDB Theme 1.2.2</a>
            </div>
        </div>
    </div>
</footer>

        <noscript>
            <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T8P2JP" height="0" width="0"
                style="display: none; visibility: hidden"></iframe>
        </noscript>
    </body>

</html>