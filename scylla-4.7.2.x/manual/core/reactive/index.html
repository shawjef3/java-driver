

<!DOCTYPE html>
<html class="no-js" lang="en">
    
    

    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width initial-scale=1" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>
             Reactive Style Programming | Scylla Docs 
        </title>
        <meta name="description" content="Scylla is an Apache Cassandra-compatible NoSQL data store that can handle 1 million transactions per second on a single server." />
        <link rel="icon" href="../../../_static/img/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="../../../_static/img/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" href="../../../_static/img/favicon-228x228.png" sizes="192x192" />
        <link rel="apple-touch-icon" href="../../../_static/img/favicon-228x228.png" />
        <meta name="msapplication-TileImage" href="../../../_static/img/favicon-228x228.png" />

        
            
        

        
            
            <link rel="canonical" href="https://java-driver.docs.scylladb.com/stable/manual/core/reactive/"/>
        

        <link rel="author" href="mailto:info@scylladb.com" />

        
            
        <!-- increase expertrec loading priority-->
        <link rel="dns-prefetch" href="https://cse.expertrec.com">

        <!-- increase font loading priority -->
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link rel="preload" as="style"
            href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />

        <!-- async CSS -->
        <link rel="stylesheet" media="print" onload="this.onload=null;this.removeAttribute('media');"
            href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />

        <!-- no-JS fallback -->
        <noscript>
            <link rel="stylesheet"
                href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />
        </noscript>
        
            
                <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
            
        
            
                <link rel="stylesheet" type="text/css" href="../../../_static/css/main.css" />
            
        
            
                <link rel="stylesheet" type="text/css" href="../../../_static/sphinx_collapse.css" />
            
        
            
                <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
            
        
    
        
        
            

        <script type="text/javascript" id="documentation_options" data-url_root="../../../"
            src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/js/runtime.bundle.js"></script>
        <script type="text/javascript" src="../../../_static/js/main.bundle.js"></script>
        
            
                <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
            
        
            
        
            
                <script src="../../../_static/underscore.js"></script>
            
        
            
                <script src="../../../_static/doctools.js"></script>
            
        
            
                <script src="../../../_static/clipboard.min.js"></script>
            
        
            
                <script src="../../../_static/copybutton.js"></script>
            
        
    
            <!-- Google Tag Manager -->
<script>
    (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({
            "gtm.start": new Date().getTime(),
            event: "gtm.js"
        });
        var f = d.getElementsByTagName(s)[0],
        j = d.createElement(s),
        dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
    })(window, document, "script", "dataLayer", "GTM-T8P2JP");
</script>
<!-- End Google Tag Manager -->

<!-- Expertrec -->
<script>
    var id = "e2077224-9ccf-11e9-a0c9-0242ac130002";
    var ci_search = document.createElement("script");
    ci_search.type = "text/javascript";
    ci_search.async = true;
    ci_search.src = "https://cse.expertrec.com/api/js/ci_common.js?id=" + id;
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(ci_search, s);
</script>
<!-- End Expertrec -->
        
        <!-- Font Awesome -->
        <script src="https://kit.fontawesome.com/b1870adf6a.js" crossorigin="anonymous"></script>
        <!-- End Font Awesome -->
    </head>

    <body>
        
        <header class="header">
    <div class="header-logo">
        <a class="header-logo__img" href="https://scylladb.com/">
            <img src="../../../_static/img/logo-docs.svg" alt="Scylla Documentation Logo" />
        </a>
        <span class="header-logo__bar"></span>
        <a class="header-logo__text" href="https://docs.scylladb.com/">
            Documentation
        </a>
    </div>
    <div class="header-navigation">
        <ul class="dropdown menu scylla-dropdown scylla-dropdown--header" data-dropdown-menu>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Server
                    <i class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--about-us"></i>
                            Scylla Open Source
                        </a>
                    </li>
                    <li>
                        <a href="https://docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--enterprise"></i>Scylla Enterprise
                        </a>
                    </li>
                    <li>
                        <a href="https://scylla.docs.scylladb.com/stable/alternator/alternator.html">
                            <i class="scylla-icon scylla-icon--overview"></i>
                            Scylla Alternator
                        </a>
                    </li>
                </ul>
            </li>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Cloud <i
                    class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://cloud.scylladb.com/">
                            <i class="scylla-icon scylla-icon--cloud"></i>Scylla Cloud</a>
                    </li>
                    <li>
                        <a href="https://docs.scylladb.com/scylla-cloud/">
                            <i class="scylla-icon scylla-icon--cloud-docs"></i>Scylla Cloud
                            Docs</a>
                    </li>
                </ul>
            </li>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Tools <i
                    class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://manager.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--manager"></i>Scylla Manager</a>
                    </li>
                    <li>
                        <a href="https://monitoring.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--monitoring"></i>Scylla
                            Monitoring Stack</a>
                    </li>
                    <li>
                        <a href="https://operator.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--operator"></i>Scylla Operator
                        </a>
                    </li>
                </ul>
            </li>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Drivers <i
                    class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://docs.scylladb.com/using-scylla/drivers/cql-drivers/">
                            <i class="scylla-icon scylla-icon--nsql-guides"></i>CQL Drivers
                        </a>
                    </li>
                    <li>
                        <a href="https://docs.scylladb.com/using-scylla/drivers/dynamo-drivers/">
                            <i class="scylla-icon scylla-icon--overview"></i>DynamoDB Drivers
                        </a>
                    </li>
                </ul>
            </li>
        </ul>
        <div class="header-button">
            <a href="https://www.scylladb.com/download/" class="button">Download</a>
        </div>
    </div>
    <div class="header-search-box">
        <div class="search-box">
            <ci-search></ci-search>
        </div>
    </div>
    <div class="side-nav-toggle" data-toggle="side-nav">
    <div class="side-nav-toggle__button">
        <img src="../../../_static/img/menu.svg" alt="Menu" />
    </div>
</div>
</header>
        <section
            class="layout  layout--sidebar layout--has-secondary-sidebar ">
            <div class="content large-order-2">
                
                    
    <div class="admonition caution">
        <p class="admonition-title">Caution</p>
        <p>
            
                You're viewing documentation for a previous version of Scylla Java Driver.
            
            <a href="../../../../stable/index.html">Switch to the latest stable version.</a>
        </p>
    </div>

                
                
                    <div class="pre-content">
                        <div class="breadcrumbs">
    <span class="bread__item">
        <a href="https://java-driver.docs.scylladb.com"
            class="bread__highlight">
            <i class="fas fa-home"></i> Scylla Java Driver
        </a>
    </span>
    
        <span class="bread__item">
            <a href="../../index.html">
                Manual
            </a>
        </span>
    
        <span class="bread__item">
            <a href="../index.html">
                Core driver
            </a>
        </span>
    
    <span class="bread__item bread__item--last">Reactive Style Programming</span>
</div>
                    </div>
                
                <section id="reactive-style-programming">
<h1>Reactive Style Programming<a class="headerlink" href="#reactive-style-programming" title="Permalink to this headline">¶</a></h1>
<p>The driver provides built-in support for reactive queries. The <a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.7.2.x/api/com/datastax/oss/driver/api/core/CqlSession.html">CqlSession</a> interface extends
<a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.7.2.x/api/com/datastax/dse/driver/api/core/cql/reactive/ReactiveSession.html">ReactiveSession</a>, which adds specialized methods to execute requests expressed in <a class="reference external" href="https://en.wikipedia.org/wiki/Reactive_Streams">reactive
streams</a>.</p>
<p>Notes:</p>
<ul class="simple">
<li><p>reactive capabilities require the <a class="reference external" href="https://github.com/reactive-streams/reactive-streams-jvm">Reactive Streams API</a> to be present on the classpath. The
driver has a dependency on that library, but if your application does not use reactive queries at
all, it is possible to exclude it to minimize the number of runtime dependencies. If the library
cannot be found at runtime, reactive queries won’t be available, and a warning will be logged, but
the driver will otherwise operate normally (this is also valid for OSGi deployments).</p></li>
<li><p>for historical reasons, reactive-related driver types reside in a package prefixed with <code class="docutils literal notranslate"><span class="pre">dse</span></code>;
however, reactive queries also work with regular Cassandra.</p></li>
</ul>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">ReactiveSession</span></code> exposes two public methods:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">ReactiveResultSet</span> <span class="nf">executeReactive</span><span class="o">(</span><span class="n">String</span> <span class="n">query</span><span class="o">);</span>
<span class="n">ReactiveResultSet</span> <span class="nf">executeReactive</span><span class="o">(</span><span class="n">Statement</span><span class="o">&lt;?&gt;</span> <span class="n">statement</span><span class="o">);</span>
</pre></div>
</div>
<p>Both methods return a <a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.7.2.x/api/com/datastax/dse/driver/api/core/cql/reactive/ReactiveResultSet.html">ReactiveResultSet</a>, which is the reactive streams version of a regular
<a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.7.2.x/api/com/datastax/oss/driver/api/core/cql/ResultSet.html">ResultSet</a>. In other words, a <code class="docutils literal notranslate"><span class="pre">ReactiveResultSet</span></code> is a <a class="reference external" href="https://www.reactive-streams.org/reactive-streams-1.0.2-javadoc/org/reactivestreams/Publisher.html">Publisher</a> for query results.</p>
<p>When subscribing to and consuming from a <code class="docutils literal notranslate"><span class="pre">ReactiveResultSet</span></code>, there are two important caveats to
bear in mind:</p>
<ol class="simple">
<li><p>By default, all <code class="docutils literal notranslate"><span class="pre">ReactiveResultSet</span></code> implementations returned by the driver are cold, unicast,
single-subscription-only publishers. In other words, they do not support multiple subscribers;
consider caching the results produced by such publishers if you need to consume them by more than
one downstream subscriber. We provide a few examples of caching further in this document.</p></li>
<li><p>Also, note that reactive result sets may emit items to their subscribers on an internal driver IO
thread. Subscriber implementors are encouraged to abide by <a class="reference external" href="https://github.com/reactive-streams/reactive-streams-jvm#2.2">Reactive Streams Specification rule
2.2</a> and avoid performing heavy computations or blocking calls inside <code class="docutils literal notranslate"><span class="pre">onNext</span></code> calls, as doing so
could slow down the driver and impact performance. Instead, they should asynchronously dispatch
received signals to their processing logic.</p></li>
</ol>
</section>
<section id="basic-usage">
<h2>Basic usage<a class="headerlink" href="#basic-usage" title="Permalink to this headline">¶</a></h2>
<p>The examples in this page make usage of <a class="reference external" href="https://projectreactor.io/">Reactor</a>, a popular reactive library, but they should be
easily adaptable to any other library implementing the concepts of reactive streams.</p>
<section id="reading-in-reactive-style">
<h3>Reading in reactive style<a class="headerlink" href="#reading-in-reactive-style" title="Permalink to this headline">¶</a></h3>
<p>The following example reads from a table and prints all the returned rows to the console. In case of
error, a <code class="docutils literal notranslate"><span class="pre">DriverException</span></code> is thrown and its stack trace is printed to standard error:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="k">try</span> <span class="o">(</span><span class="n">CqlSession</span> <span class="n">session</span> <span class="o">=</span> <span class="o">...)</span> <span class="o">{</span>
      <span class="n">Flux</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">session</span><span class="o">.</span><span class="na">executeReactive</span><span class="o">(</span><span class="s">&quot;SELECT ...&quot;</span><span class="o">))</span>
          <span class="o">.</span><span class="na">doOnNext</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">)</span>
          <span class="o">.</span><span class="na">blockLast</span><span class="o">();</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">DriverException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>
</div>
</section>
<section id="writing-in-reactive-style">
<h3>Writing in reactive style<a class="headerlink" href="#writing-in-reactive-style" title="Permalink to this headline">¶</a></h3>
<p>The following example inserts rows into a table after printing the queries to the console, stopping
at the first error, if any. Again, in case of error, a <code class="docutils literal notranslate"><span class="pre">DriverException</span></code> is thrown:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="k">try</span> <span class="o">(</span><span class="n">CqlSession</span> <span class="n">session</span> <span class="o">=</span> <span class="o">...)</span> <span class="o">{</span>
  <span class="n">Flux</span><span class="o">.</span><span class="na">just</span><span class="o">(</span><span class="s">&quot;INSERT ...&quot;</span><span class="o">,</span> <span class="s">&quot;INSERT ...&quot;</span><span class="o">,</span> <span class="s">&quot;INSERT ...&quot;</span><span class="o">,</span> <span class="o">...)</span>
      <span class="o">.</span><span class="na">doOnNext</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">)</span>
      <span class="o">.</span><span class="na">flatMap</span><span class="o">(</span><span class="n">session</span><span class="o">::</span><span class="n">executeReactive</span><span class="o">)</span>
      <span class="o">.</span><span class="na">blockLast</span><span class="o">();</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">DriverException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Note that when a statement is executed reactively, the actual request is only triggered when the
<code class="docutils literal notranslate"><span class="pre">ReactiveResultSet</span></code> is subscribed to; in other words, when the <code class="docutils literal notranslate"><span class="pre">executeReactive</span></code> method returns,
<em>nothing has been executed yet</em>. This is why the write example above uses a <code class="docutils literal notranslate"><span class="pre">flatMap</span></code> operator,
which takes care of subscribing to each <code class="docutils literal notranslate"><span class="pre">ReactiveResultSet</span></code> returned by successive calls to
<code class="docutils literal notranslate"><span class="pre">session.executeReactive</span></code>. A common pitfall is to use an operator that silently ignores the returned
<code class="docutils literal notranslate"><span class="pre">ReactiveResultSet</span></code>; for example, the code below seems correct, but will not execute any query:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// DON&#39;T DO THIS</span>
<span class="n">Flux</span><span class="o">.</span><span class="na">just</span><span class="o">(</span><span class="s">&quot;INSERT INTO ...&quot;</span><span class="o">)</span>
     <span class="c1">// The returned ReactiveResultSet is not subscribed to</span>
    <span class="o">.</span><span class="na">doOnNext</span><span class="o">(</span><span class="n">session</span><span class="o">::</span><span class="n">executeReactive</span><span class="o">)</span>
    <span class="o">.</span><span class="na">blockLast</span><span class="o">();</span>
</pre></div>
</div>
<p>Since a write query does not return any rows, it may appear difficult to count the number of rows
written to the database. Hopefully most reactive libraries have operators that are useful in these
scenarios. The following example demonstrates how to achieve this goal with Reactor:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Flux</span><span class="o">&lt;</span><span class="n">Statement</span><span class="o">&lt;?&gt;&gt;</span> <span class="n">stmts</span> <span class="o">=</span> <span class="o">...;</span>
<span class="kt">long</span> <span class="n">count</span> <span class="o">=</span>
    <span class="n">stmts</span>
        <span class="o">.</span><span class="na">flatMap</span><span class="o">(</span>
            <span class="n">stmt</span> <span class="o">-&gt;</span>
                <span class="n">Flux</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">session</span><span class="o">.</span><span class="na">executeReactive</span><span class="o">(</span><span class="n">stmt</span><span class="o">))</span>
                    <span class="c1">// dummy cast, since result sets are always empty for write queries</span>
                    <span class="o">.</span><span class="na">cast</span><span class="o">(</span><span class="n">Integer</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
                    <span class="c1">// flow will always be empty, so &#39;1&#39; will be emitted for each query</span>
                    <span class="o">.</span><span class="na">defaultIfEmpty</span><span class="o">(</span><span class="mi">1</span><span class="o">))</span>
        <span class="o">.</span><span class="na">count</span><span class="o">()</span>
        <span class="o">.</span><span class="na">block</span><span class="o">();</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&quot;Executed %d write statements%n&quot;</span><span class="o">,</span> <span class="n">count</span><span class="o">);</span>
</pre></div>
</div>
</section>
</section>
<section id="accessing-query-metadata">
<h2>Accessing query metadata<a class="headerlink" href="#accessing-query-metadata" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">ReactiveResultSet</span></code> exposes useful information about request execution and query metadata:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Publisher</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">ColumnDefinitions</span><span class="o">&gt;</span> <span class="nf">getColumnDefinitions</span><span class="o">();</span>
<span class="n">Publisher</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">ExecutionInfo</span><span class="o">&gt;</span> <span class="nf">getExecutionInfos</span><span class="o">();</span>
<span class="n">Publisher</span><span class="o">&lt;</span><span class="n">Boolean</span><span class="o">&gt;</span> <span class="nf">wasApplied</span><span class="o">();</span> 
</pre></div>
</div>
<p>Refer to the javadocs of <a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.7.2.x/api/com/datastax/dse/driver/api/core/cql/reactive/ReactiveResultSet.html#getColumnDefinitions--">getColumnDefinitions</a>, <a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.7.2.x/api/com/datastax/dse/driver/api/core/cql/reactive/ReactiveResultSet.html#getExecutionInfos--">getExecutionInfos</a> and <a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.7.2.x/api/com/datastax/dse/driver/api/core/cql/reactive/ReactiveResultSet.html#wasApplied--">wasApplied</a> for more
information on these methods.</p>
<p>To inspect the contents of the above publishers, simply subscribe to them. Note that these
publishers cannot complete before the query itself completes; if the query fails, then these
publishers will fail with the same error.</p>
<p>The following example executes a query, then prints all the available metadata to the console:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">ReactiveResultSet</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">executeReactive</span><span class="o">(</span><span class="s">&quot;SELECT ...&quot;</span><span class="o">);</span>
<span class="c1">// execute the query first</span>
<span class="n">Flux</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">rs</span><span class="o">).</span><span class="na">blockLast</span><span class="o">();</span>
<span class="c1">// then retrieve query metadata</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Column definitions: &quot;</span><span class="o">);</span>
<span class="n">Mono</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">getColumnDefinitions</span><span class="o">()).</span><span class="na">doOnNext</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">).</span><span class="na">block</span><span class="o">();</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Execution infos: &quot;</span><span class="o">);</span>
<span class="n">Flux</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">getExecutionInfos</span><span class="o">()).</span><span class="na">doOnNext</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">).</span><span class="na">blockLast</span><span class="o">();</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Was applied: &quot;</span><span class="o">);</span>
<span class="n">Mono</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">wasApplied</span><span class="o">()).</span><span class="na">doOnNext</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">).</span><span class="na">block</span><span class="o">();</span>
</pre></div>
</div>
<p>Note that it is also possible to inspect query metadata at row level. Each row returned by a
reactive query execution implements <a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.7.2.x/api/com/datastax/dse/driver/api/core/cql/reactive/ReactiveRow.html"><code class="docutils literal notranslate"><span class="pre">ReactiveRow</span></code></a>, the reactive equivalent of a
<a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.7.2.x/api/com/datastax/oss/driver/api/core/cql/Row.html"><code class="docutils literal notranslate"><span class="pre">Row</span></code></a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">ReactiveRow</span></code> exposes the same kind of query metadata and execution info found in
<code class="docutils literal notranslate"><span class="pre">ReactiveResultSet</span></code>, but for each individual row:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">ColumnDefinitions</span> <span class="nf">getColumnDefinitions</span><span class="o">();</span>
<span class="n">ExecutionInfo</span> <span class="nf">getExecutionInfo</span><span class="o">();</span>
<span class="kt">boolean</span> <span class="nf">wasApplied</span><span class="o">();</span>
</pre></div>
</div>
<p>Refer to the javadocs of <a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.7.2.x/api/com/datastax/dse/driver/api/core/cql/reactive/ReactiveRow.html#getColumnDefinitions--"><code class="docutils literal notranslate"><span class="pre">getColumnDefinitions</span></code></a>,
<a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.7.2.x/api/com/datastax/dse/driver/api/core/cql/reactive/ReactiveRow.html#getExecutionInfo--"><code class="docutils literal notranslate"><span class="pre">getExecutionInfo</span></code></a> and <a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.7.2.x/api/com/datastax/dse/driver/api/core/cql/reactive/ReactiveRow.html#wasApplied--"><code class="docutils literal notranslate"><span class="pre">wasApplied</span></code></a> for
more information on these methods.</p>
<p>The following example executes a query and, for each row returned, prints the coordinator that
served that row, then retrieves all the coordinators that were contacted to fulfill the query and
prints them to the console:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&gt;</span> <span class="n">coordinators</span> <span class="o">=</span> <span class="n">Flux</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">session</span><span class="o">.</span><span class="na">executeReactive</span><span class="o">(</span><span class="s">&quot;SELECT ...&quot;</span><span class="o">))</span>
    <span class="o">.</span><span class="na">doOnNext</span><span class="o">(</span>
        <span class="n">row</span> <span class="o">-&gt;</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span>
                <span class="s">&quot;Row %s was obtained from coordinator %s%n&quot;</span><span class="o">,</span>
                <span class="n">row</span><span class="o">,</span>
                <span class="n">row</span><span class="o">.</span><span class="na">getExecutionInfo</span><span class="o">().</span><span class="na">getCoordinator</span><span class="o">()))</span>
    <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">ReactiveRow</span><span class="o">::</span><span class="n">getExecutionInfo</span><span class="o">)</span>
    <span class="c1">// dedup by coordinator (note: this is dangerous on a large result set)</span>
    <span class="o">.</span><span class="na">groupBy</span><span class="o">(</span><span class="n">ExecutionInfo</span><span class="o">::</span><span class="n">getCoordinator</span><span class="o">)</span>
    <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">GroupedFlux</span><span class="o">::</span><span class="n">key</span><span class="o">)</span>
    <span class="o">.</span><span class="na">toIterable</span><span class="o">();</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Contacted coordinators: &quot;</span> <span class="o">+</span> <span class="n">coordinators</span><span class="o">);</span>
</pre></div>
</div>
</section>
<section id="advanced-topics">
<h2>Advanced topics<a class="headerlink" href="#advanced-topics" title="Permalink to this headline">¶</a></h2>
<section id="applying-backpressure">
<h3>Applying backpressure<a class="headerlink" href="#applying-backpressure" title="Permalink to this headline">¶</a></h3>
<p>One of the key features of reactive programming is backpressure.</p>
<p>Unfortunately, the Cassandra native protocol does not offer proper support for exchanging
backpressure information between client and server over the network. Cassandra is able, since
version 3.10, to <a class="reference external" href="https://issues.apache.org/jira/browse/CASSANDRA-9318">throttle clients</a> but at the
time of writing, there is no proper <a class="reference external" href="https://issues.apache.org/jira/browse/CASSANDRA-11380">client-facing backpressure
mechanism</a> available.</p>
<p>When reading from Cassandra, this shouldn’t however be a problem for most applications. Indeed, in a
read scenario, Cassandra acts as a producer, and the driver is a consumer; in such a setup, if a
downstream subscriber is not able to cope with the throughput, the driver would progressively adjust
the rate at which it requests more pages from the server, thus effectively regulating the server
throughput to match the subscriber’s. The only caveat is if the subscriber is really too slow, which
could eventually trigger a query timeout, be it on the client side (<code class="docutils literal notranslate"><span class="pre">DriverTimeoutException</span></code>), or on
the server side (<code class="docutils literal notranslate"><span class="pre">ReadTimeoutException</span></code>).</p>
<p>When writing to Cassandra, the lack of backpressure communication between client and server is more
problematic. Indeed in a write scenario, the driver acts as a producer, and Cassandra is a consumer;
in such a setup, if an upstream producer generates too much data, the driver would blindly send the
write statements to the server as quickly as possible, eventually causing the cluster to become
overloaded or even crash. This usually manifests itself with errors like <code class="docutils literal notranslate"><span class="pre">WriteTimeoutException</span></code>, or
<code class="docutils literal notranslate"><span class="pre">OverloadedException</span></code>.</p>
<p>It is strongly advised for users to limit the concurrency at which write statements are executed in
write-intensive scenarios. A simple way to achieve this is to use the <code class="docutils literal notranslate"><span class="pre">flatMap</span></code> operator, which, in
most reactive libraries, has an overloaded form that takes a parameter that controls the desired
amount of concurrency. The following example executes a flow of statements with a maximum
concurrency of 10, leveraging the <code class="docutils literal notranslate"><span class="pre">concurrency</span></code> parameter of Reactor’s <code class="docutils literal notranslate"><span class="pre">flatMap</span></code> operator:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Flux</span><span class="o">&lt;</span><span class="n">Statement</span><span class="o">&lt;?&gt;&gt;</span> <span class="n">stmts</span> <span class="o">=</span> <span class="o">...;</span>
<span class="n">stmts</span><span class="o">.</span><span class="na">flatMap</span><span class="o">(</span><span class="n">session</span><span class="o">::</span><span class="n">executeReactive</span><span class="o">,</span> <span class="mi">10</span><span class="o">).</span><span class="na">blockLast</span><span class="o">();</span>
</pre></div>
</div>
<p>In the example above, the <code class="docutils literal notranslate"><span class="pre">flatMap</span></code> operator will subscribe to at most 10 <code class="docutils literal notranslate"><span class="pre">ReactiveResultSet</span></code>
instances simultaneously, effectively limiting the number of concurrent in-flight requests to 10.
This is usually enough to prevent data from being written too fast. More sophisticated operators are
capable of rate-limiting or throttling the execution of a flow; for example, Reactor offers a
<code class="docutils literal notranslate"><span class="pre">delayElements</span></code> operator that rate-limits the throughput of its upstream publisher. Consult the
documentation of your reactive library for more information.</p>
<p>As a last resort, it is also possible to limit concurrency at driver level, for example using the
driver’s built-in <a class="reference external" href="../throttling/">request throttling</a> mechanism, although this is usually not required in reactive
applications. See “<a class="reference external" href="https://docs.datastax.com/en/devapp/doc/devapp/driverManagingConcurrency.html%5D">Managing concurrency in asynchronous query execution</a>” in the Developer Guide
for a few examples.</p>
</section>
<section id="caching-query-results">
<h3>Caching query results<a class="headerlink" href="#caching-query-results" title="Permalink to this headline">¶</a></h3>
<p>As stated above, a <code class="docutils literal notranslate"><span class="pre">ReactiveResultSet</span></code> can only be subscribed once. This is an intentional design
decision, because otherwise users could inadvertently trigger a spurious execution of the same query
again when subscribing for the second time to the same <code class="docutils literal notranslate"><span class="pre">ReactiveResultSet</span></code>.</p>
<p>Let’s suppose that we want to compute both the average and the sum of all values from a table
column. The most naive approach would be to create two flows and subscribe to both:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// DON&#39;T DO THIS</span>
<span class="n">ReactiveResultSet</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">executeReactive</span><span class="o">(</span><span class="s">&quot;SELECT n FROM ...&quot;</span><span class="o">);</span>
<span class="kt">double</span> <span class="n">avg</span> <span class="o">=</span> <span class="n">Flux</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">rs</span><span class="o">)</span>
   <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">row</span> <span class="o">-&gt;</span> <span class="n">row</span><span class="o">.</span><span class="na">getLong</span><span class="o">(</span><span class="mi">0</span><span class="o">))</span>
   <span class="o">.</span><span class="na">reduce</span><span class="o">(</span><span class="mf">0d</span><span class="o">,</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">/</span> <span class="mf">2.0</span><span class="o">))</span>
   <span class="o">.</span><span class="na">block</span><span class="o">();</span>
<span class="c1">// will fail with IllegalStateException</span>
<span class="kt">long</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">Flux</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">rs</span><span class="o">)</span>
   <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">row</span> <span class="o">-&gt;</span> <span class="n">row</span><span class="o">.</span><span class="na">getLong</span><span class="o">(</span><span class="mi">0</span><span class="o">))</span>
   <span class="o">.</span><span class="na">reduce</span><span class="o">(</span><span class="mi">0</span><span class="n">L</span><span class="o">,</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="o">)</span>
   <span class="o">.</span><span class="na">block</span><span class="o">();</span>
</pre></div>
</div>
<p>Unfortunately, the second <code class="docutils literal notranslate"><span class="pre">Flux</span></code> above with terminate immediately with an <code class="docutils literal notranslate"><span class="pre">onError</span></code> signal
encapsulating an <code class="docutils literal notranslate"><span class="pre">IllegalStateException</span></code>, since <code class="docutils literal notranslate"><span class="pre">rs</span></code> was already subscribed to.</p>
<p>To circumvent this limitation, while still avoiding to query the table twice, the easiest technique
consists in using the <code class="docutils literal notranslate"><span class="pre">cache</span></code> operator that most reactive libraries offer:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Flux</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">Flux</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">session</span><span class="o">.</span><span class="na">executeReactive</span><span class="o">(</span><span class="s">&quot;SELECT n FROM ...&quot;</span><span class="o">))</span>
    <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">row</span> <span class="o">-&gt;</span> <span class="n">row</span><span class="o">.</span><span class="na">getLong</span><span class="o">(</span><span class="mi">0</span><span class="o">))</span>
    <span class="o">.</span><span class="na">cache</span><span class="o">();</span>
<span class="kt">double</span> <span class="n">avg</span> <span class="o">=</span> <span class="n">rs</span>
    <span class="o">.</span><span class="na">reduce</span><span class="o">(</span><span class="mf">0d</span><span class="o">,</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">/</span> <span class="mf">2.0</span><span class="o">))</span>
    <span class="o">.</span><span class="na">block</span><span class="o">();</span>
<span class="kt">long</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">rs</span>
    <span class="o">.</span><span class="na">reduce</span><span class="o">(</span><span class="mi">0</span><span class="n">L</span><span class="o">,</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="o">)</span>
    <span class="o">.</span><span class="na">block</span><span class="o">();</span>
</pre></div>
</div>
<p>The above example works just fine.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">cache</span></code> operator will subscribe at most once to the <code class="docutils literal notranslate"><span class="pre">ReactiveResultSet</span></code>, cache the results, and
serve the cached results to downstream subscribers. This is obviously only possible if your result
set is small and can fit entirely in memory.</p>
<p>If caching is not an option, most reactive libraries also offer operators that multicast their
upstream subscription to many subscribers on the fly.</p>
<p>The above example could be rewritten with a different approach as follows:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Flux</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">Flux</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">session</span><span class="o">.</span><span class="na">executeReactive</span><span class="o">(</span><span class="s">&quot;SELECT n FROM ...&quot;</span><span class="o">))</span>
    <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">row</span> <span class="o">-&gt;</span> <span class="n">row</span><span class="o">.</span><span class="na">getLong</span><span class="o">(</span><span class="mi">0</span><span class="o">))</span>
    <span class="o">.</span><span class="na">publish</span><span class="o">()</span>       <span class="c1">// multicast upstream to all downstream subscribers</span>
    <span class="o">.</span><span class="na">autoConnect</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span> <span class="c1">// wait until two subscribers subscribe</span>
<span class="kt">long</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">rs</span>
    <span class="o">.</span><span class="na">reduce</span><span class="o">(</span><span class="mi">0</span><span class="n">L</span><span class="o">,</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="o">)</span>
    <span class="o">.</span><span class="na">block</span><span class="o">();</span>
<span class="kt">double</span> <span class="n">avg</span> <span class="o">=</span> <span class="n">rs</span>
    <span class="o">.</span><span class="na">reduce</span><span class="o">(</span><span class="mf">0d</span><span class="o">,</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">/</span> <span class="mf">2.0</span><span class="o">))</span>
    <span class="o">.</span><span class="na">block</span><span class="o">();</span>
</pre></div>
</div>
<p>In the above example, the <code class="docutils literal notranslate"><span class="pre">publish</span></code> operator multicasts every <code class="docutils literal notranslate"><span class="pre">onNext</span></code> signal to all of its
subscribers; and the <code class="docutils literal notranslate"><span class="pre">autoConnect(2)</span></code> operator instructs <code class="docutils literal notranslate"><span class="pre">publish</span></code> to wait until it gets 2
subscriptions before subscribing to its upstream source (and triggering the actual query execution).</p>
<p>This approach should be the preferred one for large result sets since it does not involve caching
results in memory.</p>
</section>
<section id="resuming-from-and-retrying-after-failed-queries">
<h3>Resuming from and retrying after failed queries<a class="headerlink" href="#resuming-from-and-retrying-after-failed-queries" title="Permalink to this headline">¶</a></h3>
<p>When executing a flow of statements, any failed query execution would trigger an <code class="docutils literal notranslate"><span class="pre">onError</span></code> signal
and terminate the subscription immediately, potentially preventing subsequent queries from being
executed at all.</p>
<p>If this behavior is not desired, it is possible to mimic the behavior of a fail-safe system. This
usually involves the usage of operators such as <code class="docutils literal notranslate"><span class="pre">onErrorReturn</span></code> or <code class="docutils literal notranslate"><span class="pre">onErrorResume</span></code>. Consult your
reactive library documentation to find out which operators allow you to intercept failures.</p>
<p>The following example executes a flow of statements; for each failed execution, the stack trace is
printed to standard error and, thanks to the <code class="docutils literal notranslate"><span class="pre">onErrorResume</span></code> operator, the error is completely
ignored and the flow execution resumes normally:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Flux</span><span class="o">&lt;</span><span class="n">Statement</span><span class="o">&lt;?&gt;&gt;</span> <span class="n">stmts</span> <span class="o">=</span> <span class="o">...;</span>
<span class="n">stmts</span><span class="o">.</span><span class="na">flatMap</span><span class="o">(</span>
    <span class="n">statement</span> <span class="o">-&gt;</span>
        <span class="n">Flux</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">session</span><span class="o">.</span><span class="na">executeReactive</span><span class="o">(</span><span class="n">statement</span><span class="o">))</span>
            <span class="o">.</span><span class="na">doOnError</span><span class="o">(</span><span class="n">Throwable</span><span class="o">::</span><span class="n">printStackTrace</span><span class="o">)</span>
            <span class="o">.</span><span class="na">onErrorResume</span><span class="o">(</span><span class="n">error</span> <span class="o">-&gt;</span> <span class="n">Mono</span><span class="o">.</span><span class="na">empty</span><span class="o">()))</span>
    <span class="o">.</span><span class="na">blockLast</span><span class="o">();</span>
</pre></div>
</div>
<p>The following example expands on the previous one: for each failed execution, at most 3 retries are
attempted if the error was an <code class="docutils literal notranslate"> <span class="pre">UnavailableException</span></code>, then, if the query wasn’t successful after
retrying, a message is logged. Finally, all the errors are collected and the total number of failed
queries is printed to the console:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Flux</span><span class="o">&lt;</span><span class="n">Statement</span><span class="o">&lt;?&gt;&gt;</span> <span class="n">statements</span> <span class="o">=</span> <span class="o">...;</span>
<span class="kt">long</span> <span class="n">failed</span> <span class="o">=</span> <span class="n">statements</span><span class="o">.</span><span class="na">flatMap</span><span class="o">(</span>
    <span class="n">stmt</span> <span class="o">-&gt;</span>
        <span class="n">Flux</span><span class="o">.</span><span class="na">defer</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">session</span><span class="o">.</span><span class="na">executeReactive</span><span class="o">(</span><span class="n">stmt</span><span class="o">))</span>
            <span class="c1">// retry at most 3 times on Unavailable</span>
            <span class="o">.</span><span class="na">retry</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="n">UnavailableException</span><span class="o">.</span><span class="na">class</span><span class="o">::</span><span class="n">isInstance</span><span class="o">)</span>
            <span class="c1">// handle errors</span>
            <span class="o">.</span><span class="na">doOnError</span><span class="o">(</span>
                <span class="n">error</span> <span class="o">-&gt;</span> <span class="o">{</span>
                  <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Statement failed: &quot;</span> <span class="o">+</span> <span class="n">stmt</span><span class="o">);</span>
                  <span class="n">error</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                <span class="o">})</span>
            <span class="c1">// Collect errors and discard all returned rows</span>
            <span class="o">.</span><span class="na">ignoreElements</span><span class="o">()</span>
            <span class="o">.</span><span class="na">cast</span><span class="o">(</span><span class="n">Long</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
            <span class="o">.</span><span class="na">onErrorReturn</span><span class="o">(</span><span class="mi">1L</span><span class="o">))</span>
    <span class="o">.</span><span class="na">sum</span><span class="o">()</span>
    <span class="o">.</span><span class="na">block</span><span class="o">();</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Total failed queries: &quot;</span> <span class="o">+</span> <span class="n">failed</span><span class="o">);</span>
</pre></div>
</div>
<p>The example above uses <code class="docutils literal notranslate"><span class="pre">Flux.defer()</span></code> to wrap the call to <code class="docutils literal notranslate"><span class="pre">session.executeReactive()</span></code>. This is
required because, as mentioned above, the driver always creates single-subscription-only publishers.
Such publishers are not compatible with operators like <code class="docutils literal notranslate"><span class="pre">retry</span></code> because these operators sometimes
subscribe more than once to the upstream publisher, thus causing the driver to throw an exception.
Hopefully it’s easy to solve this issue, and that’s exactly what the <code class="docutils literal notranslate"><span class="pre">defer</span></code> operator is designed
for: each subscription to the <code class="docutils literal notranslate"><span class="pre">defer</span></code> operator triggers a distinct call to
<code class="docutils literal notranslate"><span class="pre">session.executeReactive()</span></code>, thus causing the session to re-execute the query and return a brand-new
publisher at every retry.</p>
<p>Note that the driver already has a <a class="reference external" href="../retries/">built-in retry mechanism</a> that can transparently retry failed
queries; the above example should be seen as a demonstration of application-level retries, when a
more fine-grained control of what should be retried, and how, is required.</p>
</section>
</section>
</section>

                
                    <div class="post-content"><div class="content-navigation">
    <div class="navigation navigation--prev">
        
            <a class="navigation__link" href="../query_timestamps/index.html">
                <button class="navigation__button">
                    <i class="scylla-icon scylla-icon--chevron-left"></i>
                </button>
                <div class="navigation__title">
                    <span class="colored">PREVIOUS</span> <br />Query timestamps
                </div>
            </a>
        
    </div>
    <div class="navigation navigation--next">
        
            <a class="navigation__link" href="../reconnection/index.html">
                <div class="navigation__title">
                    <span class="colored">NEXT</span> <br />Reconnection
                </div>
                <button class="navigation__button">
                    <i class="scylla-icon scylla-icon--chevron-right"></i>
                </button>
            </a>
        
    </div>
</div></div>
                
            </div>
            <div class="sidebar-left  large-order-1">
                
                    
                        <div id="side-nav" class="side-nav custom-scroll-bar" data-closable data-toggler=".show">
    <button class="collapsible-button">
        <i class="scylla-icon scylla-icon--chevron-left"></i>
    </button>
    <div class="side-nav-content">
        <div class="side-nav__search">
            <div class="search-box">
                <ci-search></ci-search>
            </div>
        </div>
        <div class="side-nav__versions">
    <ul class="dropdown menu scylla-dropdown scylla-dropdown--versions" data-dropdown-menu>
        <li class="scylla-dropdown__item">
            <a class="scylla-dropdown__title" href="#">
                
                    4.7.2.x
                
                <i class="chevron scylla-icon scylla-icon--chevron-right"></i>
            </a>
            <ul class="menu scylla-dropdown__content">
                
                    
                        <li>
                            <a href="../../../../stable/index.html">4.13.0.x</a>
                        </li>
                    
                
                    
                        <li>
                            <a href="../../../../scylla-4.12.0.x/index.html">4.12.0.x</a>
                        </li>
                    
                
                    
                        <li>
                            <a href="../../../../scylla-4.11.1.x/index.html">4.11.1.x</a>
                        </li>
                    
                
                    
                        <li>
                            <a href="../../../../scylla-4.10.0.x/index.html">4.10.0.x</a>
                        </li>
                    
                
                    
                        <li>
                            <a href="index.html">4.7.2.x</a>
                        </li>
                    
                
                    
                        <li>
                            <a href="../../../../scylla-3.11.2.x/index.html">3.11.2.x</a>
                        </li>
                    
                
                    
                        <li>
                            <a href="../../../../scylla-3.11.0.x/index.html">3.11.0.x</a>
                        </li>
                    
                
                    
                        <li>
                            <a href="../../../../scylla-3.10.2.x/index.html">3.10.2.x</a>
                        </li>
                    
                
                    
                        <li>
                            <a href="../../../../scylla-3.7.2.x/index.html">3.7.2.x</a>
                        </li>
                    
                
                
            </ul>
        </li>
    </ul>
</div>
        <div class="side-nav__content">
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Java Driver for Scylla and Apache Cassandra®</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api.html">API Documentation</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../../index.html">Manual</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../api_conventions/index.html">API conventions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../case_sensitivity/index.html">Case sensitivity</a></li>
<li class="toctree-l2 current has-children"><a class="reference internal" href="../index.html">Core driver</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label for="toctree-checkbox-2"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../address_resolution/index.html">Address resolution</a></li>
<li class="toctree-l3"><a class="reference internal" href="../async/index.html">Asynchronous programming</a></li>
<li class="toctree-l3"><a class="reference internal" href="../authentication/index.html">Authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="../bom/index.html">Bill of Materials (BOM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../compression/index.html">Compression</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../configuration/index.html">Configuration</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label for="toctree-checkbox-3"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l4"><a class="reference internal" href="../configuration/reference/README.html">Reference configuration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../control_connection/index.html">Control connection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../custom_codecs/index.html">Custom codecs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../detachable_types/index.html">Detachable types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../idempotence/index.html">Query idempotence</a></li>
<li class="toctree-l3"><a class="reference internal" href="../integration/index.html">Integration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../load_balancing/index.html">Load balancing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../logging/index.html">Logging</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../metadata/index.html">Metadata</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label for="toctree-checkbox-4"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l4"><a class="reference internal" href="../metadata/node/index.html">Node metadata</a></li>
<li class="toctree-l4"><a class="reference internal" href="../metadata/schema/index.html">Schema metadata</a></li>
<li class="toctree-l4"><a class="reference internal" href="../metadata/token/index.html">Token metadata</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../metrics/index.html">Metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../native_protocol/index.html">Native protocol</a></li>
<li class="toctree-l3"><a class="reference internal" href="../paging/index.html">Paging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../performance/index.html">Performance</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pooling/index.html">Connection pooling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../query_timestamps/index.html">Query timestamps</a></li>
<li class="toctree-l3 current current-page"><a class="current reference internal" href="#">Reactive Style Programming</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reconnection/index.html">Reconnection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../request_tracker/index.html">Request tracker</a></li>
<li class="toctree-l3"><a class="reference internal" href="../retries/index.html">Retries</a></li>
<li class="toctree-l3"><a class="reference internal" href="../shaded_jar/index.html">Using the shaded JAR</a></li>
<li class="toctree-l3"><a class="reference internal" href="../speculative_execution/index.html">Speculative query execution</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ssl/index.html">SSL</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../statements/index.html">Statements</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label for="toctree-checkbox-5"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l4"><a class="reference internal" href="../statements/batch/index.html">Batch statements</a></li>
<li class="toctree-l4"><a class="reference internal" href="../statements/per_query_keyspace/index.html">Per-query keyspace</a></li>
<li class="toctree-l4"><a class="reference internal" href="../statements/prepared/index.html">Prepared statements</a></li>
<li class="toctree-l4"><a class="reference internal" href="../statements/simple/index.html">Simple statements</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../temporal_types/index.html">Temporal types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../throttling/index.html">Request throttling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tracing/index.html">Query tracing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tuples/index.html">Tuples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../udts/index.html">User-defined types</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../developer/index.html">Developer docs</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label for="toctree-checkbox-6"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../developer/admin/index.html">Administrative tasks</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../developer/common/index.html">Common infrastructure</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label for="toctree-checkbox-7"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l4"><a class="reference internal" href="../../developer/common/concurrency/index.html">Concurrency</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer/common/context/index.html">Driver context</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer/common/event_bus/index.html">Event bus</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../developer/native_protocol/index.html">Native protocol layer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../developer/netty_pipeline/index.html">Netty pipeline</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../developer/request_execution/index.html">Request execution</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../mapper/index.html">Mapper</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label for="toctree-checkbox-8"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../mapper/config/index.html">Integration</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label for="toctree-checkbox-9"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul class="simple">
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../mapper/daos/index.html">DAOs</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label for="toctree-checkbox-10"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l4"><a class="reference internal" href="../../mapper/daos/custom_types/index.html">Custom result types</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../mapper/daos/delete/index.html">Delete methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../mapper/daos/getentity/index.html">GetEntity methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../mapper/daos/insert/index.html">Insert methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../mapper/daos/null_saving/index.html">Null saving strategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../mapper/daos/query/index.html">Query methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../mapper/daos/queryprovider/index.html">Query provider methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../mapper/daos/select/index.html">Select methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../mapper/daos/setentity/index.html">SetEntity methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../mapper/daos/statement_attributes/index.html">Statement attributes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../mapper/daos/update/index.html">Update methods</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../mapper/entities/index.html">Entities</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../mapper/mapper/index.html">Mapper interface</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../osgi/index.html">OSGi</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../query_builder/index.html">Query builder</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label for="toctree-checkbox-11"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../query_builder/condition/index.html">Conditions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../query_builder/delete/index.html">DELETE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../query_builder/idempotence/index.html">Idempotence in the query builder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../query_builder/insert/index.html">INSERT</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../query_builder/relation/index.html">Relations</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../query_builder/schema/index.html">Schema builder</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/><label for="toctree-checkbox-12"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l4"><a class="reference internal" href="../../query_builder/schema/aggregate/index.html">Aggregate</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../query_builder/schema/function/index.html">Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../query_builder/schema/index/index.html">Index</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../query_builder/schema/keyspace/index.html">Keyspace</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../query_builder/schema/materialized_view/index.html">Materialized View</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../query_builder/schema/table/index.html">Table</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../query_builder/schema/type/index.html">Type</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../query_builder/select/index.html">SELECT</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../query_builder/term/index.html">Terms</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../query_builder/truncate/index.html">TRUNCATE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../query_builder/update/index.html">UPDATE</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../upgrade_guide/index.html">Upgrade guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq/index.html">Frequently asked questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog/index.html">Changelog</a></li>
</ul>

        </div>
    </div>
</div>
                    
                
            </div>
            
                <div class="sidebar-right large-order-3">
                    <div class="secondary-side-nav custom-scroll-bar">
    
    <ul class="contribute">
        <li class="contribute__item">
            <a href="https://github.com/scylladb/java-driver/issues/new?title=Issue in page Reactive Style Programming&&body=I%20would%20like%20to%20report%20an%20issue%20in%20page%20https://java-driver.docs.scylladb.com/scylla-4.7.2.x/manual/core/reactive/index%0A%0A%23%23%23%20Problem%0A%0A%23%23%23%20%20Suggest%20a%20fix"
                target="_blank">
                <i class="icon fab fa-github" aria-hidden="true"></i>Create an issue
            </a>
        </li>
        
            <li class="contribute__item">
                
                
                    
                        
                    
                
                <a href="https://github.com/scylladb/java-driver/edit/scylla-4.7.2.x/docs/source/manual/core/reactive/index.md"
                    target="_blank">
                    <i class="icon fa fa-edit" aria-hidden="true"></i>Edit this page
                </a>
            </li>
        
    </ul>

    
        <div class="secondary-side-nav__content">
            <p class="topic-title">On this page</p>
            <ul>
<li><a class="reference internal" href="#">Reactive Style Programming</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#basic-usage">Basic usage</a><ul>
<li><a class="reference internal" href="#reading-in-reactive-style">Reading in reactive style</a></li>
<li><a class="reference internal" href="#writing-in-reactive-style">Writing in reactive style</a></li>
</ul>
</li>
<li><a class="reference internal" href="#accessing-query-metadata">Accessing query metadata</a></li>
<li><a class="reference internal" href="#advanced-topics">Advanced topics</a><ul>
<li><a class="reference internal" href="#applying-backpressure">Applying backpressure</a></li>
<li><a class="reference internal" href="#caching-query-results">Caching query results</a></li>
<li><a class="reference internal" href="#resuming-from-and-retrying-after-failed-queries">Resuming from and retrying after failed queries</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
    
</div>
                </div>
            
        </section>

        <footer class="footer">
    <div class="footer-group">
        <div class="footer-top">
            <a class="footer-logo" href="https://www.scylladb.com">
                <img src="../../../_static/img/logo-scylla-horizontal-RGB.svg" alt="Logo" />
            </a>
            <div class="footer-links">
                <a class="footer-links__link" href="https://docs.scylladb.com/">Docs</a>
                <a class="footer-links__link" href="https://www.scylladb.com/company/contact-us/">Contact Us</a>
                <a class="footer-links__link" href="https://www.scylladb.com/company/">About Us</a>
            </div>
            <div class="footer-actions">
                <a class="footer-actions__link" href="https://groups.google.com/g/scylladb-users" target="_blank">
                    <span data-tooltip tabindex="1" title="User mailing list" data-position="bottom">
                        <img src="../../../_static/img/icons/icon-mail-list.svg" alt="Mail List Icon" />
                    </span>
                </a>
                <a class="footer-actions__link" href="http://slack.scylladb.com/" target="_blank">
                    <span data-tooltip tabindex="1" title="User Slack channel" data-position="bottom">
                        <img src="../../../_static/img/icons/icon-slack.svg" alt="Slack Icon" />
                    </span>
                </a>
            </div>
        </div>

        <div class="footer-bottom">
            
                <div class="footer-bottom__copyright">
                    
                        
                            &#169; 2022, ScyllaDB. All rights reserved.
                        
                    
                </div>
            
            
                <div class="footer-bottom__last-updated">
                    
                        Last updated on 25 May 2022.
                    
                </div>
            
            <div class="footer-bottom__version">
                Powered by
                <a href="http://sphinx-doc.org/">Sphinx 4.3.2</a> &amp;
                <a href="https://sphinx-theme.scylladb.com/">ScyllaDB Theme 1.2.2</a>
            </div>
        </div>
    </div>
</footer>

        <noscript>
            <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T8P2JP" height="0" width="0"
                style="display: none; visibility: hidden"></iframe>
        </noscript>
    </body>

</html>