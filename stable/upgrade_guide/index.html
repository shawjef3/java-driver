

<!DOCTYPE html>
<html class="no-js" lang="en">
    
    

    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width initial-scale=1" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>
             Upgrade guide | Scylla Docs 
        </title>
        <meta name="description" content="Scylla is an Apache Cassandra-compatible NoSQL data store that can handle 1 million transactions per second on a single server." />
        <link rel="icon" href="../_static/img/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="../_static/img/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" href="../_static/img/favicon-228x228.png" sizes="192x192" />
        <link rel="apple-touch-icon" href="../_static/img/favicon-228x228.png" />
        <meta name="msapplication-TileImage" href="../_static/img/favicon-228x228.png" />

        
            
        

        
            
            <link rel="canonical" href="https://java-driver.docs.scylladb.com/stable/upgrade_guide/"/>
        

        <link rel="author" href="mailto:info@scylladb.com" />

        
            
        <!-- increase expertrec loading priority-->
        <link rel="dns-prefetch" href="https://cse.expertrec.com">

        <!-- increase font loading priority -->
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link rel="preload" as="style"
            href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />

        <!-- async CSS -->
        <link rel="stylesheet" media="print" onload="this.onload=null;this.removeAttribute('media');"
            href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />

        <!-- no-JS fallback -->
        <noscript>
            <link rel="stylesheet"
                href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />
        </noscript>
        
            
                <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
            
        
            
                <link rel="stylesheet" type="text/css" href="../_static/css/main.css" />
            
        
            
                <link rel="stylesheet" type="text/css" href="../_static/sphinx_collapse.css" />
            
        
            
                <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
            
        
    
        
        
            

        <script type="text/javascript" id="documentation_options" data-url_root="../"
            src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/js/runtime.bundle.js"></script>
        <script type="text/javascript" src="../_static/js/main.bundle.js"></script>
        
            
                <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
            
        
            
        
            
                <script src="../_static/underscore.js"></script>
            
        
            
                <script src="../_static/doctools.js"></script>
            
        
            
                <script src="../_static/clipboard.min.js"></script>
            
        
            
                <script src="../_static/copybutton.js"></script>
            
        
    
            <!-- Google Tag Manager -->
<script>
    (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({
            "gtm.start": new Date().getTime(),
            event: "gtm.js"
        });
        var f = d.getElementsByTagName(s)[0],
        j = d.createElement(s),
        dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
    })(window, document, "script", "dataLayer", "GTM-T8P2JP");
</script>
<!-- End Google Tag Manager -->

<!-- Expertrec -->
<script>
    var id = "e2077224-9ccf-11e9-a0c9-0242ac130002";
    var ci_search = document.createElement("script");
    ci_search.type = "text/javascript";
    ci_search.async = true;
    ci_search.src = "https://cse.expertrec.com/api/js/ci_common.js?id=" + id;
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(ci_search, s);
</script>
<!-- End Expertrec -->
        
        <!-- Font Awesome -->
        <script src="https://kit.fontawesome.com/b1870adf6a.js" crossorigin="anonymous"></script>
        <!-- End Font Awesome -->
    </head>

    <body>
        
        <header class="header">
    <div class="header-logo">
        <a class="header-logo__img" href="https://scylladb.com/">
            <img src="../_static/img/logo-docs.svg" alt="Scylla Documentation Logo" />
        </a>
        <span class="header-logo__bar"></span>
        <a class="header-logo__text" href="https://docs.scylladb.com/">
            Documentation
        </a>
    </div>
    <div class="header-navigation">
        <ul class="dropdown menu scylla-dropdown scylla-dropdown--header" data-dropdown-menu>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Server
                    <i class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--about-us"></i>
                            Scylla Open Source
                        </a>
                    </li>
                    <li>
                        <a href="https://docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--enterprise"></i>Scylla Enterprise
                        </a>
                    </li>
                    <li>
                        <a href="https://scylla.docs.scylladb.com/stable/alternator/alternator.html">
                            <i class="scylla-icon scylla-icon--overview"></i>
                            Scylla Alternator
                        </a>
                    </li>
                </ul>
            </li>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Cloud <i
                    class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://cloud.scylladb.com/">
                            <i class="scylla-icon scylla-icon--cloud"></i>Scylla Cloud</a>
                    </li>
                    <li>
                        <a href="https://docs.scylladb.com/scylla-cloud/">
                            <i class="scylla-icon scylla-icon--cloud-docs"></i>Scylla Cloud
                            Docs</a>
                    </li>
                </ul>
            </li>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Tools <i
                    class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://manager.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--manager"></i>Scylla Manager</a>
                    </li>
                    <li>
                        <a href="https://monitoring.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--monitoring"></i>Scylla
                            Monitoring Stack</a>
                    </li>
                    <li>
                        <a href="https://operator.docs.scylladb.com/">
                            <i class="scylla-icon scylla-icon--operator"></i>Scylla Operator
                        </a>
                    </li>
                </ul>
            </li>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Drivers <i
                    class="chevron scylla-icon scylla-icon--triangle-down"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://docs.scylladb.com/using-scylla/drivers/cql-drivers/">
                            <i class="scylla-icon scylla-icon--nsql-guides"></i>CQL Drivers
                        </a>
                    </li>
                    <li>
                        <a href="https://docs.scylladb.com/using-scylla/drivers/dynamo-drivers/">
                            <i class="scylla-icon scylla-icon--overview"></i>DynamoDB Drivers
                        </a>
                    </li>
                </ul>
            </li>
        </ul>
        <div class="header-button">
            <a href="https://www.scylladb.com/download/" class="button">Download</a>
        </div>
    </div>
    <div class="header-search-box">
        <div class="search-box">
            <ci-search></ci-search>
        </div>
    </div>
    <div class="side-nav-toggle" data-toggle="side-nav">
    <div class="side-nav-toggle__button">
        <img src="../_static/img/menu.svg" alt="Menu" />
    </div>
</div>
</header>
        <section
            class="layout  layout--sidebar layout--has-secondary-sidebar ">
            <div class="content large-order-2">
                
                    
                
                
                    <div class="pre-content">
                        <div class="breadcrumbs">
    <span class="bread__item">
        <a href="https://java-driver.docs.scylladb.com"
            class="bread__highlight">
            <i class="fas fa-home"></i> Scylla Java Driver
        </a>
    </span>
    
    <span class="bread__item bread__item--last">Upgrade guide</span>
</div>
                    </div>
                
                <section id="upgrade-guide">
<h1>Upgrade guide<a class="headerlink" href="#upgrade-guide" title="Permalink to this headline">¶</a></h1>
<section id="id1">
<h2>4.13.0<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<section id="enhanced-support-for-graalvm-native-images">
<h3>Enhanced support for GraalVM native images<a class="headerlink" href="#enhanced-support-for-graalvm-native-images" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://datastax-oss.atlassian.net/browse/JAVA-2940">JAVA-2940</a> introduced an enhanced support for
building GraalVM native images.</p>
<p>If you were building a native image for your application, please verify your native image builder
configuration. Most of the extra configuration required until now is likely to not be necessary
anymore.</p>
<p>Refer to this <a class="reference external" href="../manual/core/graalvm">manual page</a> for details.</p>
</section>
<section id="registration-of-multiple-listeners-and-trackers">
<h3>Registration of multiple listeners and trackers<a class="headerlink" href="#registration-of-multiple-listeners-and-trackers" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://datastax-oss.atlassian.net/browse/JAVA-2951">JAVA-2951</a> introduced the ability to register
more than one instance of the following interfaces:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.13.0.x/api/com/datastax/oss/driver/api/core/tracker/RequestTracker.html">RequestTracker</a></p></li>
<li><p><a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.13.0.x/api/com/datastax/oss/driver/api/core/metadata/NodeStateListener.html">NodeStateListener</a></p></li>
<li><p><a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.13.0.x/api/com/datastax/oss/driver/api/core/metadata/schema/SchemaChangeListener.html">SchemaChangeListener</a></p></li>
</ul>
<p>Multiple components can now be registered both programmatically and through the configuration. <em>If
both approaches are used, components will add up and will all be registered</em> (whereas previously,
the programmatic approach would take precedence over the configuration one).</p>
<p>When using the programmatic approach to register multiple components, you should use the new
<code class="docutils literal notranslate"><span class="pre">SessionBuilder</span></code> methods <code class="docutils literal notranslate"><span class="pre">addRequestTracker</span></code>, <code class="docutils literal notranslate"><span class="pre">addNodeStateListener</span></code> and  <code class="docutils literal notranslate"><span class="pre">addSchemaChangeListener</span></code>:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">CqlSessionBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="n">CqlSession</span><span class="o">.</span><span class="na">builder</span><span class="o">();</span>
<span class="n">builder</span>
    <span class="o">.</span><span class="na">addRequestTracker</span><span class="o">(</span><span class="n">tracker1</span><span class="o">)</span>
    <span class="o">.</span><span class="na">addRequestTracker</span><span class="o">(</span><span class="n">tracker2</span><span class="o">);</span>
<span class="n">builder</span>
    <span class="o">.</span><span class="na">addNodeStateListener</span><span class="o">(</span><span class="n">nodeStateListener1</span><span class="o">)</span>
    <span class="o">.</span><span class="na">addNodeStateListener</span><span class="o">(</span><span class="n">nodeStateListener2</span><span class="o">);</span>
<span class="n">builder</span>
    <span class="o">.</span><span class="na">addSchemaChangeListener</span><span class="o">(</span><span class="n">schemaChangeListener1</span><span class="o">)</span>
    <span class="o">.</span><span class="na">addSchemaChangeListener</span><span class="o">(</span><span class="n">schemaChangeListener2</span><span class="o">);</span>
</pre></div>
</div>
<p>To support registration of multiple components through the configuration, the following
configuration options were deprecated because they only allow one component to be declared:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">advanced.request-tracker.class</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">advanced.node-state-listener.class</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">advanced.schema-change-listener.class</span></code></p></li>
</ul>
<p>They are still honored, but the driver will log a warning if they are used. They should now be
replaced with the following ones, that accept a list of classes to instantiate, instead of just
one:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">advanced.request-tracker.classes</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">advanced.node-state-listener.classes</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">advanced.schema-change-listener.classes</span></code></p></li>
</ul>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">datastax</span><span class="o">-</span><span class="n">java</span><span class="o">-</span><span class="n">driver</span> <span class="p">{</span>
  <span class="n">advanced</span> <span class="p">{</span>
    <span class="c1"># RequestLogger is a driver built-in tracker</span>
    <span class="n">request</span><span class="o">-</span><span class="n">tracker</span><span class="o">.</span><span class="n">classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">RequestLogger</span><span class="p">,</span><span class="n">com</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">MyRequestTracker</span><span class="p">]</span>
    <span class="n">node</span><span class="o">-</span><span class="n">state</span><span class="o">-</span><span class="n">listener</span><span class="o">.</span><span class="n">classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">com</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">MyNodeStateListener1</span><span class="p">,</span><span class="n">com</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">MyNodeStateListener2</span><span class="p">]</span>
    <span class="n">schema</span><span class="o">-</span><span class="n">change</span><span class="o">-</span><span class="n">listener</span><span class="o">.</span><span class="n">classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">com</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">MySchemaChangeListener</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>When more than one component of the same type is registered, the driver will distribute received
signals to all components in sequence, by order of their registration, starting with the
programmatically-provided ones. If a component throws an error, the error is intercepted and logged.</p>
</section>
</section>
<section id="id2">
<h2>4.12.0<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<section id="microprofile-metrics-upgraded-to-3-0">
<h3>MicroProfile Metrics upgraded to 3.0<a class="headerlink" href="#microprofile-metrics-upgraded-to-3-0" title="Permalink to this headline">¶</a></h3>
<p>The MicroProfile Metrics library has been upgraded from version 2.4 to 3.0. Since this upgrade
involves backwards-incompatible binary changes, users of this library and of the
<code class="docutils literal notranslate"><span class="pre">java-driver-metrics-microprofile</span></code> module are required to take the appropriate action:</p>
<ul class="simple">
<li><p>If your application is still using MicroProfile Metrics &lt; 3.0, you can still upgrade the core
driver to 4.12, but you now must keep <code class="docutils literal notranslate"><span class="pre">java-driver-metrics-microprofile</span></code> in version 4.11 or lower,
as newer versions will not work.</p></li>
<li><p>If your application is using MicroProfile Metrics &gt;= 3.0, then you must upgrade to driver 4.12 or
higher, as previous versions of <code class="docutils literal notranslate"><span class="pre">java-driver-metrics-microprofile</span></code> will not work.</p></li>
</ul>
</section>
<section id="mapper-getentity-and-setentity-methods-can-now-be-lenient">
<h3>Mapper <code class="docutils literal notranslate"><span class="pre">&#64;GetEntity</span></code> and <code class="docutils literal notranslate"><span class="pre">&#64;SetEntity</span></code> methods can now be lenient<a class="headerlink" href="#mapper-getentity-and-setentity-methods-can-now-be-lenient" title="Permalink to this headline">¶</a></h3>
<p>Thanks to <a class="reference external" href="https://datastax-oss.atlassian.net/browse/JAVA-2935">JAVA-2935</a>, <code class="docutils literal notranslate"><span class="pre">&#64;GetEntity</span></code> and
<code class="docutils literal notranslate"><span class="pre">&#64;SetEntity</span></code> methods now have a new <code class="docutils literal notranslate"><span class="pre">lenient</span></code> attribute.</p>
<p>If the attribute is <code class="docutils literal notranslate"><span class="pre">false</span></code> (the default value), then the source row or the target statement must
contain a matching column for every property in the entity definition. If such a column is not
found, an error will be thrown. This corresponds to the mapper’s current behavior prior to the
introduction of the new attribute.</p>
<p>If the new attribute is explicitly set to <code class="docutils literal notranslate"><span class="pre">true</span></code> however, the mapper will operate on a best-effort
basis and attempt to read or write all entity properties that have a matching column in the source
row or in the target statement, <em>leaving unmatched properties untouched</em>.</p>
<p>This new, lenient behavior allows to achieve the equivalent of driver 3.x
<a class="reference external" href="https://docs.datastax.com/en/developer/java-driver/3.10/manual/object_mapper/using/#manual-mapping">lenient mapping</a>.</p>
<p>Read the manual pages on <a class="reference external" href="../manual/mapper/daos/getentity">&#64;GetEntity</a> methods and
<a class="reference external" href="../manual/mapper/daos/setentity">&#64;SetEntity</a> methods for more details and examples of lenient mode.</p>
</section>
</section>
<section id="id3">
<h2>4.11.0<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<section id="native-protocol-v5-is-now-production-ready">
<h3>Native protocol V5 is now production-ready<a class="headerlink" href="#native-protocol-v5-is-now-production-ready" title="Permalink to this headline">¶</a></h3>
<p>Thanks to <a class="reference external" href="https://datastax-oss.atlassian.net/browse/JAVA-2704">JAVA-2704</a>, 4.11.0 is the first
version in the driver 4.x series to fully support Cassandra’s native protocol version 5, which has
been promoted from beta to production-ready in the upcoming Cassandra 4.0 release.</p>
<p>Users should not experience any disruption. When connecting to Cassandra 4.0, V5 will be
transparently selected as the protocol version to use.</p>
</section>
<section id="customizable-metric-names-support-for-metric-tags">
<h3>Customizable metric names, support for metric tags<a class="headerlink" href="#customizable-metric-names-support-for-metric-tags" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://datastax-oss.atlassian.net/browse/JAVA-2872">JAVA-2872</a> introduced the ability to configure
how metric identifiers are generated. Metric names can now be configured, but most importantly,
metric tags are now supported. See the <a class="reference external" href="../manual/core/metrics/">metrics</a> section of the online
manual, or the <code class="docutils literal notranslate"><span class="pre">advanced.metrics.id-generator</span></code> section in the
<a class="reference external" href="../manual/core/configuration/reference/">reference.conf</a> file for details.</p>
<p>Users should not experience any disruption. However, those using metrics libraries that support tags
are encouraged to try out the new <code class="docutils literal notranslate"><span class="pre">TaggingMetricIdGenerator</span></code>, as it generates metric names and tags
that will look more familiar to users of libraries such as Micrometer or MicroProfile Metrics (and
look nicer when exported to Prometheus or Graphite).</p>
</section>
<section id="new-nodedistanceevaluator-api">
<h3>New <code class="docutils literal notranslate"><span class="pre">NodeDistanceEvaluator</span></code> API<a class="headerlink" href="#new-nodedistanceevaluator-api" title="Permalink to this headline">¶</a></h3>
<p>All driver built-in load-balancing policies now accept a new optional component called
<a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.13.0.x/api/com/datastax/oss/driver/api/core/loadbalancing/NodeDistanceEvaluator.html">NodeDistanceEvaluator</a>. This component gets invoked each time a node is added to the cluster or
comes back up. If the evaluator returns a non-null distance for the node, that distance will be
used, otherwise the driver will use its built-in logic to assign a default distance to it.</p>
<p>This component replaces the old “node filter” component. As a consequence, all <code class="docutils literal notranslate"><span class="pre">withNodeFilter</span></code>
methods in <code class="docutils literal notranslate"><span class="pre">SessionBuilder</span></code> are now deprecated and should be replaced by the equivalent
<code class="docutils literal notranslate"><span class="pre">withNodeDistanceEvaluator</span></code> methods.</p>
<p>If you have an existing node filter implementation, it can be converted to a <code class="docutils literal notranslate"><span class="pre">NodeDistanceEvaluator</span></code>
very easily:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Predicate</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&gt;</span> <span class="n">nodeFilter</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">NodeDistanceEvaluator</span> <span class="n">nodeEvaluator</span> <span class="o">=</span> 
    <span class="o">(</span><span class="n">node</span><span class="o">,</span> <span class="n">dc</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">nodeFilter</span><span class="o">.</span><span class="na">test</span><span class="o">(</span><span class="n">node</span><span class="o">)</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">NodeDistance</span><span class="o">.</span><span class="na">IGNORED</span><span class="o">;</span>
</pre></div>
</div>
<p>The above can also be achieved by an adapter class as shown below:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">NodeFilterToDistanceEvaluatorAdapter</span> <span class="kd">implements</span> <span class="n">NodeDistanceEvaluator</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Predicate</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&gt;</span> <span class="n">nodeFilter</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">NodeFilterToDistanceEvaluatorAdapter</span><span class="o">(</span><span class="nd">@NonNull</span> <span class="n">Predicate</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&gt;</span> <span class="n">nodeFilter</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">nodeFilter</span> <span class="o">=</span> <span class="n">nodeFilter</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="nd">@Nullable</span> <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">NodeDistance</span> <span class="nf">evaluateDistance</span><span class="o">(</span><span class="nd">@NonNull</span> <span class="n">Node</span> <span class="n">node</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="n">String</span> <span class="n">localDc</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">nodeFilter</span><span class="o">.</span><span class="na">test</span><span class="o">(</span><span class="n">node</span><span class="o">)</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">NodeDistance</span><span class="o">.</span><span class="na">IGNORED</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Finally, the <code class="docutils literal notranslate"><span class="pre">datastax-java-driver.basic.load-balancing-policy.filter.class</span></code> configuration option
has been deprecated; it should be replaced with a node distance evaluator class defined by the
<code class="docutils literal notranslate"><span class="pre">datastax-java-driver.basic.load-balancing-policy.evaluator.class</span></code> option instead.</p>
</section>
</section>
<section id="id4">
<h2>4.10.0<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<section id="cross-datacenter-failover">
<h3>Cross-datacenter failover<a class="headerlink" href="#cross-datacenter-failover" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://datastax-oss.atlassian.net/browse/JAVA-2899">JAVA-2899</a> re-introduced the ability to
perform cross-datacenter failover using the driver’s built-in load balancing policies. See <a class="reference external" href="../manual/core/loadbalancing/">Load
balancing</a> in the manual for details.</p>
<p>Cross-datacenter failover is disabled by default, therefore existing applications should not
experience any disruption.</p>
</section>
<section id="new-retryverdict-api">
<h3>New <code class="docutils literal notranslate"><span class="pre">RetryVerdict</span></code> API<a class="headerlink" href="#new-retryverdict-api" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://datastax-oss.atlassian.net/browse/JAVA-2900">JAVA-2900</a> introduced <a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.13.0.x/api/com/datastax/oss/driver/api/core/retry/RetryVerdict.html"><code class="docutils literal notranslate"><span class="pre">RetryVerdict</span></code></a>, a new
interface that allows custom retry policies to customize the request before it is retried.</p>
<p>For this reason, the following methods in the <code class="docutils literal notranslate"><span class="pre">RetryPolicy</span></code> interface were added; they all return
a <code class="docutils literal notranslate"><span class="pre">RetryVerdict</span></code> instance:</p>
<ol class="simple">
<li><p><a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.13.0.x/api/com/datastax/oss/driver/api/core/retry/RetryPolicy.html#onReadTimeoutVerdict-com.datastax.oss.driver.api.core.session.Request-com.datastax.oss.driver.api.core.ConsistencyLevel-int-int-boolean-int-"><code class="docutils literal notranslate"><span class="pre">onReadTimeoutVerdict</span></code></a></p></li>
<li><p><a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.13.0.x/api/com/datastax/oss/driver/api/core/retry/RetryPolicy.html#onWriteTimeoutVerdict-com.datastax.oss.driver.api.core.session.Request-com.datastax.oss.driver.api.core.ConsistencyLevel-com.datastax.oss.driver.api.core.servererrors.WriteType-int-int-int-"><code class="docutils literal notranslate"><span class="pre">onWriteTimeoutVerdict</span></code></a></p></li>
<li><p><a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.13.0.x/api/com/datastax/oss/driver/api/core/retry/RetryPolicy.html#onUnavailableVerdict-com.datastax.oss.driver.api.core.session.Request-com.datastax.oss.driver.api.core.ConsistencyLevel-int-int-int-"><code class="docutils literal notranslate"><span class="pre">onUnavailableVerdict</span></code></a></p></li>
<li><p><a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.13.0.x/api/com/datastax/oss/driver/api/core/retry/RetryPolicy.html#onRequestAbortedVerdict-com.datastax.oss.driver.api.core.session.Request-java.lang.Throwable-int-"><code class="docutils literal notranslate"><span class="pre">onRequestAbortedVerdict</span></code></a></p></li>
<li><p><a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.13.0.x/api/com/datastax/oss/driver/api/core/retry/RetryPolicy.html#onErrorResponseVerdict-com.datastax.oss.driver.api.core.session.Request-com.datastax.oss.driver.api.core.servererrors.CoordinatorException-int-"><code class="docutils literal notranslate"><span class="pre">onErrorResponseVerdict</span></code></a></p></li>
</ol>
<p>The following methods were deprecated and will be removed in the next major version:</p>
<ol class="simple">
<li><p><a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.13.0.x/api/com/datastax/oss/driver/api/core/retry/RetryPolicy.html#onReadTimeout-com.datastax.oss.driver.api.core.session.Request-com.datastax.oss.driver.api.core.ConsistencyLevel-int-int-boolean-int-"><code class="docutils literal notranslate"><span class="pre">onReadTimeout</span></code></a></p></li>
<li><p><a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.13.0.x/api/com/datastax/oss/driver/api/core/retry/RetryPolicy.html#onWriteTimeout-com.datastax.oss.driver.api.core.session.Request-com.datastax.oss.driver.api.core.ConsistencyLevel-com.datastax.oss.driver.api.core.servererrors.WriteType-int-int-int-"><code class="docutils literal notranslate"><span class="pre">onWriteTimeout</span></code></a></p></li>
<li><p><a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.13.0.x/api/com/datastax/oss/driver/api/core/retry/RetryPolicy.html#onUnavailable-com.datastax.oss.driver.api.core.session.Request-com.datastax.oss.driver.api.core.ConsistencyLevel-int-int-int-"><code class="docutils literal notranslate"><span class="pre">onUnavailable</span></code></a></p></li>
<li><p><a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.13.0.x/api/com/datastax/oss/driver/api/core/retry/RetryPolicy.html#onRequestAborted-com.datastax.oss.driver.api.core.session.Request-java.lang.Throwable-int-"><code class="docutils literal notranslate"><span class="pre">onRequestAborted</span></code></a></p></li>
<li><p><a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.13.0.x/api/com/datastax/oss/driver/api/core/retry/RetryPolicy.html#onErrorResponse-com.datastax.oss.driver.api.core.session.Request-com.datastax.oss.driver.api.core.servererrors.CoordinatorException-int-"><code class="docutils literal notranslate"><span class="pre">onErrorResponse</span></code></a></p></li>
</ol>
<p>Driver 4.10.0 also re-introduced a retry policy whose behavior is equivalent to the
<code class="docutils literal notranslate"><span class="pre">DowngradingConsistencyRetryPolicy</span></code> from driver 3.x. See this
<a class="reference external" href="https://docs.datastax.com/en/developer/java-driver/4.11/faq/#where-is-downgrading-consistency-retry-policy">FAQ entry</a>
for more information.</p>
</section>
<section id="enhancements-to-the-uuids-utility-class">
<h3>Enhancements to the <code class="docutils literal notranslate"><span class="pre">Uuids</span></code> utility class<a class="headerlink" href="#enhancements-to-the-uuids-utility-class" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://datastax-oss.atlassian.net/browse/JAVA-2449">JAVA-2449</a> modified the implementation of
<a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.13.0.x/api/com/datastax/oss/driver/api/core/uuid/Uuids.html#random--">Uuids.random()</a>: this method does not delegate anymore to the JDK’s <code class="docutils literal notranslate"><span class="pre">java.util.UUID.randomUUID()</span></code>
implementation, but instead re-implements random UUID generation using the non-cryptographic
random number generator <code class="docutils literal notranslate"><span class="pre">java.util.Random</span></code>.</p>
<p>For most users, non-cryptographic strength is enough and this change should translate into better
performance when generating UUIDs for database insertion. However, in the unlikely case where your
application requires cryptographic strength for UUID generation, you should update your code to
use <code class="docutils literal notranslate"><span class="pre">java.util.UUID.randomUUID()</span></code> instead of <code class="docutils literal notranslate"><span class="pre">com.datastax.oss.driver.api.core.uuid.Uuids.random()</span></code>
from now on.</p>
<p>This release also introduces two new methods for random UUID generation:</p>
<ol class="simple">
<li><p><a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.13.0.x/api/com/datastax/oss/driver/api/core/uuid/Uuids.html#random-java.util.Random-">Uuids.random(Random)</a>: similar to <code class="docutils literal notranslate"><span class="pre">Uuids.random()</span></code> but allows to pass a custom instance of
<code class="docutils literal notranslate"><span class="pre">java.util.Random</span></code> and/or re-use the same instance across calls.</p></li>
<li><p><a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.13.0.x/api/com/datastax/oss/driver/api/core/uuid/Uuids.html#random-java.util.SplittableRandom-">Uuids.random(SplittableRandom)</a>: similar to <code class="docutils literal notranslate"><span class="pre">Uuids.random()</span></code> but uses a
<code class="docutils literal notranslate"><span class="pre">java.util.SplittableRandom</span></code> instead.</p></li>
</ol>
</section>
<section id="system-and-dse-keyspaces-automatically-excluded-from-metadata-and-token-map-computation">
<h3>System and DSE keyspaces automatically excluded from metadata and token map computation<a class="headerlink" href="#system-and-dse-keyspaces-automatically-excluded-from-metadata-and-token-map-computation" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://datastax-oss.atlassian.net/browse/JAVA-2871">JAVA-2871</a> now allows for a more fine-grained
control over which keyspaces should qualify for metadata and token map computation, including the
ability to <em>exclude</em> keyspaces based on their names.</p>
<p>From now on, the following keyspaces are automatically excluded:</p>
<ol class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">system</span></code> keyspace;</p></li>
<li><p>All keyspaces starting with <code class="docutils literal notranslate"><span class="pre">system_</span></code>;</p></li>
<li><p>DSE-specific keyspaces:</p>
<ol class="simple">
<li><p>All keyspaces starting with <code class="docutils literal notranslate"><span class="pre">dse_</span></code>;</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">solr_admin</span></code> keyspace;</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">OpsCenter</span></code> keyspace.</p></li>
</ol>
</li>
</ol>
<p>This means that they won’t show up anymore in <a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.13.0.x/api/com/datastax/oss/driver/api/core/metadata/Metadata.html#getKeyspaces--">Metadata.getKeyspaces()</a>, and <a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.13.0.x/api/com/datastax/oss/driver/api/core/metadata/TokenMap.html">TokenMap</a> will return
empty replicas and token ranges for them. If you need the driver to keep computing metadata and
token map for these keyspaces, you now must modify the following configuration option:
<code class="docutils literal notranslate"><span class="pre">datastax-java-driver.advanced.metadata.schema.refreshed-keyspaces</span></code>.</p>
</section>
<section id="dse-graph-dependencies-are-now-optional">
<h3>DSE Graph dependencies are now optional<a class="headerlink" href="#dse-graph-dependencies-are-now-optional" title="Permalink to this headline">¶</a></h3>
<p>Until driver 4.9.0, the driver declared a mandatory dependency to Apache TinkerPop, a library
required only when connecting to DSE Graph. The vast majority of Apache Cassandra users did not need
that library, but were paying the price of having that heavy-weight library in their application’s
classpath.</p>
<p><em>Starting with driver 4.10.0, TinkerPop is now considered an optional dependency</em>.</p>
<p>Regular users of Apache Cassandra that do not use DSE Graph will not notice any disruption.</p>
<p>DSE Graph users, however, will now have to explicitly declare a dependency to Apache TinkerPop. This
can be achieved with Maven by adding the following dependencies to the <code class="docutils literal notranslate"><span class="pre">&lt;dependencies&gt;</span></code> section of
your POM file:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.apache.tinkerpop<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>gremlin-core<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>${tinkerpop.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.apache.tinkerpop<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>tinkergraph-gremlin<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>${tinkerpop.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
<p>See the <a class="reference external" href="../manual/core/integration/#tinker-pop">integration</a> section in the manual for more details
as well as a driver vs. TinkerPop version compatibility matrix.</p>
</section>
</section>
<section id="x-4-6-0">
<h2>4.5.x - 4.6.0<a class="headerlink" href="#x-4-6-0" title="Permalink to this headline">¶</a></h2>
<p>These versions are subject to <a class="reference external" href="https://datastax-oss.atlassian.net/browse/JAVA-2676">JAVA-2676</a>, a
bug that causes performance degradations in certain scenarios. We strongly recommend upgrading to at
least 4.6.1.</p>
</section>
<section id="id5">
<h2>4.4.0<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<p>Datastax Enterprise support is now available directly in the main driver. There is no longer a
separate DSE driver.</p>
<section id="for-apache-cassandra-users">
<h3>For Apache Cassandra® users<a class="headerlink" href="#for-apache-cassandra-users" title="Permalink to this headline">¶</a></h3>
<p>The great news is that <a class="reference external" href="../manual/core/reactive/">reactive execution</a> is now available for everyone.
See the <code class="docutils literal notranslate"><span class="pre">CqlSession.executeReactive</span></code> methods.</p>
<p>Apart from that, the only visible change is that DSE-specific features are now exposed in the API:</p>
<ul class="simple">
<li><p>new execution methods: <code class="docutils literal notranslate"><span class="pre">CqlSession.executeGraph</span></code>, <code class="docutils literal notranslate"><span class="pre">CqlSession.executeContinuously*</span></code>. They all
have default implementations so this doesn’t break binary compatibility. You can just ignore them.</p></li>
<li><p>new driver dependencies: TinkerPop, ESRI, Reactive Streams. If you want to keep your classpath
lean, you can exclude some dependencies when you don’t use the corresponding DSE features; see the
<a class="reference external" href="../manual/core/integration/#driver-dependencies">Integration&gt;Driver dependencies</a> section.</p></li>
</ul>
</section>
<section id="for-datastax-enterprise-users">
<h3>For Datastax Enterprise users<a class="headerlink" href="#for-datastax-enterprise-users" title="Permalink to this headline">¶</a></h3>
<p>Adjust your Maven coordinates to use the unified artifact:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="c">&lt;!-- Replace: --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.datastax.dse<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>dse-java-driver-core<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>2.3.0<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="c">&lt;!-- By: --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.scylladb<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>java-driver-core<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>4.4.0<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="c">&lt;!-- Do the same for the other modules: query builder, mapper... --&gt;</span>
</pre></div>
</div>
<p>The new driver is a drop-in replacement for the DSE driver. Note however that we’ve deprecated a few
DSE-specific types in favor of their OSS equivalents. They still work, so you don’t need to make the
changes right away; but you will get deprecation warnings:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">DseSession</span></code>: use <code class="docutils literal notranslate"><span class="pre">CqlSession</span></code> instead, it can now do everything that a DSE session does. This
also applies to the builder:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// Replace:</span>
<span class="n">DseSession</span> <span class="n">session</span> <span class="o">=</span> <span class="n">DseSession</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">build</span><span class="o">()</span>  

<span class="c1">// By:</span>
<span class="n">CqlSession</span> <span class="n">session</span> <span class="o">=</span> <span class="n">CqlSession</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">build</span><span class="o">()</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">DseDriverConfigLoader</span></code>: the driver no longer needs DSE-specific config loaders. All the factory
methods in this class now redirect to <code class="docutils literal notranslate"><span class="pre">DriverConfigLoader</span></code>. On that note, <code class="docutils literal notranslate"><span class="pre">dse-reference.conf</span></code>
does not exist anymore, all the driver defaults are now in
<a class="reference external" href="../manual/core/configuration/reference/">reference.conf</a>.</p></li>
<li><p>plain-text authentication: there is now a single implementation that works with both Cassandra and
DSE. If you used <code class="docutils literal notranslate"><span class="pre">DseProgrammaticPlainTextAuthProvider</span></code>, replace it by
<code class="docutils literal notranslate"><span class="pre">PlainTextProgrammaticAuthProvider</span></code>. Similarly, if you wrote a custom implementation by
subclassing <code class="docutils literal notranslate"><span class="pre">DsePlainTextAuthProviderBase</span></code>, extend <code class="docutils literal notranslate"><span class="pre">PlainTextAuthProviderBase</span></code> instead.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DseLoadBalancingPolicy</span></code>: DSE-specific features (the slow replica avoidance mechanism) have been
merged into <code class="docutils literal notranslate"><span class="pre">DefaultLoadBalancingPolicy</span></code>. <code class="docutils literal notranslate"><span class="pre">DseLoadBalancingPolicy</span></code> still exists for backward
compatibility, but it is now identical to the default policy.</p></li>
</ul>
</section>
<section id="class-loader">
<h3>Class Loader<a class="headerlink" href="#class-loader" title="Permalink to this headline">¶</a></h3>
<p>The default class loader used by the driver when instantiating classes by reflection changed.
Unless specified by the user, the driver will now use the same class loader that was used to load
the driver classes themselves, in order to ensure that implemented interfaces and implementing
classes are fully compatible.</p>
<p>This should ensure a more streamlined experience for OSGi users, who do not need anymore to define
a specific class loader to use.</p>
<p>However if you are developing a web application and your setup corresponds to the following
scenario, then you will now be required to explicitly define another class loader to use: if in your
application the driver jar is loaded by the web server’s system class loader (for example,
because the driver jar was placed in the “/lib” folder of the web server), then the default class
loader will be the server’s system class loader. Then if the application tries to load, say, a
custom load balancing policy declared in the web app’s “WEB-INF/lib” folder, then the default class
loader will not be able to locate that class. Instead, you must use the web app’s class loader, that
you can obtain in most web environments by calling <code class="docutils literal notranslate"><span class="pre">Thread.getContextClassLoader()</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CqlSession</span><span class="o">.</span><span class="n">builder</span><span class="p">()</span>
    <span class="o">.</span><span class="n">addContactEndPoint</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="o">.</span><span class="n">withClassLoader</span><span class="p">(</span><span class="n">Thread</span><span class="o">.</span><span class="n">currentThread</span><span class="p">()</span><span class="o">.</span><span class="n">getContextClassLoader</span><span class="p">())</span>
    <span class="o">.</span><span class="n">build</span><span class="p">();</span>
</pre></div>
</div>
<p>See the javadocs of <a class="reference external" href="https://java-driver.docs.scylladb.com/scylla-4.13.0.x/api/com/datastax/oss/driver/api/core/session/SessionBuilder.html#withClassLoader-java.lang.ClassLoader-">SessionBuilder.withClassLoader</a> for more information.</p>
</section>
</section>
<section id="id6">
<h2>4.1.0<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<section id="object-mapper">
<h3>Object mapper<a class="headerlink" href="#object-mapper" title="Permalink to this headline">¶</a></h3>
<p>4.1.0 marks the introduction of the new object mapper in the 4.x series.</p>
<p>Like driver 3, it relies on annotations to configure mapped entities and queries. However, there are
a few notable differences:</p>
<ul class="simple">
<li><p>it uses compile-time annotation processing instead of runtime reflection;</p></li>
<li><p>the “mapper” and “accessor” concepts have been unified into a single “DAO” component, that handles
both pre-defined CRUD patterns, and user-provided queries.</p></li>
</ul>
<p>Refer to the <a class="reference external" href="../manual/mapper/">mapper manual</a> for all the details.</p>
</section>
<section id="internal-api">
<h3>Internal API<a class="headerlink" href="#internal-api" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">NettyOptions#afterBootstrapInitialized</span></code> is now responsible for setting socket options on driver
connections (see <code class="docutils literal notranslate"><span class="pre">advanced.socket</span></code> in the configuration). If you had written a custom <code class="docutils literal notranslate"><span class="pre">NettyOptions</span></code>
for 4.0, you’ll have to copy over – and possibly adapt – the contents of
<code class="docutils literal notranslate"><span class="pre">DefaultNettyOptions#afterBootstrapInitialized</span></code> (if you didn’t override <code class="docutils literal notranslate"><span class="pre">NettyOptions</span></code>, you don’t
have to change anything).</p>
</section>
</section>
<section id="id7">
<h2>4.0.0<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h2>
<p>Version 4 is major redesign of the internal architecture. As such, it is <strong>not binary compatible</strong>
with previous versions. However, most of the concepts remain unchanged, and the new API will look
very familiar to 2.x and 3.x users.</p>
<section id="new-maven-coordinates">
<h3>New Maven coordinates<a class="headerlink" href="#new-maven-coordinates" title="Permalink to this headline">¶</a></h3>
<p>The core driver is available from:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.scylladb<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>java-driver-core<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>4.8.0-scylla-0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
</section>
<section id="runtime-requirements">
<h3>Runtime requirements<a class="headerlink" href="#runtime-requirements" title="Permalink to this headline">¶</a></h3>
<p>The driver now requires <strong>Java 8 or above</strong>. It does not depend on Guava anymore (we still use it
internally but it’s shaded).</p>
<p>We have dropped support for legacy protocol versions v1 and v2. As a result, the driver is
compatible with:</p>
<ul class="simple">
<li><p><strong>Apache Cassandra®: 2.1 and above</strong>;</p></li>
<li><p><strong>Datastax Enterprise: 4.7 and above</strong>.</p></li>
</ul>
</section>
<section id="packages">
<h3>Packages<a class="headerlink" href="#packages" title="Permalink to this headline">¶</a></h3>
<p>We’ve adopted new <a class="reference external" href="../manual/api_conventions">API conventions</a> to better organize the driver code and make it more modular. As
a result, package names have changed. However most public API types have the same names; you can use
the auto-import or “find class” features of your IDE to discover the new locations.</p>
<p>Here’s a side-by-side comparison with the legacy driver for a basic example:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// Driver 3:</span>
<span class="kn">import</span> <span class="nn">com.datastax.driver.core.ResultSet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.datastax.driver.core.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.datastax.driver.core.SimpleStatement</span><span class="o">;</span>

<span class="n">SimpleStatement</span> <span class="n">statement</span> <span class="o">=</span>
  <span class="k">new</span> <span class="n">SimpleStatement</span><span class="o">(</span><span class="s">&quot;SELECT release_version FROM system.local&quot;</span><span class="o">);</span>
<span class="n">ResultSet</span> <span class="n">resultSet</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">statement</span><span class="o">);</span>
<span class="n">Row</span> <span class="n">row</span> <span class="o">=</span> <span class="n">resultSet</span><span class="o">.</span><span class="na">one</span><span class="o">();</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">row</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;release_version&quot;</span><span class="o">));</span>


<span class="c1">// Driver 4:</span>
<span class="kn">import</span> <span class="nn">com.datastax.oss.driver.api.core.cql.ResultSet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.datastax.oss.driver.api.core.cql.Row</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.datastax.oss.driver.api.core.cql.SimpleStatement</span><span class="o">;</span>

<span class="n">SimpleStatement</span> <span class="n">statement</span> <span class="o">=</span>
  <span class="n">SimpleStatement</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="s">&quot;SELECT release_version FROM system.local&quot;</span><span class="o">);</span>
<span class="n">ResultSet</span> <span class="n">resultSet</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">statement</span><span class="o">);</span>
<span class="n">Row</span> <span class="n">row</span> <span class="o">=</span> <span class="n">resultSet</span><span class="o">.</span><span class="na">one</span><span class="o">();</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">row</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;release_version&quot;</span><span class="o">));</span>
</pre></div>
</div>
<p>Notable changes:</p>
<ul class="simple">
<li><p>the imports;</p></li>
<li><p>simple statement instances are now created with the <code class="docutils literal notranslate"><span class="pre">newInstance</span></code> static factory method. This is
because <code class="docutils literal notranslate"><span class="pre">SimpleStatement</span></code> is now an interface (as most public API types).</p></li>
</ul>
</section>
<section id="configuration">
<h3>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h3>
<p>The configuration has been completely revamped. Instead of ad-hoc configuration classes, the default
mechanism is now file-based, using the <a class="reference external" href="https://github.com/typesafehub/config">Typesafe Config</a> library. This is a better choice for most
deployments, since it allows configuration changes without recompiling the client application (note
that there are still programmatic setters for things that are likely to be injected dynamically,
such as contact points).</p>
<p>The driver JAR contains a <code class="docutils literal notranslate"><span class="pre">reference.conf</span></code> file that defines the options with their defaults:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">datastax</span><span class="o">-</span><span class="n">java</span><span class="o">-</span><span class="n">driver</span> <span class="p">{</span>
  <span class="n">basic</span><span class="o">.</span><span class="n">request</span> <span class="p">{</span>
    <span class="n">timeout</span> <span class="o">=</span> <span class="mi">2</span> <span class="n">seconds</span>
    <span class="n">consistency</span> <span class="o">=</span> <span class="n">LOCAL_ONE</span>
    <span class="n">page</span><span class="o">-</span><span class="n">size</span> <span class="o">=</span> <span class="mi">5000</span>
  <span class="p">}</span>
  <span class="o">//</span> <span class="o">...</span> <span class="ow">and</span> <span class="n">many</span> <span class="n">more</span> <span class="p">(</span><span class="o">~</span><span class="mi">10</span> <span class="n">basic</span> <span class="n">options</span><span class="p">,</span> <span class="mi">70</span> <span class="n">advanced</span> <span class="n">ones</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You can place an <code class="docutils literal notranslate"><span class="pre">application.conf</span></code> in your application’s classpath to override options selectively:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">datastax</span><span class="o">-</span><span class="n">java</span><span class="o">-</span><span class="n">driver</span> <span class="p">{</span>
  <span class="n">basic</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">consistency</span> <span class="o">=</span> <span class="n">ONE</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Options can also be overridden with system properties when launching your application:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">java</span> <span class="o">-</span><span class="n">Ddatastax</span><span class="o">-</span><span class="n">java</span><span class="o">-</span><span class="n">driver</span><span class="o">.</span><span class="n">basic</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">consistency</span><span class="o">=</span><span class="n">ONE</span> <span class="n">MyApp</span>
</pre></div>
</div>
<p>The configuration also supports <em>execution profiles</em>, that allow you to capture and reuse common
sets of options:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// application.conf:</span>
<span class="n">datastax</span><span class="o">-</span><span class="n">java</span><span class="o">-</span><span class="n">driver</span> <span class="o">{</span>
  <span class="n">profiles</span> <span class="o">{</span>
    <span class="n">profile1</span> <span class="o">{</span> <span class="n">basic</span><span class="o">.</span><span class="na">request</span><span class="o">.</span><span class="na">consistency</span> <span class="o">=</span> <span class="n">QUORUM</span> <span class="o">}</span>
    <span class="n">profile2</span> <span class="o">{</span> <span class="n">basic</span><span class="o">.</span><span class="na">request</span><span class="o">.</span><span class="na">consistency</span> <span class="o">=</span> <span class="n">ONE</span> <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// Application code:</span>
<span class="n">SimpleStatement</span> <span class="n">statement1</span> <span class="o">=</span>
  <span class="n">SimpleStatement</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="s">&quot;...&quot;</span><span class="o">).</span><span class="na">setExecutionProfileName</span><span class="o">(</span><span class="s">&quot;profile1&quot;</span><span class="o">);</span>
<span class="n">SimpleStatement</span> <span class="n">statement2</span> <span class="o">=</span>
  <span class="n">SimpleStatement</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="s">&quot;...&quot;</span><span class="o">).</span><span class="na">setExecutionProfileName</span><span class="o">(</span><span class="s">&quot;profile2&quot;</span><span class="o">);</span>
</pre></div>
</div>
<p>The configuration can be reloaded periodically at runtime:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">datastax</span><span class="o">-</span><span class="n">java</span><span class="o">-</span><span class="n">driver</span> <span class="p">{</span>
  <span class="n">basic</span><span class="o">.</span><span class="n">config</span><span class="o">-</span><span class="n">reload</span><span class="o">-</span><span class="n">interval</span> <span class="o">=</span> <span class="mi">5</span> <span class="n">minutes</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This is fully customizable: the configuration is exposed to the rest of the driver as an abstract
<code class="docutils literal notranslate"><span class="pre">DriverConfig</span></code> interface; if the default implementation doesn’t work for you, you can write your
own.</p>
<p>For more details, refer to the <a class="reference external" href="../manual/core/configuration">manual</a>.</p>
</section>
<section id="session">
<h3>Session<a class="headerlink" href="#session" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Cluster</span></code> does not exist anymore; the session is now the main component, initialized in a single
step:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">CqlSession</span> <span class="n">session</span> <span class="o">=</span> <span class="n">CqlSession</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>
<span class="n">session</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="s">&quot;...&quot;</span><span class="o">);</span>
</pre></div>
</div>
<p>Protocol negotiation in mixed clusters has been improved: you no longer need to force the protocol
version during a rolling upgrade. The driver will detect that there are older nodes, and downgrade
to the best common denominator (see
<a class="reference external" href="https://datastax-oss.atlassian.net/browse/JAVA-1295">JAVA-1295</a>).</p>
<p>Reconnection is now possible at startup: if no contact point is reachable, the driver will retry at
periodic intervals (controlled by the <a class="reference external" href="../manual/core/reconnection/">reconnection policy</a>) instead
of throwing an error. To turn this on, set the following configuration option:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">datastax</span><span class="o">-</span><span class="n">java</span><span class="o">-</span><span class="n">driver</span> <span class="p">{</span>
  <span class="n">advanced</span><span class="o">.</span><span class="n">reconnect</span><span class="o">-</span><span class="n">on</span><span class="o">-</span><span class="n">init</span> <span class="o">=</span> <span class="n">true</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The session now has a built-in <a class="reference external" href="../manual/core/throttling/">throttler</a> to limit how many requests
can execute concurrently. Here’s an example based on the number of requests (a rate-based variant is
also available):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>datastax-java-driver {
  advanced.throttler {
    class = ConcurrencyLimitingRequestThrottler
    max-concurrent-requests = 10000
    max-queue-size = 100000
  }
}
</pre></div>
</div>
</section>
<section id="load-balancing-policy">
<h3>Load balancing policy<a class="headerlink" href="#load-balancing-policy" title="Permalink to this headline">¶</a></h3>
<p>Previous driver versions came with multiple load balancing policies that could be nested into each
other. In our experience, this was one of the most complicated aspects of the configuration.</p>
<p>In driver 4, we are taking a more opinionated approach: we provide a single <a class="reference external" href="../manual/core/load_balancing/#default-policy">default
policy</a>, with what we consider as the best practices:</p>
<ul class="simple">
<li><p>local only: we believe that failover should be handled at infrastructure level, not by application
code.</p></li>
<li><p>token-aware.</p></li>
<li><p>optionally filtering nodes with a custom predicate.</p></li>
</ul>
<p>You can still provide your own policy by implementing the <code class="docutils literal notranslate"><span class="pre">LoadBalancingPolicy</span></code> interface.</p>
</section>
<section id="statements">
<h3>Statements<a class="headerlink" href="#statements" title="Permalink to this headline">¶</a></h3>
<p>Simple, bound and batch <a class="reference external" href="../manual/core/statements/">statements</a> are now exposed in the public API
as interfaces. The internal implementations are <strong>immutable</strong>. This makes them automatically
thread-safe: you don’t need to worry anymore about sharing them or reusing them between asynchronous
executions.</p>
<p>Note that all mutating methods return a new instance, so <strong>make sure you don’t accidentally ignore
their result</strong>:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">BoundStatement</span> <span class="n">boundSelect</span> <span class="o">=</span> <span class="n">preparedSelect</span><span class="o">.</span><span class="na">bind</span><span class="o">();</span>

<span class="c1">// This doesn&#39;t work: setInt doesn&#39;t modify boundSelect in place:</span>
<span class="n">boundSelect</span><span class="o">.</span><span class="na">setInt</span><span class="o">(</span><span class="s">&quot;k&quot;</span><span class="o">,</span> <span class="n">key</span><span class="o">);</span>
<span class="n">session</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">boundSelect</span><span class="o">);</span>

<span class="c1">// Instead, reassign the statement every time:</span>
<span class="n">boundSelect</span> <span class="o">=</span> <span class="n">boundSelect</span><span class="o">.</span><span class="na">setInt</span><span class="o">(</span><span class="s">&quot;k&quot;</span><span class="o">,</span> <span class="n">key</span><span class="o">);</span>
</pre></div>
</div>
<p>These methods are annotated with <code class="docutils literal notranslate"><span class="pre">&#64;CheckReturnValue</span></code>. Some code analysis tools – such as
<a class="reference external" href="https://errorprone.info/">ErrorProne</a> – can check correct usage at build time, and report mistakes
as compiler errors.</p>
<p>Unlike 3.x, the request timeout now spans the <em>entire</em> request. In other words, it’s the
maximum amount of time that <code class="docutils literal notranslate"><span class="pre">session.execute</span></code> will take, including any retry, speculative execution,
etc. You can set it with <code class="docutils literal notranslate"><span class="pre">Statement.setTimeout</span></code>, or globally in the configuration with the
<code class="docutils literal notranslate"><span class="pre">basic.request.timeout</span></code> option.</p>
<p><a class="reference external" href="../manual/core/statements/prepared/">Prepared statements</a> are now cached client-side: if you call
<code class="docutils literal notranslate"><span class="pre">session.prepare()</span></code> twice with the same query string, it will no longer log a warning. The second
call will return the same statement instance, without sending anything to the server:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">PreparedStatement</span> <span class="n">ps1</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">prepare</span><span class="o">(</span><span class="s">&quot;SELECT * FROM product WHERE sku = ?&quot;</span><span class="o">);</span>
<span class="n">PreparedStatement</span> <span class="n">ps2</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">prepare</span><span class="o">(</span><span class="s">&quot;SELECT * FROM product WHERE sku = ?&quot;</span><span class="o">);</span>
<span class="k">assert</span> <span class="n">ps1</span> <span class="o">==</span> <span class="n">ps2</span><span class="o">;</span>
</pre></div>
</div>
<p>This cache takes into account all execution parameters. For example, if you prepare the same query
string with different consistency levels, you will get two distinct prepared statements, each
propagating its own consistency level to its bound statements:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">PreparedStatement</span> <span class="n">ps1</span> <span class="o">=</span>
  <span class="n">session</span><span class="o">.</span><span class="na">prepare</span><span class="o">(</span>
      <span class="n">SimpleStatement</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="s">&quot;SELECT * FROM product WHERE sku = ?&quot;</span><span class="o">)</span>
          <span class="o">.</span><span class="na">setConsistencyLevel</span><span class="o">(</span><span class="n">DefaultConsistencyLevel</span><span class="o">.</span><span class="na">ONE</span><span class="o">));</span>
<span class="n">PreparedStatement</span> <span class="n">ps2</span> <span class="o">=</span>
  <span class="n">session</span><span class="o">.</span><span class="na">prepare</span><span class="o">(</span>
      <span class="n">SimpleStatement</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="s">&quot;SELECT * FROM product WHERE sku = ?&quot;</span><span class="o">)</span>
          <span class="o">.</span><span class="na">setConsistencyLevel</span><span class="o">(</span><span class="n">DefaultConsistencyLevel</span><span class="o">.</span><span class="na">TWO</span><span class="o">));</span>

<span class="k">assert</span> <span class="n">ps1</span> <span class="o">!=</span> <span class="n">ps2</span><span class="o">;</span>

<span class="n">BoundStatement</span> <span class="n">bs1</span> <span class="o">=</span> <span class="n">ps1</span><span class="o">.</span><span class="na">bind</span><span class="o">();</span>
<span class="k">assert</span> <span class="n">bs1</span><span class="o">.</span><span class="na">getConsistencyLevel</span><span class="o">()</span> <span class="o">==</span> <span class="n">DefaultConsistencyLevel</span><span class="o">.</span><span class="na">ONE</span><span class="o">;</span>

<span class="n">BoundStatement</span> <span class="n">bs2</span> <span class="o">=</span> <span class="n">ps2</span><span class="o">.</span><span class="na">bind</span><span class="o">();</span>
<span class="k">assert</span> <span class="n">bs2</span><span class="o">.</span><span class="na">getConsistencyLevel</span><span class="o">()</span> <span class="o">==</span> <span class="n">DefaultConsistencyLevel</span><span class="o">.</span><span class="na">TWO</span><span class="o">;</span>
</pre></div>
</div>
<p>DDL statements are now debounced; see <a class="reference external" href="../faq/#why-do-ddl-queries-have-a-higher-latency-than-driver-3">Why do DDL queries have a higher latency than driver
3?</a> in the FAQ.</p>
</section>
<section id="dual-result-set-apis">
<h3>Dual result set APIs<a class="headerlink" href="#dual-result-set-apis" title="Permalink to this headline">¶</a></h3>
<p>In 3.x, both synchronous and asynchronous execution models shared a common result set
implementation. This made asynchronous usage <a class="reference external" href="http://docs.datastax.com/en/developer/java-driver/3.2/manual/async/#async-paging">notably error-prone</a>, because of the
risk of accidentally triggering background synchronous fetches.</p>
<p>There are now two separate APIs: synchronous queries return a <code class="docutils literal notranslate"><span class="pre">ResultSet</span></code>; asynchronous queries
return a future of <code class="docutils literal notranslate"><span class="pre">AsyncResultSet</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">ResultSet</span></code> behaves much like its 3.x counterpart, except that background pre-fetching
(<code class="docutils literal notranslate"><span class="pre">fetchMoreResults</span></code>) was deliberately removed, in order to keep this interface simple and intuitive.
If you were using synchronous iterations with background pre-fetching, you should now switch to
fully asynchronous iterations (see below).</p>
<p><code class="docutils literal notranslate"><span class="pre">AsyncResultSet</span></code> is a simplified type that only contains the rows of the current page. When
iterating asynchronously, you no longer need to stop the iteration manually: just consume all the
rows in <code class="docutils literal notranslate"><span class="pre">currentPage()</span></code>, and then call <code class="docutils literal notranslate"><span class="pre">fetchNextPage</span></code> to retrieve the next page asynchronously. You
will find more information about asynchronous iterations in the manual pages about <a class="reference external" href="../manual/core/async/">asynchronous
programming</a> and <a class="reference external" href="../manual/core/paging/">paging</a>.</p>
</section>
<section id="cql-to-java-type-mappings">
<h3>CQL to Java type mappings<a class="headerlink" href="#cql-to-java-type-mappings" title="Permalink to this headline">¶</a></h3>
<p>Since the driver now has access to Java 8 types, some of the <a class="reference external" href="../manual/core#cql-to-java-type-mapping">CQL to Java type mappings</a> have
changed when it comes to <a class="reference external" href="../manual/core/temporal_types">temporal types</a> such as <code class="docutils literal notranslate"><span class="pre">date</span></code> and <code class="docutils literal notranslate"><span class="pre">timestamp</span></code>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">getDate</span></code> has been replaced by <code class="docutils literal notranslate"><span class="pre">getLocalDate</span></code> and returns <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/time/LocalDate.html">java.time.LocalDate</a>;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getTime</span></code> has been replaced by <code class="docutils literal notranslate"><span class="pre">getLocalTime</span></code> and returns <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/time/LocalTime.html">java.time.LocalTime</a> instead of a
<code class="docutils literal notranslate"><span class="pre">long</span></code> representing nanoseconds since midnight;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getTimestamp</span></code> has been replaced by <code class="docutils literal notranslate"><span class="pre">getInstant</span></code> and returns <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/time/Instant.html">java.time.Instant</a> instead of
<a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/Date.html">java.util.Date</a>.</p></li>
</ul>
<p>The corresponding setter methods were also changed to expect these new types as inputs.</p>
</section>
<section id="metrics">
<h3>Metrics<a class="headerlink" href="#metrics" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="../manual/core/metrics/">Metrics</a> are now divided into two categories: session-wide and per-node.
Each metric can be enabled or disabled individually in the configuration:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">datastax</span><span class="o">-</span><span class="n">java</span><span class="o">-</span><span class="n">driver</span> <span class="p">{</span>
  <span class="n">advanced</span><span class="o">.</span><span class="n">metrics</span> <span class="p">{</span>
    <span class="o">//</span> <span class="n">more</span> <span class="n">are</span> <span class="n">available</span><span class="p">,</span> <span class="n">see</span> <span class="n">reference</span><span class="o">.</span><span class="n">conf</span> <span class="k">for</span> <span class="n">the</span> <span class="n">full</span> <span class="nb">list</span>
    <span class="n">session</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="p">[</span> <span class="nb">bytes</span><span class="o">-</span><span class="n">sent</span><span class="p">,</span> <span class="nb">bytes</span><span class="o">-</span><span class="n">received</span><span class="p">,</span> <span class="n">cql</span><span class="o">-</span><span class="n">requests</span> <span class="p">]</span>
    <span class="n">node</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="p">[</span> <span class="nb">bytes</span><span class="o">-</span><span class="n">sent</span><span class="p">,</span> <span class="nb">bytes</span><span class="o">-</span><span class="n">received</span><span class="p">,</span> <span class="n">pool</span><span class="o">.</span><span class="ow">in</span><span class="o">-</span><span class="n">flight</span> <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note that unlike 3.x, JMX is not supported out of the box. You’ll need to add the dependency
explicitly:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>io.dropwizard.metrics<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>metrics-jmx<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>4.0.2<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
</section>
<section id="metadata">
<h3>Metadata<a class="headerlink" href="#metadata" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Session.getMetadata()</span></code> is now immutable and updated atomically. The node list, schema metadata and
token map exposed by a given <code class="docutils literal notranslate"><span class="pre">Metadata</span></code> instance are guaranteed to be in sync. This is convenient
for analytics clients that need a consistent view of the cluster at a given point in time; for
example, a keyspace in <code class="docutils literal notranslate"><span class="pre">metadata.getKeyspaces()</span></code> will always have a corresponding entry in
<code class="docutils literal notranslate"><span class="pre">metadata.getTokenMap()</span></code>.</p>
<p>On the other hand, this means you have to call <code class="docutils literal notranslate"><span class="pre">getMetadata()</span></code> again each time you need a fresh
copy; do not cache the result:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Metadata</span> <span class="n">metadata</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">getMetadata</span><span class="o">();</span>
<span class="n">Optional</span><span class="o">&lt;</span><span class="n">KeyspaceMetadata</span><span class="o">&gt;</span> <span class="n">ks</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="na">getKeyspace</span><span class="o">(</span><span class="s">&quot;test&quot;</span><span class="o">);</span>
<span class="k">assert</span> <span class="o">!</span><span class="n">ks</span><span class="o">.</span><span class="na">isPresent</span><span class="o">();</span>

<span class="n">session</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span>
  <span class="s">&quot;CREATE KEYSPACE IF NOT EXISTS test &quot;</span>
      <span class="o">+</span> <span class="s">&quot;WITH replication = {&#39;class&#39;: &#39;SimpleStrategy&#39;, &#39;replication_factor&#39;: 1}&quot;</span><span class="o">);</span>

<span class="c1">// This is still the same metadata from before the CREATE</span>
<span class="n">ks</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="na">getKeyspace</span><span class="o">(</span><span class="s">&quot;test&quot;</span><span class="o">);</span>
<span class="k">assert</span> <span class="o">!</span><span class="n">ks</span><span class="o">.</span><span class="na">isPresent</span><span class="o">();</span>

<span class="c1">// You need to fetch the whole metadata again</span>
<span class="n">metadata</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">getMetadata</span><span class="o">();</span>
<span class="n">ks</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="na">getKeyspace</span><span class="o">(</span><span class="s">&quot;test&quot;</span><span class="o">);</span>
<span class="k">assert</span> <span class="n">ks</span><span class="o">.</span><span class="na">isPresent</span><span class="o">();</span>
</pre></div>
</div>
<p>Refreshing the metadata can be CPU-intensive, in particular the token map. To help alleviate that,
it can now be filtered to a subset of keyspaces. This is useful if your application connects to a
shared cluster, but does not use the whole schema:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">datastax</span><span class="o">-</span><span class="n">java</span><span class="o">-</span><span class="n">driver</span> <span class="p">{</span>
  <span class="o">//</span> <span class="n">defaults</span> <span class="n">to</span> <span class="n">empty</span> <span class="p">(</span><span class="o">=</span> <span class="nb">all</span> <span class="n">keyspaces</span><span class="p">)</span>
  <span class="n">advanced</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">refreshed</span><span class="o">-</span><span class="n">keyspaces</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;users&quot;</span><span class="p">,</span> <span class="s2">&quot;products&quot;</span> <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>See the <a class="reference external" href="../manual/core/metadata/">manual</a> for all the details.</p>
</section>
<section id="query-builder">
<h3>Query builder<a class="headerlink" href="#query-builder" title="Permalink to this headline">¶</a></h3>
<p>The query builder is now distributed as a separate artifact:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.scylladb<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>java-driver-query-builder<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>4.8.0-scylla-0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
<p>It is more cleanly separated from the core driver, and only focuses on query string generation.
Built queries are no longer directly executable, you need to convert them into a string or a
statement:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import static</span> <span class="nn">com.datastax.oss.driver.api.querybuilder.QueryBuilder.*</span><span class="o">;</span>

<span class="n">BuildableQuery</span> <span class="n">query</span> <span class="o">=</span>
    <span class="n">insertInto</span><span class="o">(</span><span class="s">&quot;user&quot;</span><span class="o">)</span>
        <span class="o">.</span><span class="na">value</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">,</span> <span class="n">bindMarker</span><span class="o">())</span>
        <span class="o">.</span><span class="na">value</span><span class="o">(</span><span class="s">&quot;first_name&quot;</span><span class="o">,</span> <span class="n">bindMarker</span><span class="o">())</span>
        <span class="o">.</span><span class="na">value</span><span class="o">(</span><span class="s">&quot;last_name&quot;</span><span class="o">,</span> <span class="n">bindMarker</span><span class="o">());</span>

<span class="n">String</span> <span class="n">cql</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="na">asCql</span><span class="o">();</span>
<span class="c1">// INSERT INTO user (id,first_name,last_name) VALUES (?,?,?)</span>

<span class="n">SimpleStatement</span> <span class="n">statement</span> <span class="o">=</span> <span class="n">query</span>
    <span class="o">.</span><span class="na">builder</span><span class="o">()</span>
    <span class="o">.</span><span class="na">addNamedValue</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">,</span> <span class="mi">0</span><span class="o">)</span>
    <span class="o">.</span><span class="na">addNamedValue</span><span class="o">(</span><span class="s">&quot;first_name&quot;</span><span class="o">,</span> <span class="s">&quot;Jane&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="na">addNamedValue</span><span class="o">(</span><span class="s">&quot;last_name&quot;</span><span class="o">,</span> <span class="s">&quot;Doe&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</pre></div>
</div>
<p>All query builder types are immutable, making them inherently thread-safe and share-safe.</p>
<p>The query builder has its own <a class="reference external" href="../manual/query_builder/">manual chapter</a>, where the syntax is
covered in detail.</p>
</section>
<section id="dedicated-type-for-cql-identifiers">
<h3>Dedicated type for CQL identifiers<a class="headerlink" href="#dedicated-type-for-cql-identifiers" title="Permalink to this headline">¶</a></h3>
<p>Instead of raw strings, the names of schema objects (keyspaces, tables, columns, etc.) are now
wrapped in a dedicated <code class="docutils literal notranslate"><span class="pre">CqlIdentifier</span></code> type. This avoids ambiguities with regard to <a class="reference external" href="../manual/case_sensitivity">case
sensitivity</a>.</p>
</section>
<section id="pluggable-request-execution-logic">
<h3>Pluggable request execution logic<a class="headerlink" href="#pluggable-request-execution-logic" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Session</span></code> is now a high-level abstraction capable of executing arbitrary requests. Out of the box,
the driver exposes a more familiar subtype <code class="docutils literal notranslate"><span class="pre">CqlSession</span></code>, that provides familiar signatures for CQL
queries (<code class="docutils literal notranslate"><span class="pre">execute(Statement)</span></code>, <code class="docutils literal notranslate"><span class="pre">prepare(String)</span></code>, etc).</p>
<p>However, the request execution logic is completely pluggable, and supports arbitrary request types
(as long as you write the boilerplate to convert them to protocol messages).</p>
<p>We use that in our DSE driver to implement a reactive API and support for DSE graph. You can also
take advantage of it to plug your own request types (if you’re interested, take a look at
<code class="docutils literal notranslate"><span class="pre">RequestProcessor</span></code> in the internal API).</p>
</section>
</section>
</section>

                
                    <div class="post-content"><div class="content-navigation">
    <div class="navigation navigation--prev">
        
            <a class="navigation__link" href="../manual/query_builder/update/index.html">
                <button class="navigation__button">
                    <i class="scylla-icon scylla-icon--chevron-left"></i>
                </button>
                <div class="navigation__title">
                    <span class="colored">PREVIOUS</span> <br />UPDATE
                </div>
            </a>
        
    </div>
    <div class="navigation navigation--next">
        
            <a class="navigation__link" href="../faq/index.html">
                <div class="navigation__title">
                    <span class="colored">NEXT</span> <br />Frequently asked questions
                </div>
                <button class="navigation__button">
                    <i class="scylla-icon scylla-icon--chevron-right"></i>
                </button>
            </a>
        
    </div>
</div></div>
                
            </div>
            <div class="sidebar-left  large-order-1">
                
                    
                        <div id="side-nav" class="side-nav custom-scroll-bar" data-closable data-toggler=".show">
    <button class="collapsible-button">
        <i class="scylla-icon scylla-icon--chevron-left"></i>
    </button>
    <div class="side-nav-content">
        <div class="side-nav__search">
            <div class="search-box">
                <ci-search></ci-search>
            </div>
        </div>
        <div class="side-nav__versions">
    <ul class="dropdown menu scylla-dropdown scylla-dropdown--versions" data-dropdown-menu>
        <li class="scylla-dropdown__item">
            <a class="scylla-dropdown__title" href="#">
                
                    4.13.0.x
                
                <i class="chevron scylla-icon scylla-icon--chevron-right"></i>
            </a>
            <ul class="menu scylla-dropdown__content">
                
                    
                        <li>
                            <a href="index.html">4.13.0.x</a>
                        </li>
                    
                
                    
                        <li>
                            <a href="../../scylla-4.12.0.x/index.html">4.12.0.x</a>
                        </li>
                    
                
                    
                        <li>
                            <a href="../../scylla-4.11.1.x/index.html">4.11.1.x</a>
                        </li>
                    
                
                    
                        <li>
                            <a href="../../scylla-4.10.0.x/index.html">4.10.0.x</a>
                        </li>
                    
                
                    
                        <li>
                            <a href="../../scylla-4.7.2.x/index.html">4.7.2.x</a>
                        </li>
                    
                
                    
                        <li>
                            <a href="../../scylla-3.11.2.x/index.html">3.11.2.x</a>
                        </li>
                    
                
                    
                        <li>
                            <a href="../../scylla-3.11.0.x/index.html">3.11.0.x</a>
                        </li>
                    
                
                    
                        <li>
                            <a href="../../scylla-3.10.2.x/index.html">3.10.2.x</a>
                        </li>
                    
                
                    
                        <li>
                            <a href="../../scylla-3.7.2.x/index.html">3.7.2.x</a>
                        </li>
                    
                
                
            </ul>
        </li>
    </ul>
</div>
        <div class="side-nav__content">
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Java Driver for Scylla and Apache Cassandra®</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Documentation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../manual/index.html">Manual</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../manual/api_conventions/index.html">API conventions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../manual/case_sensitivity/index.html">Case sensitivity</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../manual/core/index.html">Core driver</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label for="toctree-checkbox-2"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../manual/core/address_resolution/index.html">Address resolution</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual/core/async/index.html">Asynchronous programming</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual/core/authentication/index.html">Authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual/core/bom/index.html">Bill of Materials (BOM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual/core/compression/index.html">Compression</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../manual/core/configuration/index.html">Configuration</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label for="toctree-checkbox-3"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l4"><a class="reference internal" href="../manual/core/configuration/reference/README.html">Reference configuration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../manual/core/control_connection/index.html">Control connection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual/core/custom_codecs/index.html">Custom codecs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual/core/detachable_types/index.html">Detachable types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual/core/graalvm/index.html">Using the driver in GraalVM native images</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual/core/idempotence/index.html">Query idempotence</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual/core/integration/index.html">Integration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual/core/load_balancing/index.html">Load balancing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual/core/logging/index.html">Logging</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../manual/core/metadata/index.html">Metadata</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label for="toctree-checkbox-4"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l4"><a class="reference internal" href="../manual/core/metadata/node/index.html">Node metadata</a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual/core/metadata/schema/index.html">Schema metadata</a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual/core/metadata/token/index.html">Token metadata</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../manual/core/metrics/index.html">Metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual/core/native_protocol/index.html">Native protocol</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual/core/non_blocking/index.html">Non-blocking programming</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual/core/paging/index.html">Paging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual/core/performance/index.html">Performance</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual/core/pooling/index.html">Connection pooling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual/core/query_timestamps/index.html">Query timestamps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual/core/reactive/index.html">Reactive Style Programming</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual/core/reconnection/index.html">Reconnection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual/core/request_tracker/index.html">Request tracker</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual/core/retries/index.html">Retries</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual/core/shaded_jar/index.html">Using the shaded JAR</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual/core/speculative_execution/index.html">Speculative query execution</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual/core/ssl/index.html">SSL</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../manual/core/statements/index.html">Statements</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label for="toctree-checkbox-5"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l4"><a class="reference internal" href="../manual/core/statements/batch/index.html">Batch statements</a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual/core/statements/per_query_keyspace/index.html">Per-query keyspace</a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual/core/statements/prepared/index.html">Prepared statements</a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual/core/statements/simple/index.html">Simple statements</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../manual/core/temporal_types/index.html">Temporal types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual/core/throttling/index.html">Request throttling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual/core/tracing/index.html">Query tracing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual/core/tuples/index.html">Tuples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual/core/udts/index.html">User-defined types</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../manual/developer/index.html">Developer docs</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label for="toctree-checkbox-6"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../manual/developer/admin/index.html">Administrative tasks</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../manual/developer/common/index.html">Common infrastructure</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label for="toctree-checkbox-7"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l4"><a class="reference internal" href="../manual/developer/common/concurrency/index.html">Concurrency</a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual/developer/common/context/index.html">Driver context</a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual/developer/common/event_bus/index.html">Event bus</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../manual/developer/native_protocol/index.html">Native protocol layer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual/developer/netty_pipeline/index.html">Netty pipeline</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual/developer/request_execution/index.html">Request execution</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../manual/mapper/index.html">Mapper</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label for="toctree-checkbox-8"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../manual/mapper/config/index.html">Integration</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label for="toctree-checkbox-9"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l4"><a class="reference internal" href="../manual/mapper/config/kotlin/index.html">Kotlin</a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual/mapper/config/lombok/index.html">Lombok</a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual/mapper/config/record/index.html">Java 14 Records</a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual/mapper/config/scala/index.html">Scala</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../manual/mapper/daos/index.html">DAOs</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label for="toctree-checkbox-10"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l4"><a class="reference internal" href="../manual/mapper/daos/custom_types/index.html">Custom result types</a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual/mapper/daos/delete/index.html">Delete methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual/mapper/daos/getentity/index.html">GetEntity methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual/mapper/daos/increment/index.html">Increment methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual/mapper/daos/insert/index.html">Insert methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual/mapper/daos/null_saving/index.html">Null saving strategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual/mapper/daos/query/index.html">Query methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual/mapper/daos/queryprovider/index.html">Query provider methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual/mapper/daos/select/index.html">Select methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual/mapper/daos/setentity/index.html">SetEntity methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual/mapper/daos/statement_attributes/index.html">Statement attributes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual/mapper/daos/update/index.html">Update methods</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../manual/mapper/entities/index.html">Entities</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual/mapper/mapper/index.html">Mapper interface</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../manual/osgi/index.html">OSGi</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../manual/query_builder/index.html">Query builder</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label for="toctree-checkbox-11"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../manual/query_builder/condition/index.html">Conditions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual/query_builder/delete/index.html">DELETE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual/query_builder/idempotence/index.html">Idempotence in the query builder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual/query_builder/insert/index.html">INSERT</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual/query_builder/relation/index.html">Relations</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../manual/query_builder/schema/index.html">Schema builder</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/><label for="toctree-checkbox-12"><i class="scylla-icon scylla-icon--expand"></i></label><div class="break"></div><ul>
<li class="toctree-l4"><a class="reference internal" href="../manual/query_builder/schema/aggregate/index.html">Aggregate</a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual/query_builder/schema/function/index.html">Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual/query_builder/schema/index/index.html">Index</a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual/query_builder/schema/keyspace/index.html">Keyspace</a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual/query_builder/schema/materialized_view/index.html">Materialized View</a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual/query_builder/schema/table/index.html">Table</a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual/query_builder/schema/type/index.html">Type</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../manual/query_builder/select/index.html">SELECT</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual/query_builder/term/index.html">Terms</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual/query_builder/truncate/index.html">TRUNCATE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual/query_builder/update/index.html">UPDATE</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Upgrade guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">Frequently asked questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog/index.html">Changelog</a></li>
</ul>

        </div>
    </div>
</div>
                    
                
            </div>
            
                <div class="sidebar-right large-order-3">
                    <div class="secondary-side-nav custom-scroll-bar">
    
    <ul class="contribute">
        <li class="contribute__item">
            <a href="https://github.com/scylladb/java-driver/issues/new?title=Issue in page Upgrade guide&&body=I%20would%20like%20to%20report%20an%20issue%20in%20page%20https://java-driver.docs.scylladb.com/scylla-4.13.0.x/upgrade_guide/index%0A%0A%23%23%23%20Problem%0A%0A%23%23%23%20%20Suggest%20a%20fix"
                target="_blank">
                <i class="icon fab fa-github" aria-hidden="true"></i>Create an issue
            </a>
        </li>
        
            <li class="contribute__item">
                
                
                    
                        
                    
                
                <a href="https://github.com/scylladb/java-driver/edit/scylla-4.13.0.x/docs/source/upgrade_guide/index.md"
                    target="_blank">
                    <i class="icon fa fa-edit" aria-hidden="true"></i>Edit this page
                </a>
            </li>
        
    </ul>

    
        <div class="secondary-side-nav__content">
            <p class="topic-title">On this page</p>
            <ul>
<li><a class="reference internal" href="#">Upgrade guide</a><ul>
<li><a class="reference internal" href="#id1">4.13.0</a><ul>
<li><a class="reference internal" href="#enhanced-support-for-graalvm-native-images">Enhanced support for GraalVM native images</a></li>
<li><a class="reference internal" href="#registration-of-multiple-listeners-and-trackers">Registration of multiple listeners and trackers</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id2">4.12.0</a><ul>
<li><a class="reference internal" href="#microprofile-metrics-upgraded-to-3-0">MicroProfile Metrics upgraded to 3.0</a></li>
<li><a class="reference internal" href="#mapper-getentity-and-setentity-methods-can-now-be-lenient">Mapper <code class="docutils literal notranslate"><span class="pre">&#64;GetEntity</span></code> and <code class="docutils literal notranslate"><span class="pre">&#64;SetEntity</span></code> methods can now be lenient</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id3">4.11.0</a><ul>
<li><a class="reference internal" href="#native-protocol-v5-is-now-production-ready">Native protocol V5 is now production-ready</a></li>
<li><a class="reference internal" href="#customizable-metric-names-support-for-metric-tags">Customizable metric names, support for metric tags</a></li>
<li><a class="reference internal" href="#new-nodedistanceevaluator-api">New <code class="docutils literal notranslate"><span class="pre">NodeDistanceEvaluator</span></code> API</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id4">4.10.0</a><ul>
<li><a class="reference internal" href="#cross-datacenter-failover">Cross-datacenter failover</a></li>
<li><a class="reference internal" href="#new-retryverdict-api">New <code class="docutils literal notranslate"><span class="pre">RetryVerdict</span></code> API</a></li>
<li><a class="reference internal" href="#enhancements-to-the-uuids-utility-class">Enhancements to the <code class="docutils literal notranslate"><span class="pre">Uuids</span></code> utility class</a></li>
<li><a class="reference internal" href="#system-and-dse-keyspaces-automatically-excluded-from-metadata-and-token-map-computation">System and DSE keyspaces automatically excluded from metadata and token map computation</a></li>
<li><a class="reference internal" href="#dse-graph-dependencies-are-now-optional">DSE Graph dependencies are now optional</a></li>
</ul>
</li>
<li><a class="reference internal" href="#x-4-6-0">4.5.x - 4.6.0</a></li>
<li><a class="reference internal" href="#id5">4.4.0</a><ul>
<li><a class="reference internal" href="#for-apache-cassandra-users">For Apache Cassandra® users</a></li>
<li><a class="reference internal" href="#for-datastax-enterprise-users">For Datastax Enterprise users</a></li>
<li><a class="reference internal" href="#class-loader">Class Loader</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id6">4.1.0</a><ul>
<li><a class="reference internal" href="#object-mapper">Object mapper</a></li>
<li><a class="reference internal" href="#internal-api">Internal API</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id7">4.0.0</a><ul>
<li><a class="reference internal" href="#new-maven-coordinates">New Maven coordinates</a></li>
<li><a class="reference internal" href="#runtime-requirements">Runtime requirements</a></li>
<li><a class="reference internal" href="#packages">Packages</a></li>
<li><a class="reference internal" href="#configuration">Configuration</a></li>
<li><a class="reference internal" href="#session">Session</a></li>
<li><a class="reference internal" href="#load-balancing-policy">Load balancing policy</a></li>
<li><a class="reference internal" href="#statements">Statements</a></li>
<li><a class="reference internal" href="#dual-result-set-apis">Dual result set APIs</a></li>
<li><a class="reference internal" href="#cql-to-java-type-mappings">CQL to Java type mappings</a></li>
<li><a class="reference internal" href="#metrics">Metrics</a></li>
<li><a class="reference internal" href="#metadata">Metadata</a></li>
<li><a class="reference internal" href="#query-builder">Query builder</a></li>
<li><a class="reference internal" href="#dedicated-type-for-cql-identifiers">Dedicated type for CQL identifiers</a></li>
<li><a class="reference internal" href="#pluggable-request-execution-logic">Pluggable request execution logic</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
    
</div>
                </div>
            
        </section>

        <footer class="footer">
    <div class="footer-group">
        <div class="footer-top">
            <a class="footer-logo" href="https://www.scylladb.com">
                <img src="../_static/img/logo-scylla-horizontal-RGB.svg" alt="Logo" />
            </a>
            <div class="footer-links">
                <a class="footer-links__link" href="https://docs.scylladb.com/">Docs</a>
                <a class="footer-links__link" href="https://www.scylladb.com/company/contact-us/">Contact Us</a>
                <a class="footer-links__link" href="https://www.scylladb.com/company/">About Us</a>
            </div>
            <div class="footer-actions">
                <a class="footer-actions__link" href="https://groups.google.com/g/scylladb-users" target="_blank">
                    <span data-tooltip tabindex="1" title="User mailing list" data-position="bottom">
                        <img src="../_static/img/icons/icon-mail-list.svg" alt="Mail List Icon" />
                    </span>
                </a>
                <a class="footer-actions__link" href="http://slack.scylladb.com/" target="_blank">
                    <span data-tooltip tabindex="1" title="User Slack channel" data-position="bottom">
                        <img src="../_static/img/icons/icon-slack.svg" alt="Slack Icon" />
                    </span>
                </a>
            </div>
        </div>

        <div class="footer-bottom">
            
                <div class="footer-bottom__copyright">
                    
                        
                            &#169; 2022, ScyllaDB. All rights reserved.
                        
                    
                </div>
            
            
                <div class="footer-bottom__last-updated">
                    
                        Last updated on 25 May 2022.
                    
                </div>
            
            <div class="footer-bottom__version">
                Powered by
                <a href="http://sphinx-doc.org/">Sphinx 4.3.2</a> &amp;
                <a href="https://sphinx-theme.scylladb.com/">ScyllaDB Theme 1.2.2</a>
            </div>
        </div>
    </div>
</footer>

        <noscript>
            <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T8P2JP" height="0" width="0"
                style="display: none; visibility: hidden"></iframe>
        </noscript>
    </body>

</html>